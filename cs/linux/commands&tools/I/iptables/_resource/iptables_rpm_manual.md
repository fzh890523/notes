

# IPTABLES

Section: iptables 1.4.7 (8)

Updated: 

Index

 

## NAME

iptables --- administration tool for IPv4 packet filtering and NAT

 

## SYNOPSIS

iptables

 [

-t

 

table

] {

-A

|

-D

} 

chain

 

rule-specification

**iptables** [**-t** *table*] **-I** *chain* [*rulenum*] *rule-specification*

**iptables** [**-t** *table*] **-R** *chain rulenum rule-specification*

**iptables** [**-t** *table*] **-D** *chain rulenum*

**iptables** [**-t** *table*] **-S** [*chain* [*rulenum*]]

**iptables** [**-t** *table*] {**-F**|**-L**|**-Z**} [*chain* [*rulenum*]] [*options...*]

**iptables** [**-t** *table*] **-N** *chain*

**iptables** [**-t** *table*] **-X** [*chain*]

**iptables** [**-t** *table*] **-P** *chain target*

**iptables** [**-t** *table*] **-E** *old-chain-name new-chain-name*

rule-specification = [*matches...*] [*target*]

match = **-m** *matchname* [*per-match-options*]

target = **-j** *targetname* [*per-target-options*][ ]()

## DESCRIPTION

Iptables

 is used to set up, maintain, and inspect thetables of IPv4 packetfilter rules in the Linux kernel. Several different tablesmay be defined. Each table contains a number of built-inchains and may also contain user-defined chains.

Each chain is a list of rules which can match a set of packets. Eachrule specifies what to do with a packet that matches. This is calleda `target', which may be a jump to a user-defined chain in the sametable.[ ]()

## TARGETS

A firewall rule specifies criteria for a packet and a target. If thepacket does not match, the next rule in the chain is the examined; ifit does match, then the next rule is specified by the value of thetarget, which can be the name of a user-defined chain or one of thespecial values 

ACCEPT

, 

DROP

, 

QUEUE

 or 

RETURN

.

**ACCEPT** means to let the packet through.**DROP** means to drop the packet on the floor.**QUEUE** means to pass the packet to userspace.(How the packet can be receivedby a userspace process differs by the particular queue handler. 2.4.xand 2.6.x kernels up to 2.6.13 include the **ip_queue**queue handler. Kernels 2.6.14 and later additionally include the**nfnetlink_queue** queue handler. Packets with a target of QUEUE will besent to queue number '0' in this case. Please also see the **NFQUEUE**target as described later in this man page.)**RETURN** means stop traversing this chain and resume at the nextrule in theprevious (calling) chain. If the end of a built-in chain is reachedor a rule in a built-in chain with target **RETURN**is matched, the target specified by the chain policy determines thefate of the packet.[ ]()

## TABLES

There are currently three independent tables (which tables are presentat any time depends on the kernel configuration options and whichmodules are present).

- **-t**, **--table** *table*

  This option specifies the packet matching table which the commandshould operate on. If the kernel is configured with automatic moduleloading, an attempt will be made to load the appropriate module forthat table if it is not already there.The tables are as follows:**filter**:This is the default table (if no -t option is passed). It containsthe built-in chains **INPUT** (for packets destined to local sockets),**FORWARD** (for packets being routed through the box), and**OUTPUT** (for locally-generated packets).**nat**:This table is consulted when a packet that creates a newconnection is encountered. It consists of three built-ins: **PREROUTING**(for altering packets as soon as they come in), **OUTPUT**(for altering locally-generated packets before routing), and **POSTROUTING**(for altering packets as they are about to go out).**mangle**:This table is used for specialized packet alteration. Until kernel2.4.17 it had two built-in chains: **PREROUTING**(for altering incoming packets before routing) and **OUTPUT**(for altering locally-generated packets before routing).Since kernel 2.4.18, three other built-in chains are also supported:**INPUT**(for packets coming into the box itself), **FORWARD**(for altering packets being routed through the box), and **POSTROUTING**(for altering packets as they are about to go out).**raw**:This table is used mainly for configuring exemptions from connectiontracking in combination with the NOTRACK target. It registers at the netfilterhooks with higher priority and is thus called before ip_conntrack, or any otherIP tables. It provides the following built-in chains: **PREROUTING**(for packets arriving via any network interface) **OUTPUT**(for packets generated by local processes)

 

## OPTIONS

The options that are recognized by

iptables

 can be divided into several different groups.

 

### COMMANDS

These options specify the desired action to perform. Only one of themcan be specified on the command line unless otherwise statedbelow. For long versions of the command and option names, youneed to use only enough letters to ensure that

iptables

 can differentiate it from all other options.

- **-A**, **--append** *chain rule-specification*

  Append one or more rules to the end of the selected chain.When the source and/or destination names resolve to more than oneaddress, a rule will be added for each possible address combination.

- **-D**, **--delete** *chain rule-specification*

- **-D**, **--delete** *chain rulenum*

  Delete one or more rules from the selected chain. There are twoversions of this command: the rule can be specified as a number in thechain (starting at 1 for the first rule) or a rule to match.

- **-I**, **--insert** *chain* [*rulenum*] *rule-specification*

  Insert one or more rules in the selected chain as the given rulenumber. So, if the rule number is 1, the rule or rules are insertedat the head of the chain. This is also the default if no rule numberis specified.

- **-R**, **--replace** *chain rulenum rule-specification*

  Replace a rule in the selected chain. If the source and/ordestination names resolve to multiple addresses, the command willfail. Rules are numbered starting at 1.

- **-L**, **--list** [*chain*]

  List all rules in the selected chain. If no chain is selected, allchains are listed. Like every other iptables command, it applies to thespecified table (filter is the default), so NAT rules get listed by` iptables -t nat -n -L`Please note that it is often used with the **-n**option, in order to avoid long reverse DNS lookups.It is legal to specify the **-Z**(zero) option as well, in which case the chain(s) will be atomicallylisted and zeroed. The exact output is affected by the otherarguments given. The exact rules are suppressed until you use` iptables -L -v`

- **-S**, **--list-rules** [*chain*]

  Print all rules in the selected chain. If no chain is selected, allchains are printed like iptables-save. Like every other iptables command,it applies to the specified table (filter is the default).

- **-F**, **--flush** [*chain*]

  Flush the selected chain (all the chains in the table if none is given).This is equivalent to deleting all the rules one by one.

- **-Z**, **--zero** [*chain* [*rulenum*]]

  Zero the packet and byte counters in all chains, or only the given chain,or only the given rule in a chain. It is legal tospecify the**-L**, **--list**(list) option as well, to see the counters immediately before they arecleared. (See above.)

- **-N**, **--new-chain** *chain*

  Create a new user-defined chain by the given name. There must be notarget of that name already.

- **-X**, **--delete-chain** [*chain*]

  Delete the optional user-defined chain specified. There must be no referencesto the chain. If there are, you must delete or replace the referring rulesbefore the chain can be deleted. The chain must be empty, i.e. not containany rules. If no argument is given, it will attempt to delete everynon-builtin chain in the table.

- **-P**, **--policy** *chain target*

  Set the policy for the chain to the given target. See the section **TARGETS**for the legal targets. Only built-in (non-user-defined) chains can havepolicies, and neither built-in nor user-defined chains can be policytargets.

- **-E**, **--rename-chain** *old-chain new-chain*

  Rename the user specified chain to the user supplied name. This iscosmetic, and has no effect on the structure of the table.

- **-h**

  Help.Give a (currently very brief) description of the command syntax.

 

### PARAMETERS

The following parameters make up a rule specification (as used in theadd, delete, insert, replace and append commands).

- [**!**] **-p**, **--protocol** *protocol*

  The protocol of the rule or of the packet to check.The specified protocol can be one of **tcp**, **udp**, **udplite**,**icmp**, **esp**, **ah**, **sctp** or **all**,or it can be a numeric value, representing one of these protocols or adifferent one. A protocol name from /etc/protocols is also allowed.A "!" argument before the protocol inverts thetest. The number zero is equivalent to **all**.Protocol **all**will match with all protocols and is taken as default when thisoption is omitted.

- [**!**] **-s**, **--source** *address*[**/***mask*][**,***...*]

  Source specification. *Address*can be either a network name, a hostname, a network IP address (with**/***mask*), or a plain IP address. Hostnames willbe resolved once only, before the rule is submitted to the kernel.Please note that specifying any name to be resolved with a remote query such asDNS is a really bad idea.The *mask*can be either a network mask or a plain number,specifying the number of 1's at the left side of the network mask.Thus, a mask of *24* is equivalent to *255.255.255.0*.A "!" argument before the address specification inverts the sense ofthe address. The flag **--src** is an alias for this option.Multiple addresses can be specified, but this will **expand to multiplerules** (when adding with -A), or will cause multiple rules to bedeleted (with -D).

- [**!**] **-d**, **--destination** *address*[**/***mask*][**,***...*]

  Destination specification. See the description of the **-s**(source) flag for a detailed description of the syntax. The flag**--dst** is an alias for this option.

- **-j**, **--jump** *target*

  This specifies the target of the rule; i.e., what to do if the packetmatches it. The target can be a user-defined chain (other than theone this rule is in), one of the special builtin targets which decidethe fate of the packet immediately, or an extension (see **EXTENSIONS**below). If thisoption is omitted in a rule (and **-g**is not used), then matching the rule will have noeffect on the packet's fate, but the counters on the rule will beincremented.

- **-g**, **--goto** *chain*

  This specifies that the processing should continue in a userspecified chain. Unlike the --jump option return will not continueprocessing in this chain but instead in the chain that called us via--jump.

- [**!**] **-i**, **--in-interface** *name*

  Name of an interface via which a packet was received (only forpackets entering the **INPUT**, **FORWARD** and **PREROUTING**chains). When the "!" argument is used before the interface name, thesense is inverted. If the interface name ends in a "+", then anyinterface which begins with this name will match. If this option isomitted, any interface name will match.

- [**!**] **-o**, **--out-interface** *name*

  Name of an interface via which a packet is going to be sent (for packetsentering the **FORWARD**, **OUTPUT** and **POSTROUTING**chains). When the "!" argument is used before the interface name, thesense is inverted. If the interface name ends in a "+", then anyinterface which begins with this name will match. If this option isomitted, any interface name will match.

- [**!**] **-f**, **--fragment**

  This means that the rule only refers to second and further fragmentsof fragmented packets. Since there is no way to tell the source ordestination ports of such a packet (or ICMP type), such a packet willnot match any rules which specify them. When the "!" argumentprecedes the "-f" flag, the rule will only match head fragments, orunfragmented packets.

- **-c**, **--set-counters** *packets bytes*

  This enables the administrator to initialize the packet and bytecounters of a rule (during **INSERT**, **APPEND**, **REPLACE**operations).

 

### OTHER OPTIONS

The following additional options can be specified:

- **-v**, **--verbose**

  Verbose output. This option makes the list command show the interfacename, the rule options (if any), and the TOS masks. The packet andbyte counters are also listed, with the suffix 'K', 'M' or 'G' for1000, 1,000,000 and 1,000,000,000 multipliers respectively (but seethe **-x** flag to change this).For appending, insertion, deletion and replacement, this causesdetailed information on the rule or rules to be printed.

- **-n**, **--numeric**

  Numeric output.IP addresses and port numbers will be printed in numeric format.By default, the program will try to display them as host names,network names, or services (whenever applicable).

- **-x**, **--exact**

  Expand numbers.Display the exact value of the packet and byte counters,instead of only the rounded number in K's (multiples of 1000)M's (multiples of 1000K) or G's (multiples of 1000M). This option isonly relevant for the **-L** command.

- **--line-numbers**

  When listing rules, add line numbers to the beginning of each rule,corresponding to that rule's position in the chain.

- **--modprobe=***command*

  When adding or inserting rules into a chain, use *command*to load any necessary modules (targets, match extensions, etc).

 

## MATCH EXTENSIONS

iptables can use extended packet matching modules. These are loadedin two ways: implicitly, when 

-p

 or 

--protocol

is specified, or with the 

-m

 or 

--match

options, followed by the matching module name; after these, variousextra command line options become available, depending on the specificmodule. You can specify multiple extended match modules in one line,and you can use the 

-h

 or 

--help

options after the module has been specified to receive help specificto that module.

The following are included in the base package, and most of these canbe preceded by a "**!**" to invert the sense of the match.[ ]()

### addrtype

This module matches packets based on their 

address type.

Address types are used within the kernel networking stack and categorizeaddresses into various groups. The exact definition of that group depends on the specific layer three protocol.

The following address types are possible:

- **UNSPEC**

  an unspecified address (i.e. 0.0.0.0)

- **UNICAST**

  an unicast address

- **LOCAL**

  a local address

- **BROADCAST**

  a broadcast address

- **ANYCAST**

  an anycast packet

- **MULTICAST**

  a multicast address

- **BLACKHOLE**

  a blackhole address

- **UNREACHABLE**

  an unreachable address

- **PROHIBIT**

  a prohibited address

- **THROW**

  FIXME

- **NAT**

  FIXME

- **XRESOLVE**

- [**!**] **--src-type** *type*

  Matches if the source address is of given type

- [**!**] **--dst-type** *type*

  Matches if the destination address is of given type

- **--limit-iface-in**

  The address type checking can be limited to the interface the packet is comingin. This option is only valid in the**PREROUTING**,**INPUT**and**FORWARD**chains. It cannot be specified with the**--limit-iface-out**option.

- **--limit-iface-out**

  The address type checking can be limited to the interface the packet is goingout. This option is only valid in the**POSTROUTING**,**OUTPUT**and**FORWARD**chains. It cannot be specified with the**--limit-iface-in**option.

 

### ah

This module matches the SPIs in Authentication header of IPsec packets.

- [**!**] **--ahspi** *spi*[**:***spi*]


 

### cluster

Allows you to deploy gateway and back-end load-sharing clusters without theneed of load-balancers.

This match requires that all the nodes see the same packets. Thus, the clustermatch decides if this node has to handle a packet given the following options:

- **--cluster-total-nodes** *num*

  Set number of total nodes in cluster.

- [**!**] **--cluster-local-node** *num*

  Set the local node number ID.

- [**!**] **--cluster-local-nodemask** *mask*

  Set the local node number ID mask. You can use this option insteadof **--cluster-local-node**.

- **--cluster-hash-seed** *value*

  Set seed value of the Jenkins hash.

Example:

- 

  iptables -A PREROUTING -t mangle -i eth1 -m cluster--cluster-total-nodes 2 --cluster-local-node 1--cluster-hash-seed 0xdeadbeef-j MARK --set-mark 0xffff

- 

  iptables -A PREROUTING -t mangle -i eth2 -m cluster--cluster-total-nodes 2 --cluster-local-node 1--cluster-hash-seed 0xdeadbeef-j MARK --set-mark 0xffff

- 

  iptables -A PREROUTING -t mangle -i eth1-m mark ! --mark 0xffff -j DROP

- 

  iptables -A PREROUTING -t mangle -i eth2-m mark ! --mark 0xffff -j DROP

And the following commands to make all nodes see the same packets:

- 

  ip maddr add 01:00:5e:00:01:01 dev eth1

- 

  ip maddr add 01:00:5e:00:01:02 dev eth2

- 

  arptables -A OUTPUT -o eth1 --h-length 6-j mangle --mangle-mac-s 01:00:5e:00:01:01

- 

  arptables -A INPUT -i eth1 --h-length 6--destination-mac 01:00:5e:00:01:01-j mangle --mangle-mac-d 00:zz:yy:xx:5a:27

- 

  arptables -A OUTPUT -o eth2 --h-length 6-j mangle --mangle-mac-s 01:00:5e:00:01:02

- 

  arptables -A INPUT -i eth2 --h-length 6--destination-mac 01:00:5e:00:01:02-j mangle --mangle-mac-d 00:zz:yy:xx:5a:27

In the case of TCP connections, pickup facility has to be disabledto avoid marking TCP ACK packets coming in the reply direction asvalid.

- 

  echo 0 > /proc/sys/net/netfilter/nf_conntrack_tcp_loose

 

### comment

Allows you to add comments (up to 256 characters) to any rule.

- **--comment** *comment*

- Example:

  iptables -A INPUT -s 192.168.0.0/16 -m comment --comment "A privatized IP block"

 

### connbytes

Match by how many bytes or packets a connection (or one of the twoflows constituting the connection) has transferred so far, or byaverage bytes per packet.

The counters are 64-bit and are thus not expected to overflow ;)

The primary use is to detect long-lived downloads and mark them to bescheduled using a lower priority band in traffic control.

The transferred bytes per connection can also be viewed through`conntrack -L` and accessed via ctnetlink.

NOTE that for connections which have no accounting information, the match willalways return false. The "net.netfilter.nf_conntrack_acct" sysctl flag controlswhether **new**connections will be byte/packet counted. Existing connectionflows will not be gaining/losing a/the accounting structure when be sysctl flagis flipped.

- [**!**] **--connbytes** *from*[**:***to*]

  match packets from a connection whose packets/bytes/average packetsize is more than FROM and less than TO bytes/packets. if TO isomitted only FROM check is done. "!" is used to match packets notfalling in the range.

- **--connbytes-dir** {**original**|**reply**|**both**}

  which packets to consider

- **--connbytes-mode** {**packets**|**bytes**|**avgpkt**}

  whether to check the amount of packets, number of bytes transferred orthe average size (in bytes) of all packets received so far. Note thatwhen "both" is used together with "avgpkt", and data is going (mainly)only in one direction (for example HTTP), the average packet size willbe about half of the actual data packets.

- Example:

  iptables .. -m connbytes --connbytes 10000:100000 --connbytes-dir both --connbytes-mode bytes ...

 

### connlimit

Allows you to restrict the number of parallel connections to a server perclient IP address (or client address block).

- [**!**] **--connlimit-above** *n*

  Match if the number of existing connections is (not) above *n*.

- **--connlimit-mask** *prefix_length*

  Group hosts using the prefix length. For IPv4, this must be a number between(including) 0 and 32. For IPv6, between 0 and 128.Examples:

- # allow 2 telnet connections per client host

  iptables -A INPUT -p tcp --syn --dport 23 -m connlimit --connlimit-above 2 -j REJECT

- # you can also match the other way around:

  iptables -A INPUT -p tcp --syn --dport 23 -m connlimit ! --connlimit-above 2 -j ACCEPT

- # limit the number of parallel HTTP requests to 16 per class C sized network (24 bit netmask)

  iptables -p tcp --syn --dport 80 -m connlimit --connlimit-above 16--connlimit-mask 24 -j REJECT

- # limit the number of parallel HTTP requests to 16 for the link local network

  (ipv6)ip6tables -p tcp --syn --dport 80 -s fe80::/64 -m connlimit --connlimit-above16 --connlimit-mask 64 -j REJECT

 

### connmark

This module matches the netfilter mark field associated with a connection(which can be set using the 

CONNMARK

 target below).

- [**!**] **--mark** *value*[**/***mask*]

  Matches packets in connections with the given mark value (if a mask isspecified, this is logically ANDed with the mark before the comparison).

 

### conntrack

This module, when combined with connection tracking, allows access to theconnection tracking state for this packet/connection.

- [**!**] **--ctstate** *statelist*

  *statelist* is a comma separated list of the connection states to match.Possible states are listed below.

- [**!**] **--ctproto** *l4proto*

  Layer-4 protocol to match (by number or name)

- [**!**] **--ctorigsrc** *address*[**/***mask*]

- [**!**] **--ctorigdst** *address*[**/***mask*]

- [**!**] **--ctreplsrc** *address*[**/***mask*]

- [**!**] **--ctrepldst** *address*[**/***mask*]

  Match against original/reply source/destination address

- [**!**] **--ctorigsrcport** *port*

- [**!**] **--ctorigdstport** *port*

- [**!**] **--ctreplsrcport** *port*

- [**!**] **--ctrepldstport** *port*

  Match against original/reply source/destination port (TCP/UDP/etc.) or GRE key.

- [**!**] **--ctstatus** *statelist*

  *statuslist* is a comma separated list of the connection statuses to match.Possible statuses are listed below.

- [**!**] **--ctexpire** *time*[**:***time*]

  Match remaining lifetime in seconds against given value or range of values(inclusive)

- **--ctdir** {**ORIGINAL**|**REPLY**}

  Match packets that are flowing in the specified direction. If this flag is notspecified at all, matches packets in both directions.

States for **--ctstate**:

- **INVALID**

  meaning that the packet is associated with no known connection

- **NEW**

  meaning that the packet has started a new connection, or otherwise associatedwith a connection which has not seen packets in both directions, and

- **ESTABLISHED**

  meaning that the packet is associated with a connection which has seen packetsin both directions,

- **RELATED**

  meaning that the packet is starting a new connection, but is associated with anexisting connection, such as an FTP data transfer, or an ICMP error.

- **SNAT**

  A virtual state, matching if the original source address differs from the replydestination.

- **DNAT**

  A virtual state, matching if the original destination differs from the replysource.

Statuses for **--ctstatus**:

- **NONE**

  None of the below.

- **EXPECTED**

  This is an expected connection (i.e. a conntrack helper set it up)

- **SEEN_REPLY**

  Conntrack has seen packets in both directions.

- **ASSURED**

  Conntrack entry should never be early-expired.

- **CONFIRMED**

  Connection is confirmed: originating packet has left box.

 

### dccp

- [**!**] **--source-port**,**--sport** *port*[**:***port*]

- [**!**] **--destination-port**,**--dport** *port*[**:***port*]

- [**!**] **--dccp-types** *mask*

  Match when the DCCP packet type is one of 'mask'. 'mask' is a comma-separatedlist of packet types. Packet types are: **REQUEST RESPONSE DATA ACK DATAACK CLOSEREQ CLOSE RESET SYNC SYNCACK INVALID**.

- [**!**] **--dccp-option** *number*

  Match if DCP option set.

 

### dscp

This module matches the 6 bit DSCP field within the TOS field in theIP header. DSCP has superseded TOS within the IETF.

- [**!**] **--dscp** *value*

  Match against a numeric (decimal or hex) value [0-63].

- [**!**] **--dscp-class** *class*

  Match the DiffServ class. This value may be any of theBE, EF, AFxx or CSx classes. It will then be convertedinto its according numeric value.

 

### ecn

This allows you to match the ECN bits of the IPv4 and TCP header. ECN is the Explicit Congestion Notification mechanism as specified in RFC3168

- [**!**] **--ecn-tcp-cwr**

  This matches if the TCP ECN CWR (Congestion Window Received) bit is set.

- [**!**] **--ecn-tcp-ece**

  This matches if the TCP ECN ECE (ECN Echo) bit is set.

- [**!**] **--ecn-ip-ect** *num*

  This matches a particular IPv4 ECT (ECN-Capable Transport). You have to specifya number between `0' and `3'.

 

### esp

This module matches the SPIs in ESP header of IPsec packets.

- [**!**] **--espspi** *spi*[**:***spi*]


 

### hashlimit

hashlimit

 uses hash buckets to express a rate limiting match (like the

limit

 match) for a group of connections using a 

single

 iptablesrule. Grouping can be done per-hostgroup (source and/or destination address)and/or per-port. It gives you the ability to express "

N

 packets per timequantum per group":

- matching on source host

  "1000 packets per second for every host in 192.168.0.0/16"

- matching on source prot

  "100 packets per second for every service of 192.168.1.1"

- matching on subnet

  "10000 packets per minute for every /28 subnet in 10.0.0.0/8"

A hash limit option (**--hashlimit-upto**, **--hashlimit-above**) and**--hashlimit-name** are required.

- **--hashlimit-upto** *amount*[**/second**|**/minute**|**/hour**|**/day**]

  Match if the rate is below or equal to *amount*/quantum. It is specified asa number, with an optional time quantum suffix; the default is 3/hour.

- **--hashlimit-above** *amount*[**/second**|**/minute**|**/hour**|**/day**]

  Match if the rate is above *amount*/quantum.

- **--hashlimit-burst** *amount*

  Maximum initial number of packets to match: this number gets recharged by oneevery time the limit specified above is not reached, up to this number; thedefault is 5.

- **--hashlimit-mode** {**srcip**|**srcport**|**dstip**|**dstport**}**,**...

  A comma-separated list of objects to take into consideration. If no--hashlimit-mode option is given, hashlimit acts like limit, but at theexpensive of doing the hash housekeeping.

- **--hashlimit-srcmask** *prefix*

  When --hashlimit-mode srcip is used, all source addresses encountered will begrouped according to the given prefix length and the so-created subnet will besubject to hashlimit. *prefix* must be between (inclusive) 0 and 32. Notethat --hashlimit-srcmask 0 is basically doing the same thing as not specifyingsrcip for --hashlimit-mode, but is technically more expensive.

- **--hashlimit-dstmask** *prefix*

  Like --hashlimit-srcmask, but for destination addresses.

- **--hashlimit-name** *foo*

  The name for the /proc/net/ipt_hashlimit/foo entry.

- **--hashlimit-htable-size** *buckets*

  The number of buckets of the hash table

- **--hashlimit-htable-max** *entries*

  Maximum entries in the hash.

- **--hashlimit-htable-expire** *msec*

  After how many milliseconds do hash entries expire.

- **--hashlimit-htable-gcinterval** *msec*

  How many milliseconds between garbage collection intervals.

 

### helper

This module matches packets related to a specific conntrack-helper.

- [**!**] **--helper** *string*

  Matches packets related to the specified conntrack-helper.string can be "ftp" for packets related to a ftp-session on default port.For other ports append -portnr to the value, ie. "ftp-2121".Same rules apply for other conntrack-helpers.

 

### icmp

This extension can be used if `--protocol icmp' is specified. Itprovides the following option:

- [**!**] **--icmp-type** {*type*[**/***code*]|*typename*}

  This allows specification of the ICMP type, which can be a numericICMP type, type/code pair, or one of the ICMP type names shown by the command` iptables -p icmp -h`

 

### iprange

This matches on a given arbitrary range of IP addresses.

- [**!**] **--src-range** *from*[**-***to*]

  Match source IP in the specified range.

- [**!**] **--dst-range** *from*[**-***to*]

  Match destination IP in the specified range.

 

### length

This module matches the length of the layer-3 payload (e.g. layer-4 packet)of a packet against a specific valueor range of values.

- [**!**] **--length** *length*[**:***length*]


 

### limit

This module matches at a limited rate using a token bucket filter.A rule using this extension will match until this limit is reached(unless the `!' flag is used). It can be used in combination with the

LOG

target to give limited logging, for example.

- **--limit** *rate*[**/second**|**/minute**|**/hour**|**/day**]

  Maximum average matching rate: specified as a number, with an optional`/second', `/minute', `/hour', or `/day' suffix; the default is3/hour.

- **--limit-burst** *number*

  Maximum initial number of packets to match: this number getsrecharged by one every time the limit specified above is not reached,up to this number; the default is 5.

 

### mac

- [**!**] **--mac-source** *address*

  Match source MAC address. It must be of the form XX:XX:XX:XX:XX:XX.Note that this only makes sense for packets coming from an Ethernet deviceand entering the**PREROUTING**,**FORWARD**or**INPUT**chains.

 

### mark

This module matches the netfilter mark field associated with a packet(which can be set using the

MARK

target below).

- [**!**] **--mark** *value*[**/***mask*]

  Matches packets with the given unsigned mark value (if a *mask* isspecified, this is logically ANDed with the *mask* before thecomparison).

 

### multiport

This module matches a set of source or destination ports. Up to 15ports can be specified. A port range (port:port) counts as twoports. It can only be used in conjunction with

-p tcp

or

-p udp

.

- [**!**] **--source-ports**,**--sports** *port*[**,***port*|**,***port***:***port*]...

  Match if the source port is one of the given ports. The flag**--sports**is a convenient alias for this option. Multiple ports or port ranges areseparated using a comma, and a port range is specified using a colon.**53,1024:65535** would therefore match ports 53 and all from 1024 through65535.

- [**!**] **--destination-ports**,**--dports** *port*[**,***port*|**,***port***:***port*]...

  Match if the destination port is one of the given ports. The flag**--dports**is a convenient alias for this option.

- [**!**] **--ports** *port*[**,***port*|**,***port***:***port*]...

  Match if either the source or destination ports are equal to one ofthe given ports.

 

### owner

This module attempts to match various characteristics of the packet creator,for locally generated packets. This match is only valid in the OUTPUT andPOSTROUTING chains. Forwarded packets do not have any socket associated withthem. Packets from kernel threads do have a socket, but usually no owner.

- [**!**] **--uid-owner** *username*

- [**!**] **--uid-owner** *userid*[**-***userid*]

  Matches if the packet socket's file structure (if it has one) is owned by thegiven user. You may also specify a numerical UID, or an UID range.

- [**!**] **--gid-owner** *groupname*

- [**!**] **--gid-owner** *groupid*[**-***groupid*]

  Matches if the packet socket's file structure is owned by the given group.You may also specify a numerical GID, or a GID range.

- [**!**] **--socket-exists**

  Matches if the packet is associated with a socket.

 

### physdev

This module matches on the bridge port input and output devices enslavedto a bridge device. This module is a part of the infrastructure that enablesa transparent bridging IP firewall and is only useful for kernel versionsabove version 2.5.44.

- [**!**] **--physdev-in** *name*

  Name of a bridge port via which a packet is received (only forpackets entering the**INPUT**,**FORWARD**and**PREROUTING**chains). If the interface name ends in a "+", then anyinterface which begins with this name will match. If the packet didn't arrivethrough a bridge device, this packet won't match this option, unless '!' is used.

- [**!**] **--physdev-out** *name*

  Name of a bridge port via which a packet is going to be sent (for packetsentering the**FORWARD**,**OUTPUT**and**POSTROUTING**chains). If the interface name ends in a "+", then anyinterface which begins with this name will match. Note that in the**nat** and **mangle****OUTPUT**chains one cannot match on the bridge output port, however one can in the**filter OUTPUT**chain. If the packet won't leave by a bridge device or if it is yet unknown whatthe output device will be, then the packet won't match this option,unless '!' is used.

- [**!**] **--physdev-is-in**

  Matches if the packet has entered through a bridge interface.

- [**!**] **--physdev-is-out**

  Matches if the packet will leave through a bridge interface.

- [**!**] **--physdev-is-bridged**

  Matches if the packet is being bridged and therefore is not being routed.This is only useful in the FORWARD and POSTROUTING chains.

 

### pkttype

This module matches the link-layer packet type.

- [**!**] **--pkt-type** {**unicast**|**broadcast**|**multicast**}


 

### policy

This modules matches the policy used by IPsec for handling a packet.

- **--dir** {**in**|**out**}

  Used to select whether to match the policy used for decapsulation or thepolicy that will be used for encapsulation.**in**is valid in the**PREROUTING, INPUT and FORWARD**chains,**out**is valid in the**POSTROUTING, OUTPUT and FORWARD**chains.

- **--pol** {**none**|**ipsec**}

  Matches if the packet is subject to IPsec processing.

- **--strict**

  Selects whether to match the exact policy or match if any rule ofthe policy matches the given policy.

- [**!**] **--reqid** *id*

  Matches the reqid of the policy rule. The reqid can be specified with**setkey(8)**using**unique:id**as level.

- [**!**] **--spi** *spi*

  Matches the SPI of the SA.

- [**!**] **--proto** {**ah**|**esp**|**ipcomp**}

  Matches the encapsulation protocol.

- [**!**] **--mode** {**tunnel**|**transport**}

  Matches the encapsulation mode.

- [**!**] **--tunnel-src** *addr*[**/***mask*]

  Matches the source end-point address of a tunnel mode SA.Only valid with **--mode tunnel**.

- [**!**] **--tunnel-dst** *addr*[**/***mask*]

  Matches the destination end-point address of a tunnel mode SA.Only valid with **--mode tunnel**.

- **--next**

  Start the next element in the policy specification. Can only be used with**--strict**.

 

### quota

Implements network quotas by decrementing a byte counter with eachpacket.

- **--quota** *bytes*

  The quota in bytes.

 

### rateest

The rate estimator can match on estimated rates as collected by the RATEESTtarget. It supports matching on absolute bps/pps values, comparing two rateestimators and matching on the difference between two rate estimators.

- **--rateest1** *name*

  Name of the first rate estimator.

- **--rateest2** *name*

  Name of the second rate estimator (if difference is to be calculated).

- **--rateest-delta**

  Compare difference(s) to given rate(s)

- **--rateest1-bps** *value*

- **--rateest2-bps** *value*

  Compare bytes per second.

- **--rateest1-pps** *value*

- **--rateest2-pps** *value*

  Compare packets per second.

- [**!**] **--rateest-lt**

  Match if rate is less than given rate/estimator.

- [**!**] **--rateest-gt**

  Match if rate is greater than given rate/estimator.

- [**!**] **--rateest-eq**

  Match if rate is equal to given rate/estimator.

Example: This is what can be used to route outgoing data connections from anFTP server over two lines based on the available bandwidth at the time the dataconnection was started:

\# Estimate outgoing rates

iptables -t mangle -A POSTROUTING -o eth0 -j RATEEST --rateest-name eth0--rateest-interval 250ms --rateest-ewma 0.5s

iptables -t mangle -A POSTROUTING -o ppp0 -j RATEEST --rateest-name ppp0--rateest-interval 250ms --rateest-ewma 0.5s

\# Mark based on available bandwidth

iptables -t mangle -A balance -m conntrack --ctstate NEW -m helper --helper ftp-m rateest --rateest-delta --rateest1 eth0 --rateest-bps1 2.5mbit --rateest-gt--rateest2 ppp0 --rateest-bps2 2mbit -j CONNMARK --set-mark 1

iptables -t mangle -A balance -m conntrack --ctstate NEW -m helper --helper ftp-m rateest --rateest-delta --rateest1 ppp0 --rateest-bps1 2mbit --rateest-gt--rateest2 eth0 --rateest-bps2 2.5mbit -j CONNMARK --set-mark 2

iptables -t mangle -A balance -j CONNMARK --restore-mark[ ]()

### realm

This matches the routing realm. Routing realms are used in complex routingsetups involving dynamic routing protocols like BGP.

- [**!**] **--realm** *value*[**/***mask*]

  Matches a given realm number (and optionally mask). If not a number, valuecan be a named realm from /etc/iproute2/rt_realms (mask can not be used inthat case).

 

### recent

Allows you to dynamically create a list of IP addresses and then match againstthat list in a few different ways.

For example, you can create a "badguy" list out of people attempting to connectto port 139 on your firewall and then DROP all future packets from them withoutconsidering them.

**--set**, **--rcheck**, **--update** and **--remove** aremutually exclusive.

- **--name** *name*

  Specify the list to use for the commands. If no name is given then**DEFAULT** will be used.

- [**!**] **--set**

  This will add the source address of the packet to the list. If the sourceaddress is already in the list, this will update the existing entry. This willalways return success (or failure if **!** is passed in).

- **--rsource**

  Match/save the source address of each packet in the recent list table. Thisis the default.

- **--rdest**

  Match/save the destination address of each packet in the recent list table.

- [**!**] **--rcheck**

  Check if the source address of the packet is currently in the list.

- [**!**] **--update**

  Like **--rcheck**, except it will update the "last seen" timestamp if itmatches.

- [**!**] **--remove**

  Check if the source address of the packet is currently in the list and if sothat address will be removed from the list and the rule will return true. Ifthe address is not found, false is returned.

- **--seconds** *seconds*

  This option must be used in conjunction with one of **--rcheck** or**--update**. When used, this will narrow the match to only happen when theaddress is in the list and was seen within the last given number of seconds.

- **--hitcount** *hits*

  This option must be used in conjunction with one of **--rcheck** or**--update**. When used, this will narrow the match to only happen when theaddress is in the list and packets had been received greater than or equal tothe given value. This option may be used along with **--seconds** to createan even narrower match requiring a certain number of hits within a specifictime frame. The maximum value for the hitcount parameter is given by the"ip_pkt_list_tot" parameter of the xt_recent kernel module. Exceeding thisvalue on the command line will cause the rule to be rejected.

- **--rttl**

  This option may only be used in conjunction with one of **--rcheck** or**--update**. When used, this will narrow the match to only happen when theaddress is in the list and the TTL of the current packet matches that of thepacket which hit the **--set** rule. This may be useful if you have problemswith people faking their source address in order to DoS you via this module bydisallowing others access to your site by sending bogus packets to you.

Examples:

- 

  iptables -A FORWARD -m recent --name badguy --rcheck --seconds 60 -j DROP

- 

  iptables -A FORWARD -p tcp -i eth0 --dport 139 -m recent --name badguy --set -j DROP

Steve's ipt_recent website (<http://snowman.net/projects/ipt_recent/)> also hassome examples of usage.

**/proc/net/xt_recent/\*** are the current lists of addresses and informationabout each entry of each list.

Each file in **/proc/net/xt_recent/** can be read from to see the currentlist or written two using the following commands to modify the list:

- **echo +***addr*** >/proc/net/xt_recent/DEFAULT**

  to add *addr* to the DEFAULT list

- **echo -***addr*** >/proc/net/xt_recent/DEFAULT**

  to remove *addr* from the DEFAULT list

- **echo / >/proc/net/xt_recent/DEFAULT**

  to flush the DEFAULT list (remove all entries).

The module itself accepts parameters, defaults shown:

- **ip_list_tot**=*100*

  Number of addresses remembered per table.

- **ip_pkt_list_tot**=*20*

  Number of packets per address remembered.

- **ip_list_hash_size**=*0*

  Hash table size. 0 means to calculate it based on ip_list_tot, default: 512.

- **ip_list_perms**=*0644*

  Permissions for /proc/net/xt_recent/* files.

- **ip_list_uid**=*0*

  Numerical UID for ownership of /proc/net/xt_recent/* files.

- **ip_list_gid**=*0*

  Numerical GID for ownership of /proc/net/xt_recent/* files.

 

### sctp

- [**!**] **--source-port**,**--sport** *port*[**:***port*]

- [**!**] **--destination-port**,**--dport** *port*[**:***port*]

- [**!**] **--chunk-types** {**all**|**any**|**only**} *chunktype*[**:***flags*] [...]

  The flag letter in upper case indicates that the flag is to match if set,in the lower case indicates to match if unset.Chunk types: DATA INIT INIT_ACK SACK HEARTBEAT HEARTBEAT_ACK ABORT SHUTDOWN SHUTDOWN_ACK ERROR COOKIE_ECHO COOKIE_ACK ECN_ECNE ECN_CWR SHUTDOWN_COMPLETE ASCONF ASCONF_ACKchunk type available flags DATA U B E u b e ABORT T t SHUTDOWN_COMPLETE T t(lowercase means flag should be "off", uppercase means "on")Examples:iptables -A INPUT -p sctp --dport 80 -j DROPiptables -A INPUT -p sctp --chunk-types any DATA,INIT -j DROPiptables -A INPUT -p sctp --chunk-types any DATA:Be -j ACCEPT

 

### set

This module matches IP sets which can be defined by 

ipset

(8).

- [**!**] **--match-set** *setname* *flag*[**,***flag*]...

  where flags are the comma separated list of**src**and/or**dst**specifications and there can be no more than six of them. Hence the command

- 

   iptables -A FORWARD -m set --match-set test src,dst

- 

  will match packets, for which (if the set type is ipportmap) the sourceaddress and destination port pair can be found in the specified set. Ifthe set type of the specified set is single dimension (for example ipmap),then the command will match packets for which the source address can befound in the specified set.

The option **--match-set** can be replaced by **--set** if that does not clash with an option of other extensions.

Use of -m set requires that ipset kernel support is provided. As standardkernels do not ship this currently, the ipset or Xtables-addons package needsto be installed.[ ]()

### socket

This matches if an open socket can be found by doing a socket lookup on thepacket.

 

### state

This module, when combined with connection tracking, allows access tothe connection tracking state for this packet.

- [**!**] **--state** *state*

  Where state is a comma separated list of the connection states tomatch. Possible states are**INVALID**meaning that the packet could not be identified for some reason whichincludes running out of memory and ICMP errors which don't correspond to anyknown connection,**ESTABLISHED**meaning that the packet is associated with a connection which has seenpackets in both directions,**NEW**meaning that the packet has started a new connection, or otherwiseassociated with a connection which has not seen packets in bothdirections, and**RELATED**meaning that the packet is starting a new connection, but isassociated with an existing connection, such as an FTP data transfer,or an ICMP error.

 

### statistic

This module matches packets based on some statistic condition.It supports two distinct modes settable with the 

--mode

option.

Supported options:

- **--mode** *mode*

  Set the matching mode of the matching rule, supported modes are**random**and**nth.**

- **--probability** *p*

  Set the probability from 0 to 1 for a packet to be randomlymatched. It works only with the**random**mode.

- **--every** *n*

  Match one packet every nth packet. It works only with the**nth**mode (see also the **--packet**option).

- **--packet** *p*

  Set the initial counter value (0 <= p <= n-1, default 0) for the**nth **mode.

 

### string

This modules matches a given string by using some pattern matching strategy. It requires a linux kernel >= 2.6.14.

- **--algo** {**bm**|**kmp**}

  Select the pattern matching strategy. (bm = Boyer-Moore, kmp = Knuth-Pratt-Morris)

- **--from** *offset*

  Set the offset from which it starts looking for any matching. If not passed, default is 0.

- **--to** *offset*

  Set the offset from which it starts looking for any matching. If not passed, default is the packet size.

- [**!**] **--string** *pattern*

  Matches the given pattern.

- [**!**] **--hex-string** *pattern*

  Matches the given pattern in hex notation.

 

### tcp

These extensions can be used if `--protocol tcp' is specified. Itprovides the following options:

- [**!**] **--source-port**,**--sport** *port*[**:***port*]

  Source port or port range specification. This can either be a servicename or a port number. An inclusive range can also be specified,using the format *first***:***last*.If the first port is omitted, "0" is assumed; if the last is omitted,"65535" is assumed.If the first port is greater than the second one they will be swapped.The flag**--sport**is a convenient alias for this option.

- [**!**] **--destination-port**,**--dport** *port*[**:***port*]

  Destination port or port range specification. The flag**--dport**is a convenient alias for this option.

- [**!**] **--tcp-flags** *mask* *comp*

  Match when the TCP flags are as specified. The first argument *mask* is theflags which we should examine, written as a comma-separated list, andthe second argument *comp* is a comma-separated list of flags which must beset. Flags are:**SYN ACK FIN RST URG PSH ALL NONE**.Hence the command` iptables -A FORWARD -p tcp --tcp-flags SYN,ACK,FIN,RST SYN`will only match packets with the SYN flag set, and the ACK, FIN andRST flags unset.

- [**!**] **--syn**

  Only match TCP packets with the SYN bit set and the ACK,RST and FIN bitscleared. Such packets are used to request TCP connection initiation;for example, blocking such packets coming in an interface will preventincoming TCP connections, but outgoing TCP connections will beunaffected.It is equivalent to **--tcp-flags SYN,RST,ACK,FIN SYN**.If the "!" flag precedes the "--syn", the sense of theoption is inverted.

- [**!**] **--tcp-option** *number*

  Match if TCP option set.

 

### tcpmss

This matches the TCP MSS (maximum segment size) field of the TCP header. You can only use this on TCP SYN or SYN/ACK packets, since the MSS is only negotiated during the TCP handshake at connection startup time.

- [**!**] **--mss** *value*[**:***value*]

  Match a given TCP MSS value or range.

 

### time

This matches if the packet arrival time/date is within a given range. Alloptions are optional, but are ANDed when specified.

- **--datestart** *YYYY*[**-***MM*[**-***DD*[**T***hh*[**:***mm*[**:***ss*]]]]]

- **--datestop** *YYYY*[**-***MM*[**-***DD*[**T***hh*[**:***mm*[**:***ss*]]]]]

- 

  Only match during the given time, which must be in ISO 8601 "T" notation.The possible time range is 1970-01-01T00:00:00 to 2038-01-19T04:17:07.

- 

  If --datestart or --datestop are not specified, it will default to 1970-01-01and 2038-01-19, respectively.

- **--timestart** *hh***:***mm*[**:***ss*]

- **--timestop** *hh***:***mm*[**:***ss*]

- 

  Only match during the given daytime. The possible time range is 00:00:00 to23:59:59. Leading zeroes are allowed (e.g. "06:03") and correctly interpretedas base-10.

- [**!**] **--monthdays** *day*[**,***day*...]

- 

  Only match on the given days of the month. Possible values are **1**to **31**. Note that specifying **31** will of course not matchon months which do not have a 31st day; the same goes for 28- or 29-dayFebruary.

- [**!**] **--weekdays** *day*[**,***day*...]

- 

  Only match on the given weekdays. Possible values are **Mon**, **Tue**,**Wed**, **Thu**, **Fri**, **Sat**, **Sun**, or values from **1**to **7**, respectively. You may also use two-character variants (**Mo**,**Tu**, etc.).

- **--utc**

- 

  Interpret the times given for **--datestart**, **--datestop**,**--timestart** and **--timestop** to be UTC.

- **--localtz**

- 

  Interpret the times given for **--datestart**, **--datestop**,**--timestart** and **--timestop** to be local kernel time. (Default)

EXAMPLES. To match on weekends, use:

- 

  -m time --weekdays Sa,Su

Or, to match (once) on a national holiday block:

- 

  -m time --datestart 2007-12-24 --datestop 2007-12-27

Since the stop time is actually inclusive, you would need the following stoptime to not match the first second of the new day:

- 

  -m time --datestart 2007-01-01T17:00 --datestop 2007-01-01T23:59:59

During lunch hour:

- 

  -m time --timestart 12:30 --timestop 13:30

The fourth Friday in the month:

- 

  -m time --weekdays Fr --monthdays 22,23,24,25,26,27,28

(Note that this exploits a certain mathematical property. It is not possible tosay "fourth Thursday OR fourth Friday" in one rule. It is possible withmultiple rules, though.)[ ]()

### tos

This module matches the 8-bit Type of Service field in the IPv4 header (i.e.including the "Precedence" bits) or the (also 8-bit) Priority field in the IPv6header.

- [**!**] **--tos** *value*[**/***mask*]

  Matches packets with the given TOS mark value. If a mask is specified, it islogically ANDed with the TOS mark before the comparison.

- [**!**] **--tos** *symbol*

  You can specify a symbolic name when using the tos match for IPv4. The list ofrecognized TOS names can be obtained by calling iptables with **-m tos -h**.Note that this implies a mask of 0x3F, i.e. all but the ECN bits.

 

### ttl

This module matches the time to live field in the IP header.

- **--ttl-eq** *ttl*

  Matches the given TTL value.

- **--ttl-gt** *ttl*

  Matches if TTL is greater than the given TTL value.

- **--ttl-lt** *ttl*

  Matches if TTL is less than the given TTL value.

 

### u32

U32 tests whether quantities of up to 4 bytes extracted from a packet havespecified values. The specification of what to extract is general enough tofind data at given offsets from tcp headers or payloads.

- [**!**] **--u32** *tests*

  The argument amounts to a program in a small language described below.

- 

  tests := location "=" value | tests "&&" location "=" value

- 

  value := range | value "," range

- 

  range := number | number ":" number

a single number, *n*, is interpreted the same as *n:n*. *n:m* isinterpreted as the range of numbers **>=n** and **<=m**.

- 

  location := number | location operator number

- 

  operator := "&" | "<<" | ">>" | "@"

The operators **&**, **<<**, **>>** and **&&** mean the same as in C.The **=** is really a set membership operator and the value syntax describesa set. The **@** operator is what allows moving to the next header and isdescribed further below.

There are currently some artificial implementation limits on the size of thetests:

- *

  no more than 10 of "**=**" (and 9 "**&&**"s) in the u32 argument

- *

  no more than 10 ranges (and 9 commas) per value

- *

  no more than 10 numbers (and 9 operators) per location

To describe the meaning of location, imagine the following machine thatinterprets it. There are three registers:

- 

  A is of type **char \***, initially the address of the IP header

- 

  B and C are unsigned 32 bit integers, initially zero

The instructions are:

- 

  number B = number;

- 

  C = (*(A+B)<<24) + (*(A+B+1)<<16) + (*(A+B+2)<<8) + *(A+B+3)

- 

  &number C = C & number

- 

  << number C = C << number

- 

  >> number C = C >> number

- 

  @number A = A + C; then do the instruction number

Any access of memory outside [skb->data,skb->end] causes the match to fail.Otherwise the result of the computation is the final value of C.

Whitespace is allowed but not required in the tests. However, the charactersthat do occur there are likely to require shell quoting, so it is a good ideato enclose the arguments in quotes.

Example:

- 

  match IP packets with total length >= 256

- 

  The IP header contains a total length field in bytes 2-3.

- 

  --u32 "**0 & 0xFFFF = 0x100:0xFFFF**"

- 

  read bytes 0-3

- 

  AND that with 0xFFFF (giving bytes 2-3), and test whether that is in the range[0x100:0xFFFF]

Example: (more realistic, hence more complicated)

- 

  match ICMP packets with icmp type 0

- 

  First test that it is an ICMP packet, true iff byte 9 (protocol) = 1

- 

  --u32 "**6 & 0xFF = 1 &&** ...

- 

  read bytes 6-9, use **&** to throw away bytes 6-8 and compare the result to1. Next test that it is not a fragment. (If so, it might be part of such apacket but we cannot always tell.) N.B.: This test is generally needed if youwant to match anything beyond the IP header. The last 6 bits of byte 6 and allof byte 7 are 0 iff this is a complete packet (not a fragment). Alternatively,you can allow first fragments by only testing the last 5 bits of byte 6.

- 

   ... **4 & 0x3FFF = 0 &&** ...

- 

  Last test: the first byte past the IP header (the type) is 0. This is where wehave to use the @syntax. The length of the IP header (IHL) in 32 bit words isstored in the right half of byte 0 of the IP header itself.

- 

   ... **0 >> 22 & 0x3C @ 0 >> 24 = 0**"

- 

  The first 0 means read bytes 0-3, **>>22** means shift that 22 bits to theright. Shifting 24 bits would give the first byte, so only 22 bits is fourtimes that plus a few more bits. **&3C** then eliminates the two extra bitson the right and the first four bits of the first byte. For instance, if IHL=5,then the IP header is 20 (4 x 5) bytes long. In this case, bytes 0-1 are (inbinary) xxxx0101 yyzzzzzz, **>>22** gives the 10 bit value xxxx0101yy and**&3C** gives 010100. **@** means to use this number as a new offset intothe packet, and read four bytes starting from there. This is the first 4 bytesof the ICMP payload, of which byte 0 is the ICMP type. Therefore, we simplyshift the value 24 to the right to throw out all but the first byte and comparethe result with 0.

Example:

- 

  TCP payload bytes 8-12 is any of 1, 2, 5 or 8

- 

  First we test that the packet is a tcp packet (similar to ICMP).

- 

  --u32 "**6 & 0xFF = 6 &&** ...

- 

  Next, test that it is not a fragment (same as above).

- 

   ... **0 >> 22 & 0x3C @ 12 >> 26 & 0x3C @ 8 = 1,2,5,8**"

- 

  **0>>22&3C** as above computes the number of bytes in the IP header. **@**makes this the new offset into the packet, which is the start of the TCPheader. The length of the TCP header (again in 32 bit words) is the left halfof byte 12 of the TCP header. The **12>>26&3C** computes this length in bytes(similar to the IP header before). "@" makes this the new offset, which is thestart of the TCP payload. Finally, 8 reads bytes 8-12 of the payload and**=** checks whether the result is any of 1, 2, 5 or 8.

 

### udp

These extensions can be used if `--protocol udp' is specified. Itprovides the following options:

- [**!**] **--source-port**,**--sport** *port*[**:***port*]

  Source port or port range specification.See the description of the**--source-port**option of the TCP extension for details.

- [**!**] **--destination-port**,**--dport** *port*[**:***port*]

  Destination port or port range specification.See the description of the**--destination-port**option of the TCP extension for details.

 

### unclean

This module takes no options, but attempts to match packets which seemmalformed or unusual. This is regarded as experimental.

 

## TARGET EXTENSIONS

iptables can use extended target modules: the following are includedin the standard distribution.

 

### CLASSIFY

This module allows you to set the skb->priority value (and thus classify the packet into a specific CBQ class).

- **--set-class** *major***:***minor*

  Set the major and minor class value. The values are always interpreted ashexadecimal even if no 0x prefix is given.

 

### CLUSTERIP

This module allows you to configure a simple cluster of nodes that s



