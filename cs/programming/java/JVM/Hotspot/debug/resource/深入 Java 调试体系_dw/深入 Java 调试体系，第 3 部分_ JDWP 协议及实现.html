<!DOCTYPE html>
<!-- saved from url=(0064)https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html -->
<html lang="zh-CN" class="applicationcache geolocation history postmessage svg websockets localstorage sessionstorage websqldatabase webworkers hashchange pointerevents canvas audio canvastext video webgl cssgradients multiplebgs opacity rgba inlinesvg hsla supports svgclippaths smil no-touchevents fontface generatedcontent textshadow cssanimations backgroundsize borderimage borderradius boxshadow csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox flexboxlegacy cssreflections csstransforms csstransforms3d csstransitions indexeddb indexeddb-deletedatabase hires js mac chrome chrome5 webkit webkit5 ibm-grid-xlarge greater-china-imt"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
<meta name="viewport" content="width=device-width, initial-scale=1">      
<link rel="icon" href="https://www.ibm.com/favicon.ico">
<link rel="canonical" href="http://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html">
<meta name="geo.country" content="CN">
<meta name="dcterms.rights" content="© Copyright IBM Corporation 2009">
<meta name="dcterms.date" content="2009-09-03">
<meta name="description" content="JPDA(Java Platform Debugger Architecture) 是 Java 平台调试体系结构的缩写，通过 JPDA 提供的 API，开发人员可以方便灵活的搭建 Java 调试应用程序。JPDA 主要由三个部分组成：Java 虚拟机工具接口（JVMTI），Java 调试线协议（JDWP），以及 Java 调试接口（JDI），本系列将会详细介绍这三个模块的内部细节、通过实例为读者揭开 JPDA 的面纱。本文是该系列的第三篇，将会详细介绍 JDWP 的协议细节，并通过实际调试中的例子展开揭示 JDWP 的实现机制。">	
<meta name="keywords" content="java,jpda,jdwp,jdi,jvmti, 调试, tttjca">
<meta name="robots" content="index,follow">
<title>深入 Java 调试体系，第 3 部分: JDWP 协议及实现</title>
    
<script type="text/javascript" async="" charset="utf-8" id="ebOneTagUrlId" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/ebOneTag.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_27" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/up_loader.1.1.0.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_53" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/js"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_cormetrics2" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/eluminate.js"></script><script type="text/javascript" async="" charset="utf-8" id="dle_api_adcbae27150f560a4411f98c2a20682d46997c82dfd048aee7f26577beaecffb" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/p_adcbae27150f560a4411f98c2a20682d46997c82dfd048aee7f26577beaecffb.js"></script><script type="text/javascript" async="" defer="" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/piwik.js"></script><script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/utag.js" type="text/javascript" async=""></script><script> 
    digitalData = {
        "page":{
            "category":{
                "primaryCategory":"SOFDCJVACN"
            },
            "pageInfo":{
                "effectiveDate":"2009-09-03",
                "language":"zh-CN",
                "publishDate":"2009-09-03",
                "publisher":"IBM Corporation",
                "version":"v18",
                "ibm":{ 
                    "contentDelivery":"IBM developerWorks template",
                    "contentProducer":"IBM developerWorks",
                    "country":"CN",
                    "owner":"developerWorks/China/IBM",
                    "subject":"TT300",
                    "type":"CT316",
                    "topic":"调试",
                    "topicId":"27",
                    "contentArea":"java",
                    "contentAreaId":"1",
                    "contentType":"article",
                    "contentId":"425507",
                },
                "keywords":"java,jpda,jdwp,jdi,jvmti, 调试, tttjca",
                "description":"JPDA(Java Platform Debugger Architecture) 是 Java 平台调试体系结构的缩写，通过 JPDA 提供的 API，开发人员可以方便灵活的搭建 Java 调试应用程序。JPDA 主要由三个部分组成：Java 虚拟机工具接口（JVMTI），Java 调试线协议（JDWP），以及 Java 调试接口（JDI），本系列将会详细介绍这三个模块的内部细节、通过实例为读者揭开 JPDA 的面纱。本文是该系列的第三篇，将会详细介绍 JDWP 的协议细节，并通过实际调试中的例子展开揭示 JDWP 的实现机制。"
            }
        }
    };
    window._analytics = {
        "segment_key":'HU3dbkAG5wE0F1IkRf9S1RexlAqo3jby'
    };
</script>
	
    <meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@developerworks">
<meta property="og:title" content="JDWP 协议及实现">
<meta property="og:description" content="JPDA(Java Platform Debugger Architecture) 是 Java 平台调试体系结构的缩写，通过 JPDA 提供的 API，开发人员可以方便灵活的搭建 Java 调试应用程序。JPDA 主要由三个部分组成：Java 虚拟机工具接口（JVMTI），Java 调试线协议（JDWP），以及 Java 调试接口（JDI），本系列将会详细介绍这三个模块的内部细节、通过实例为读者揭开 JPDA 的面纱。本文是该系列的第三篇，将会详细介绍 JDWP 的协议细节，并通过实际调试中的例子展开揭示 JDWP 的实现机制。">
    <meta property="og:image" content="http://www.ibm.com/developerworks/i/dw-social-201508.png">
<!-- Segment meta tag -->
<meta name="segment" property="Java Chinese (developerWorks)" producttitle="developerWorks" value="深入 Java 调试体系，第 3 部分: JDWP 协议及实现">
<!-- SITE MON : START (DO NOT DELETE) -->
<!-- developerWorks monitoring token -->
<!-- SITE MON : END (DO NOT DELETE) -->

<!-- HEADER_SCRIPTS_AND_CSS_INCLUDE -->
<!-- <script src="//cdn.optimizely.com/js/5399420604.js"></script> -->
<!-- BEGIN: Use this section to set page specific variables for the Page Tag -->
<script language="JavaScript">var NTPT_PGEXTRA="ibmSkillLevel=3&ibmCmaId=425507&ibmContentAreas=java";</script>
<!--END -->
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/ida_stats.js"></script>
<link href="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/www.css" rel="stylesheet">
<link href="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/syntaxhighlighter.css" rel="stylesheet">
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/www.js"></script><style></style>
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/syntaxhighlighter.js"></script>    
<link href="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/tables.css" rel="stylesheet">
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/tables.js"></script>   
<!--  Masthead/footer  -->
<link href="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-mf-v18.css" rel="stylesheet">
<!-- <link href="//dw1.s81c.com/developerworks/css/dw-mf/v18/alt-signedin-ux.css" rel="stylesheet" /> -->   
<!--[if lt IE 9]>
    <link href="//dw1.s81c.com/developerworks/css/dw-mf/v18/dw-mf-ie8fix.css?v=022216" rel="stylesheet" />
<![endif]-->
<link href="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-article.css" rel="stylesheet">
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-auth-properties.js"></script>
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-auth.js"></script>
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-mf.js"></script>
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-auto-links.js"></script> 
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-include.js"></script>     
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-article.js"></script>
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/tactic.js"></script>
<script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/tacticbindlinks.js"></script>

<!-- 
<PageMap>
    <DataObject type="document">
        <Attribute name="topic">调试</Attribute>
        <Attribute name="topicId">27</Attribute>
        <Attribute name="contentArea">java</Attribute>
        <Attribute name="contentAreaId">1</Attribute>
        <Attribute name="abstract">JPDA(Java Platform Debugger Architecture) 是 Java 平台调试体系结构的缩写，通过 JPDA 提供的 API，开发人员可以方便灵活的搭建 Java 调试应用程序。JPDA 主要由三个部分组成：Java 虚拟机工具接口（JVMTI），Java 调试线协议（JDWP），以及 Java 调试接口（JDI），本系列将会详细介绍这三个模块的内部细节、通过实例为读者揭开 JPDA 的面纱。本文是该系列的第三篇，将会详细介绍 JDWP 的协议细节，并通过实际调试中的例子展开揭示 JDWP 的实现机制。</Attribute>
        <Attribute name="pub.date">2009-09-03</Attribute>
        <Attribute name="contentType">article</Attribute>
    </DataObject>
</PageMap>
-->        

<style id="ibm-masthead-hidelinks">@media screen and (max-width: 557px) { .ibm-masthead-categories,#ibm-megamenu-sections{display:none} }@media screen and (max-width: 557px) { .ibm-mh-marketplace-link{display:none} }</style><style id="ibm-sitenav-menu-hidelinks">@media screen and (max-width: 602px) { .ibm-sitenav-menu-list{display:none} } @media screen and (min-width: 603px) { .ibm-mobilemenu-sitenavmenu {display:none} }</style><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_53" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/utag.53.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_44" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/utag.44.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_46" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/utag.46.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_45" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/utag.45.js"></script><style type="text/css" class="jquery-comments-css">.jquery-comments ul.navigation li.active:after {background: #2793e6 !important;</style><style type="text/css" class="jquery-comments-css">.jquery-comments ul.navigation ul.dropdown li.active {background: #2793e6 !important;</style><style type="text/css" class="jquery-comments-css">.jquery-comments .highlight-background {background: #2793e6 !important;</style><style type="text/css" class="jquery-comments-css">.jquery-comments .highlight-font {color: #2793e6 !important;}</style><style type="text/css" class="jquery-comments-css">.jquery-comments .highlight-font-bold {color: #2793e6 !important;font-weight: bold;}</style><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_27" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/utag.27.js"></script><script type="text/javascript" async="" charset="utf-8" id="LOTCC_10026" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/cc.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_52" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/utag.52.js"></script><script language="javascript" type="text/javascript" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/50200000.js"></script><script language="javascript" type="text/javascript" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/rules_50200000.js"></script><script language="javascript" type="text/javascript" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dispatcher-v3.js"></script><script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/yahoo-min.js" type="text/javascript"></script><script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/cp-v3.js" type="text/javascript"></script><script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/json-min.js" type="text/javascript"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_visitor_service_45main" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/015a6a839457000d606a0ffb81ed04078006807000bd0"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_visitor_service_45main" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/015a6a839457000d606a0ffb81ed04078006807000bd0(1)"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_visitor_service_45main" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/015a6a839457000d606a0ffb81ed04078006807000bd0(2)"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_visitor_service_45main" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/015a6a839457000d606a0ffb81ed04078006807000bd0(3)"></script></head>
<body id="ibm-com" class="ibm-type ibm-sitenav-menu ibm-sitenav-menu-sticky ibm-masthead-sticky">
	
<div id="ibm-top" class="ibm-landing-page dw-sitenav">

<!-- MASTHEAD_BEGIN -->
<div id="ibm-masthead" role="banner" aria-label="IBM" class="ibm-mhtype-minimal hastransition">
    <div id="ibm-universal-nav" class="">    
  
        <nav role="navigation" aria-label="IBM">
            <div id="ibm-home"><a href="https://www.ibm.com/cn/zh/?lnk=m">IBM®</a></div>
            <ul id="ibm-menu-links" role="toolbar" aria-label="Site map" class="ibm-hide">
                <li><a href="https://www.ibm.com/sitemap/cn/zh/">站点地图</a></li>
            </ul><div class="ibm-masthead-rightside"><p class="ibm-mh-marketplace-link ibm-button-link ibm-fleft ibm-padding-bottom-0"><a class="ibm-btn-small ibm-btn-sec ibm-btn-blue-50" href="http://www.ibm.com/marketplace/?lnk=mp">市场</a></p><div id="ibm-search-module" role="search" aria-labelledby="ibm-masthead" class="ibm-has-scope">
            <div class="ibm-masthead-search-close"><p class="ibm-ind-link ibm-icononly ibm-padding-bottom-0"><a href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#" class="ibm-close-link ibm-nospacing">关闭</a></p></div><form id="ibm-search-form" action="https://www.ibm.com/Search/" method="get">
                <p>
                    <label for="q">IBM</label>
                    <input type="text" maxlength="100" value="" placeholder="搜索" name="q" id="q" aria-label="搜索 developerWorks" autocomplete="off" role="combobox" aria-autocomplete="list" aria-expanded="true" aria-owns="ibm-search-typeahead-container"><input name="lnk" type="hidden" value="mhsrch">
                    <input type="hidden" value="18" name="v">
                    <input type="hidden" value="utf" name="en">
                    <input type="hidden" value="zh" name="lang">
                    <input type="hidden" value="cn" name="cc">
                    <input type="hidden" name="sn" value="dw">
                    <input type="hidden" name="dws" value="cndw">
                    <input type="hidden" name="hpp" value="20">
                    <span class="ibm-search-scope ibm-fadeout"><input class="ibm-styled-checkbox" data-init="false" type="checkbox" name="sn" value="" id="ibm-mh-scopeoption"> <label for="ibm-mh-scopeoption">In Marketplace</label></span><button role="button" type="submit" id="ibm-search" class="ibm-search-link" value="提交"><span class="ibm-access">提交</span></button>
                </p>
            </form><form class="ibm-hide" id="ibm-default-scope-form" action="https://www.ibm.com/marketplace/search/cn/zh-cn/" method="get"><input name="terms" type="text"><input name="lnk" type="hidden" value="mhmpsrch"></form>
        </div><div id="ibm-search-typeahead-container" class="ibm-search-typeahead-container ibm-fadeout"></div><ul aria-label="Tools" role="menubar" class="ibm-masthead-iconsonly"><li role="presentation" class="ibm-masthead-item-signin"><button role="menubutton" class="ibm-profile-link">我的 IBM</button><ul id="ibm-signin-minimenu-container" role="menu" aria-label="Profile" class="ibm-dropdown-menu">		<li class="ibm-dropdown-menu-primary" role="presentation" data-linktype="notifications"> 			<a class="" href="https://myibm.ibm.com/dashboard/?lnk=mmi" tabindex="0">我的 IBM</a> 		</li>		<li class="ibm-dropdown-menu-primary menu-heading" role="presentation">				<span tabindex="0">developerWorks</span>			</li>		<li class="ibm-dropdown-menu-primary ibm-signin-alt" role="presentation">			<a href="https://www.ibm.com/developerworks/dwwi/jsp/ssologin.jsp?d=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jpda3%2Findex.html&amp;lang=zh&amp;a=dwmav" role="menuitem">登录</a>		</li>		<li class="ibm-dropdown-menu-primary dw-register-alt" role="presentation">			<a href="https://www.ibm.com/developerworks/dwwi/jsp/ssoregister.jsp?d=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jpda3%2Findex.html&amp;lang=zh&amp;a=dwmav" role="menuitem">注册</a>		</li></ul></li><li role="presentation" class="ibm-masthead-item-menu"><button role="menubutton" class="ibm-menu-link">站点导航</button></li></ul></div> 
        </nav>
  
        
       
    </div>
</div><div class="ibm-mobilemenu ibm-hide" aria-labelledby="ibm-burgermenu-a11y" role="dialog" tabindex="0"><p class="ibm-hide" id="ibm-burgermenu-a11y">站点导航</p><div class="ibm-mobilemenu-close"><p class="ibm-icononly ibm-fright ibm-ind-link ibm-nospacing"><a class="ibm-close-link" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html?lnk=hm#">关闭</a></p></div><div class="ibm-mobilemenu-section ibm-mobilemenu-sitenavmenu"><ul role="menubar"><li class="ibm-mobile-section-heading ibm-mobile-sitename">
        <a href="https://www.ibm.com/developerworks/cn/?lnk=hm">
            <img width="186" height="24" alt="developerWorks®" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-mf-wordmark.svg">
        </a>
    </li>
                            <li class="dw-navpage-learn" role="presentation">
                    <a href="https://www.ibm.com/developerworks/cn/topics/?lnk=hm" role="menuitem" tabindex="0">学习</a>
                </li>
                    
                <li class="dw-navpage-develop" role="presentation">
                    <a href="https://www.ibm.com/developerworks/cn/downloads/?lnk=hm" role="menuitem" tabindex="-1">开发</a>
                </li>                    

                <li class="dw-navpage-connect" role="presentation">
                    <a href="https://www.ibm.com/developerworks/cn/community/?lnk=hm" role="menuitem" tabindex="-1">社区</a>
                </li>  
        </ul></div><div class="ibm-mobilemenu-section"><ul class="ibm-mobilemenu-mhlinks" aria-label="发现 IBM"><li><a href="http://www.ibm.com/marketplace/?lnk=hmmp">市场</a></li><li><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2><a href="javascript:void();">产品</a></h2><div class="ibm-container-body" style="display: none;"><ul><li><a href="https://www.ibm.com/products/cn/zh/?lnk=hmhmpr_cnzh"><span>所有产品</span></a></li><li><a href="https://www.ibm.com/analytics/cn/zh/?lnk=hmmpr_bua_cnzh&amp;lnk2=learn"><span>大数据与分析</span></a></li><li><a href="https://www.ibm.com/cloud-computing/cn/zh?lnk=hmmpr_bucl_cnzh&amp;lnk2=learn"><span>云计算</span></a></li><li><a href="https://www.ibm.com/ibm/cn/cognitive/outthink/?lnk=hmmpr_buce_cnzh&amp;lnk2=learn"><span>认知</span></a></li><li><a href="https://www.ibm.com/commerce/cn-zh/?lnk=hmmpr_bucom_cnzh&amp;lnk2=learn"><span>商务</span></a></li><li><a href="https://www.ibm.com/internet-of-things/cn-zh/?lnk=hmmpr_iot_cnzh&amp;lnk2=learn"><span>物联网</span></a></li><li><a href="https://www.ibm.com/solutions/cn/zh/index.html?lnk=hm"><span>行业解决方案</span></a></li><li><a href="https://www.ibm.com/it-infrastructure/cn-zh/?lnk=hmmpr_buit_cnzh&amp;lnk2=learn"><span>IT 基础架构</span></a></li><li><a href="https://www.ibm.com/mobilefirst/cn/zh/?lnk=hmmpr_bumf_cnzh&amp;lnk2=learn"><span>移动</span></a></li><li><a href="https://www.ibm.com/security/cn-zh/?lnk=hmmpr_buse_cnzh&amp;lnk2=learn"><span>安全</span></a></li><li><a href="https://www.ibm.com/social-business/cn-zh/?lnk=hm"><span>社交协作与人才管理</span></a></li><li><a href="https://www.ibm.com/services/cn/zh/watson/explorer.html?lnk=hm"><span>Watson</span></a></li></ul></div></div></li><li><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2><a href="javascript:void();">服务</a></h2><div class="ibm-container-body" style="display: none;"><ul><li><a href="https://www.ibm.com/services/cn/gbs/consulting/?lnk=hmmse_bc_cnzh&amp;lnk2=learn"><span>业务咨询</span></a></li><li><a href="https://www.ibm.com/technologyservices/cn/zh/?lnk=hmmse_ts_cnzh&amp;lnk2=learn"><span>技术服务</span></a></li><li><a href="https://www.ibm.com/financing/cn/zh/index.html?lnk=hmmse_fin_cnzh&amp;lnk2=learn"><span>融资</span></a></li><li><a href="https://www.ibm.com/solutions/cn/zh/index.html?lnk=hm"><span>行业解决方案</span></a></li><li><a href="https://www.ibm.com/training/?lnk=hm"><span>培训与技能 (US)</span></a></li></ul></div></div></li><li><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2><a href="javascript:void();">开发人员</a></h2><div class="ibm-container-body" style="display: none;"><ul><li><a href="https://www.ibm.com/developerworks/cn/?lnk=hmmdev_dw_cnzh&amp;lnk2=learn"><span>developerWorks</span></a></li><li><a href="https://www.ibm.com/partnerworld?lnk=hmmdev_pw_cnzh&amp;lnk2=learn"><span>PartnerWorld</span></a></li></ul></div></div></li><li><a href="https://www.ibm.com/support/cn/zh/?lnk=hmmsu_cnzh">支持</a></li><li><a href="https://www.ibm.com/employment/cn/?lnk=hmmca_cnzh">工作机会</a></li></ul></div></div><div class="ibm-mhplaceholder"></div><!-- MASTHEAD_END -->
	    
<!-- LAYOUT -->
<div id="ibm-content-wrapper">
    <!-- LEADSPACE_BEGIN -->
    <header role="banner" aria-labelledby="ibm-pagetitle-h1">
        
        <!-- MASTHEAD_SITENAV_BEGIN -->
        <div class="ibm-sitenav-menu-container" data-widgetprocessed="true">
    <div class="ibm-sitenav-menu-name">
        <a href="https://www.ibm.com/developerworks/cn/">
            <img width="186" height="24" alt="developerWorks®" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-mf-wordmark.svg">
        </a>
    </div>
    <div class="ibm-sitenav-menu-list">
        <ul role="menubar">
                            <li class="dw-navpage-learn" role="presentation">
                    <a href="https://www.ibm.com/developerworks/cn/topics/" role="menuitem" tabindex="0">学习</a>
                </li>
                    
                <li class="dw-navpage-develop" role="presentation">
                    <a href="https://www.ibm.com/developerworks/cn/downloads/" role="menuitem" tabindex="-1">开发</a>
                </li>                    

                <li class="dw-navpage-connect" role="presentation">
                    <a href="https://www.ibm.com/developerworks/cn/community/" role="menuitem" tabindex="-1">社区</a>
                </li>  
        </ul>
    </div>
</div>        <!-- MASTHEAD_SITENAV_END -->
        
        <!-- NAVIGATION_TRAIL_BEGIN -->
        <div id="ibm-leadspace-head" class="ibm-alternate">
            <div id="ibm-leadspace-body">
                <nav aria-label="Breadcrumb" role="navigation">                     
                            <ul id="dw-navigation-trail" itemscope="" itemtype="http://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="http://www.ibm.com/developerworks/cn/topics/"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="http://www.ibm.com/developerworks/cn/java/"><span itemprop="name">Java technology</span></a><meta itemprop="position" content="2"></li></ul>
                </nav>
            </div>
        </div>
        <!-- NAVIGATION_TRAIL_END -->
        
    </header>
    <!-- LEADSPACE_END -->
    
    <!-- MAIN_CONTENT_BEGIN -->
    <main role="main" aria-label=""> 
        <div id="ibm-pcon">
            <!-- BEGIN_IBM-CONTENT -->
            <div id="ibm-content">
                <!-- BEGIN_IBM-CONTENT-BODY -->
                <div id="ibm-content-body">
                    <!-- BEGIN_IBM-CONTENT-MAIN -->
                    <div id="ibm-content-main" class="dw-article">                        
                        <!-- BEGIN_INTERIOR-COLUMNS -->
                                <div class="ibm-columns dw-article-toc">
                                    <!-- LEFT_6_2_CONTENT_COLUMN_BEGIN -->  
                                    <div id="dw-article-toc-container" class="ibm-col-6-2">
                                        <div id="dw-article-toc-body" data-widget="scrollable" data-height="502" style="width: 380px; height: 502px;" class=""><div class="nano-content" tabindex="-1">
                                            <h2>内容</h2><div class="ibm-alternate-rule"><hr></div><ul role="directory" aria-label="内容" class="ibm-plain-list"><li class=""><a onclick="tocLink(&#39;#ibm-pagetitle-h1&#39;)" role="link" tabindex="0">概览</a></li><li class=""><a onclick="tocLink(&#39;#major1&#39;)" role="link" tabindex="0">JDWP 协议介绍</a></li><li class="dw-highlight"><a onclick="tocLink(&#39;#major2&#39;)" role="link" tabindex="0">协议分析</a></li><li><a onclick="tocLink(&#39;#major3&#39;)" role="link" tabindex="0">Packet 的结构</a></li><li><a onclick="tocLink(&#39;#major4&#39;)" role="link" tabindex="0">JDWP 传输接口（Java Debug Wire Protocol Transport Interface）</a></li><li><a onclick="tocLink(&#39;#major5&#39;)" role="link" tabindex="0">JDWP 的命令实现机制</a></li><li><a onclick="tocLink(&#39;#major6&#39;)" role="link" tabindex="0">JDWP 的事件处理机制</a></li><li><a onclick="tocLink(&#39;#major7&#39;)" role="link" tabindex="0">结语</a></li><li><a onclick="tocLink(&#39;#artrelatedtopics&#39;)" role="link" tabindex="0">相关主题</a></li><li><a onclick="tocLink(&#39;#icomments&#39;)" role="link" tabindex="0">评论</a></li></ul>
                                        </div><div class="nano-pane" style="display: none; opacity: 1; visibility: visible;"><div class="nano-slider" style="height: 502px; transform: translate(0px, 0px);"></div></div></div>
                                    </div>
                                    <!-- LEFT_6_2_CONTENT_COLUMN_END -->
                                    
                                    <!-- CENTER_6_4_CONTENT_COLUMN_BEGIN -->
                                    <div class="ibm-col-6-4">
                                            <p class="dw-article-series-head">深入 Java 调试体系，第 3 部分</p>
                                        <h1 id="ibm-pagetitle-h1" class="ibm-h1">JDWP 协议及实现</h1>
                                        <!-- Article Top Bar -->
                                                <div class="ibm-columns dw-article-topbar">
                                                    <!-- Author and article info. -->
                                                    <div class="ibm-col-6-2 ibm-col-medium-6-4 dw-article-metadata">
                                                        <div class="dw-article-authordate">虞 俊杰 和 徐 睿智<br><span class="dw-article-pubdate">2009 年 9 月 03 日发布</span></div>
                                                    </div>
                                                    <!-- Social -->
                                                    <div class="ibm-col-6-2 ibm-col-medium-6-4 ibm-col-small-6-2 dw-article-social">
                                                        <!-- Sharing links -->
                                                        <div id="dw-article-share-inline">
                                                            <div class="dw-article-sharelink-inline">
                                                                <div class="ibm-sharethispage"><h4 class="ibm-bold">分享此页面</h4><p class="ibm-icononly"><a class="ibm-weibo-encircled-link" href="http://service.weibo.com/share/share.php?url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jpda3%2Findex.html%&amp;title=%E6%B7%B1%E5%85%A5%20Java%20%E8%B0%83%E8%AF%95%E4%BD%93%E7%B3%BB%EF%BC%8C%E7%AC%AC%203%20%E9%83%A8%E5%88%86%3A%20JDWP%20%E5%8D%8F%E8%AE%AE%E5%8F%8A%E5%AE%9E%E7%8E%B0&amp;language=zh_cn" data-id="weibo" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Weibo</a><a class="ibm-googleplus-encircled-link" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jpda3%2Findex.html&amp;t=%E6%B7%B1%E5%85%A5%20Java%20%E8%B0%83%E8%AF%95%E4%BD%93%E7%B3%BB%EF%BC%8C%E7%AC%AC%203%20%E9%83%A8%E5%88%86%3A%20JDWP%20%E5%8D%8F%E8%AE%AE%E5%8F%8A%E5%AE%9E%E7%8E%B0" data-id="googleplus" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Google+</a><a class="ibm-email-encircled-link" href="mailto:?subject=%E6%B7%B1%E5%85%A5%20Java%20%E8%B0%83%E8%AF%95%E4%BD%93%E7%B3%BB%EF%BC%8C%E7%AC%AC%203%20%E9%83%A8%E5%88%86%3A%20JDWP%20%E5%8D%8F%E8%AE%AE%E5%8F%8A%E5%AE%9E%E7%8E%B0&amp;body=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jpda3%2Findex.html" data-id="email" onclick="">用电子邮件发送本页面</a></p></div>
                                                            </div>
                                                        </div>
                                                        <!-- Number of comments and link to comments -->
                                                        <div id="dw-article-cmts">
                                                            <div class="dw-article-cmtslink">
                                                                <a onclick="tocLink(&#39;#icomments&#39;)" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#icomments" role="link" tabindex="0" aria-label="Comments">
                                                                    <img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/dw-article-cmt-icon.png" width="29" height="29" alt="Comments">
                                                                </a>
                                                            </div>
                                                            <div class="dw-article-cmtslink">
                                                                <a onclick="tocLink(&#39;#icomments&#39;)" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#icomments" role="link" tabindex="0">
                                                                    <div id="nCmts">4</div>
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
<div id="dw-series-container" style="display: block;"><h3 class="ibm-h3" id="dw-series-heading">系列内容：</h3><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2 id="dw-series-show-hide"><a href="javascript:void();">此内容是该系列 <span id="dw-series-total">4</span> 部分中的第 <span id="dw-series-part">3</span> 部分： <span id="dw-series-title">深入 Java 调试体系</span></a></h2><div class="ibm-container-body" id="dw-series-links" style="display: none;"><ul id="dw-series-list"><li class="dw-series-item"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jpda1/index.html?ca=drs-" class="dw-series-article-link"> 第 1 部分，JPDA 体系概览</a></li><li class="dw-series-item"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jpda2/index.html?ca=drs-" class="dw-series-article-link">第 2 部分: JVMTI 和 Agent 实现</a></li><li class="dw-series-item">第 3 部分: JDWP 协议及实现</li><li class="dw-series-item"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jpda4/index.html?ca=drs-" class="dw-series-article-link">第 4 部分: Java 调试接口（JDI）</a></li></ul></div></div></div>
                                        <!-- Article Body -->
                                        
                                        <p>JDWP 是 Java Debug Wire Protocol 的缩写，它定义了调试器（debugger）和被调试的 Java 虚拟机（target vm）之间的通信协议。</p><h2 id="major1" class="ibm-h2">JDWP 协议介绍</h2><p>这里首先要说明一下 debugger 和 target vm。Target vm 中运行着我们希望要调试的程序，它与一般运行的 Java 虚拟机没有什么区别，只是在启动时加载了 Agent JDWP 从而具备了调试功能。而 debugger 就是我们熟知的调试器，它向运行中的 target vm 发送命令来获取 target vm 运行时的状态和控制 Java 程序的执行。Debugger 和 target vm 分别在各自的进程中运行，他们之间的通信协议就是 JDWP。</p><p>JDWP 与其他许多协议不同，它仅仅定义了数据传输的格式，但并没有指定具体的传输方式。这就意味着一个 JDWP 的实现可以不需要做任何修改就正常工作在不同的传输方式上（在 JDWP 传输接口中会做详细介绍）。</p><p>JDWP 是语言无关的。理论上我们可以选用任意语言实现 JDWP。然而我们注意到，在 JDWP 的两端分别是 target vm 和 debugger。Target vm 端，JDWP 模块必须以 Agent library 的形式在 Java 虚拟机启动时加载，并且它必须通过 Java 虚拟机提供的 JVMTI 接口实现各种 debug 的功能，所以必须使用 C/C++ 语言编写。而 debugger 端就没有这样的限制，可以使用任意语言编写，只要遵守 JDWP 规范即可。JDI（Java Debug Interface）就包含了一个 Java 的 JDWP debugger 端的实现（JDI 将在该系列的下一篇文章中介绍），JDK 中调试工具 jdb 也是使用 JDI 完成其调试功能的。</p><h5 id="fig1" class="ibm-h5">图 1. JDWP agent 在调试中扮演的角色</h5><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image001.jpg" class="ibm-downsize" alt="图 1. JDWP agent 在调试中扮演的角色" height="240" width="555"><p class="ibm-ind-link ibm-hide"><a class="ibm-popup-link" onclick="IBMCore.common.widget.overlay.show(&#39;N1006E&#39;);return false;" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#N1006E">点击查看大图</a></p><div class="overlayrp"></div><h2 id="major2" class="ibm-h2">协议分析</h2><p>JDWP 大致分为两个阶段：握手和应答。握手是在传输层连接建立完成后，做的第一件事：</p><p>Debugger 发送 14 bytes 的字符串“JDWP-Handshake”到 target Java 虚拟机</p><p>Target Java 虚拟机回复“JDWP-Handshake”</p><h5 id="fig2" class="ibm-h5">图 2. JDWP 的握手协议</h5><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image002.jpg" class="ibm-downsize" alt="图 2. JDWP 的握手协议" height="240" width="555"><p class="ibm-ind-link ibm-hide"><a class="ibm-popup-link" onclick="IBMCore.common.widget.overlay.show(&#39;N10084&#39;);return false;" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#N10084">点击查看大图</a></p><div class="overlayrp"></div><p>握手完成，debugger 就可以向 target Java 虚拟机发送命令了。JDWP 是通过命令（command）和回复（reply）进行通信的，这与 HTTP 有些相似。JDWP 本身是无状态的，因此对 command 出现的顺序并不受限制。</p><p>JDWP 有两种基本的包（packet）类型：命令包（command packet）和回复包（reply packet）。</p><p>Debugger 和 target Java 虚拟机都有可能发送 command packet。Debugger 通过发送 command packet 获取 target Java 虚拟机的信息以及控制程序的执行。Target Java 虚拟机通过发送 command packet 通知 debugger 某些事件的发生，如到达断点或是产生异常。</p><p>Reply packet 是用来回复 command packet 该命令是否执行成功，如果成功 reply packet 还有可能包含 command packet 请求的数据，比如当前的线程信息或者变量的值。从 target Java 虚拟机发送的事件消息是不需要回复的。</p><p>还有一点需要注意的是，JDWP 是异步的：command packet 的发送方不需要等待接收到 reply packet 就可以继续发送下一个 command packet。</p><h2 id="major3" class="ibm-h2">Packet 的结构</h2><p>Packet 分为包头（header）和数据（data）两部分组成。包头部分的结构和长度是固定，而数据部分的长度是可变的，具体内容视 packet 的内容而定。Command packet 和 reply packet 的包头长度相同，都是 11 个 bytes，这样更有利于传输层的抽象和实现。</p><p>Command packet 的 header 的结构 :</p><h5 id="fig3" class="ibm-h5">图 3. JDWP command packet 结构</h5><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image003.jpg" class="ibm-downsize" alt="图 3. JDWP command packet 结构" height="166" width="555"><p class="ibm-ind-link ibm-hide"><a class="ibm-popup-link" onclick="IBMCore.common.widget.overlay.show(&#39;N100A2&#39;);return false;" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#N100A2">点击查看大图</a></p><div class="overlayrp"></div><p>Length 是整个 packet 的长度，包括 length 部分。因为包头的长度是固定的 11 bytes，所以如果一个 command packet 没有数据部分，则 length 的值就是 11。</p><p>Id 是一个唯一值，用来标记和识别 reply 所属的 command。Reply packet 与它所回复的 command packet 具有相同的 Id，异步的消息就是通过 Id 来配对识别的。</p><p>Flags 目前对于 command packet 值始终是 0。</p><p>Command Set 相当于一个 command 的分组，一些功能相近的 command 被分在同一个 Command Set 中。Command Set 的值被划分为 3 个部分：</p><p>0-63: 从 debugger 发往 target Java 虚拟机的命令</p><p>64 – 127： 从 target Java 虚拟机发往 debugger 的命令</p><p>128 – 256： 预留的自定义和扩展命令</p><p>Reply packet 的 header 的结构：</p><h5 id="fig4" class="ibm-h5">图 4. JDWP reply packet 结构</h5><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image004.jpg" class="ibm-downsize" alt="图 4. JDWP reply packet 结构" height="144" width="556"><p class="ibm-ind-link ibm-hide"><a class="ibm-popup-link" onclick="IBMCore.common.widget.overlay.show(&#39;N100BC&#39;);return false;" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#N100BC">点击查看大图</a></p><div class="overlayrp"></div><p>Length、Id 作用与 command packet 中的一样。</p><p>Flags 目前对于 reply packet 值始终是 0x80。我们可以通过 Flags 的值来判断接收到的 packet 是 command 还是 reply。</p><p>Error Code 用来表示被回复的命令是否被正确执行了。零表示正确，非零表示执行错误。</p><p>Data 的内容和结构依据不同的 command 和 reply 都有所不同。比如请求一个对象成员变量值的 command，它的 data 中就包含该对象的 id 和成员变量的 id。而 reply 中则包含该成员变量的值。</p><p>JDWP 还定义了一些数据类型专门用来传递 Java 相关的数据信息。下面列举了一些数据类型，详细的说明参见 [1]</p><h5 id="N100D3" class="ibm-h5">表 1. JDWP 中数据类型介绍</h5><div id="DataTables_Table_0_wrapper" class="dataTables_wrapper no-footer"><table border="0" cellpadding="0" cellspacing="0" class="ibm-data-table display dataTable no-footer dtr-inline" data-widget="datatable" summary="JDWP 中数据类型介绍" width="100%" id="DataTables_Table_0" role="grid" style="width: 100%;"><thead xmlns:dw="http://www.ibm.com/developerWorks/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr role="row"><th class="ibm-background-neutral-white-30 sorting_disabled" scope="col" rowspan="1" colspan="1" style="width: 65px;">名称</th><th class="ibm-background-neutral-white-30 sorting_disabled" scope="col" rowspan="1" colspan="1" style="width: 73px;">长度</th><th class="ibm-background-neutral-white-30 sorting_disabled" scope="col" rowspan="1" colspan="1" style="width: 522px;">说明</th></tr></thead><tbody xmlns:dw="http://www.ibm.com/developerWorks/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">byte</th><td>1 byte</td><td>byte 值。</td></tr><tr role="row" class="even"><th class="tb-row" scope="row" tabindex="0">boolean</th><td>1 byte</td><td>布尔值，0 表示假，非零表示真。</td></tr><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">int</th><td>4 byte</td><td>4 字节有符号整数。</td></tr><tr role="row" class="even"><th class="tb-row" scope="row" tabindex="0">long</th><td>8 byte</td><td>8 字节有符号整数。</td></tr><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">objectID</th><td>依据 target Java 虚拟机而定，最大 8 byte</td><td>Target Java 虚拟机中对象（object）的唯一 ID。这个值在整个 JDWP 的会话中不会被重用，始终指向同一个对象，即使该对象已经被 GC 回收（引用被回收的对象将返回 INVALID_OBJECT 错误。</td></tr><tr role="row" class="even"><th class="tb-row" scope="row" tabindex="0">Tagged-objectID</th><td>objectID 的长度加 1</td><td>第一个 byte 表示对象的类型，比如，整型，字符串，类等等。紧接着是一个 objectID。</td></tr><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">threadID</th><td>同 objectID 的长度</td><td>表示 Target Java 虚拟机中的一个线程对象</td></tr><tr role="row" class="even"><th class="tb-row" scope="row" tabindex="0">stringID</th><td>同 objectID 的长度</td><td>表示 Target Java 虚拟机中的一字符串对象</td></tr><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">referenceTypeID</th><td>同 objectID 的长度</td><td>表示 Target Java 虚拟机中的一个引用类型对象，即类（class）的唯一 ID。</td></tr><tr role="row" class="even"><th class="tb-row" scope="row" tabindex="0">classID</th><td>同 objectID 的长度</td><td>表示 Target Java 虚拟机中的一个类对象。</td></tr><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">methodID</th><td>依据 target Java 虚拟机而定，最大 8 byte</td><td>Target Java 虚拟机某个类中的方法的唯一 ID。methodID 必须在他所属类和所属类的所有子类中保持唯一。从整个 Java 虚拟机来看它并不是唯一的。methodID 与它所属类的 referenceTypeID 一起在整个 Java 虚拟机中是唯一的。</td></tr><tr role="row" class="even"><th class="tb-row" scope="row" tabindex="0">fieldID</th><td>依据 target Java 虚拟机而定，最大 8 byte</td><td>与 methodID 类似，Target Java 虚拟机某个类中的成员的唯一 ID。</td></tr><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">frameID</th><td>依据 target Java 虚拟机而定，最大 8 byte</td><td>Java 中栈中的每一层方法调用都会生成一个 frame。frameID 在整个 target Java 虚拟机中是唯一的，并且只在线程挂起（suspended）的时候有效。</td></tr><tr role="row" class="even"><th class="tb-row" scope="row" tabindex="0">location</th><td>依据 target Java 虚拟机而定，最大 8 byte</td><td>一个可执行的位置。Debugger 用它来定位 stepping 时在源代码中的位置。</td></tr></tbody></table></div><h2 id="major4" class="ibm-h2">JDWP 传输接口（Java Debug Wire Protocol Transport Interface）</h2><p>前面提到 JDWP 的定义是与传输层独立的，但如何使 JDWP 能够无缝的使用不同的传输实现，而又无需修改 JDWP 本身的代码？ JDWP 传输接口（Java Debug Wire Protocol Transport Interface）为我们解决了这个问题。</p><p>JDWP 传输接口定义了一系列的方法用来定义 JDWP 与传输层实现之间的交互方式。首先传输层的必须以动态链接库的方式实现，并且暴露一系列的标准接口供 JDWP 使用。与 JNI 和 JVMTI 类似，访问传输层也需要一个环境指针（jdwpTransport），通过这个指针可以访问传输层提供的所有方法。</p><p>当 JDWP agent 被 Java 虚拟机加载后，JDWP 会根据参数去加载指定的传输层实现（Sun 的 JDK 在 Windows 提供 socket 和 share memory 两种传输方式，而在 Linux 上只有 socket 方式）。传输层实现的动态链接库实现必须暴露 jdwpTransport_OnLoad 接口，JDWP agent 在加载传输层动态链接库后会调用该接口进行传输层的初始化。接口定义如下：</p><h5 id="listing1" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_140496" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">JNIEXPORT jint JNICALL </code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">jdwpTransport_OnLoad(JavaVM *jvm, </code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jdwpTransportCallback *callback, </code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jint version, </code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jdwpTransportEnv** env);</code></div></div></td></tr></tbody></table></div></div></div></span><p>callback 参数指向一个内存管理的函数表，传输层用它来进行内存的分配和释放，结构定义如下：</p></h5><h5 id="listing2" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_923887" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">typedef struct jdwpTransportCallback { </code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">void* (*alloc)(jint numBytes); </code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">void (*free)(void *buffer); </code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">} jdwpTransportCallback;</code></div></div></td></tr></tbody></table></div></div></div></span><p>env 参数是环境指针，指向的函数表由传输层初始化。</p><p>JDWP 传输层定义的接口主要分为两类：连接管理和 I/O 操作。</p></h5><h3 id="minor4.1" class="ibm-h3">连接管理</h3><p>连接管理接口主要负责连接的建立和关闭。一个连接为 JDWP 和 debugger 提供了可靠的数据流。Packet 被接收的顺序严格的按照被写入连接的顺序。</p><p>连接的建立是双向的，即 JDWP 可以主动去连接 debugger 或者 JDWP 等待 debugger 的连接。对于主动去连接 debugger，需要调用方法 Attach，定义如下：</p><h5 id="listing3" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_409571" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">jdwpTransportError </code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">Attach(jdwpTransportEnv* env, const char* address, </code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jlong attachTimeout, jlong handshakeTimeout)</code></div></div></td></tr></tbody></table></div></div></div></span><p>在连接建立后，会立即进行握手操作，确保对方也在使用 JDWP。因此方法参数中分别指定了 attch 和握手的超时时间。</p><p>address 参数因传输层的实现不同而有不同的格式。对于 socket，address 是主机地址；对于 share memory 则是共享内存的名称。</p><p>JDWP 等待 debugger 连接的方式，首先需要调用 StartListening 方法，定义如下：</p></h5><h5 id="listing4" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_237166" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">jdwpTransportError </code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">StartListening(jdwpTransportEnv* env, const char* address, </code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">char** actualAddress)</code></div></div></td></tr></tbody></table></div></div></div></span><p>该方法将使 JDWP 处于监听状态，随后调用 Accept 方法接收连接：</p></h5><h5 id="listing5" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_296940" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">jdwpTransportError </code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">Accept(jdwpTransportEnv* env, jlong acceptTimeout, jlong </code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">handshakeTimeout)</code></div></div></td></tr></tbody></table></div></div></div></span><p>与 Attach 方法类似，在连接建立后，会立即进行握手操作。</p></h5><h3 id="minor4.2" class="ibm-h3">I/O 操作</h3><p>I/O 操作接口主要是负责从传输层读写 packet。有 ReadPacket 和 WritePacket 两个方法：</p><h5 id="listing6" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_106609" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">jdwpTransportError </code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">ReadPacket(jdwpTransportEnv* env, jdwpPacket* packet) </code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="htmlscript plain">jdwpTransportError </code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">WritePacket(jdwpTransportEnv* env, const jdwpPacket* packet)</code></div></div></td></tr></tbody></table></div></div></div></span><p>参数 packet 是要被读写的 packet，其结构 jdwpPacket 与我们开始提到的 JDWP packet 结构一致，定义如下：</p></h5><h5 id="listing7" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_535787" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">typedef struct { </code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jint len;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // packet length </code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jint id;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // packet id </code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jbyte flags;&nbsp;&nbsp;&nbsp;&nbsp; // value is 0 </code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jbyte cmdSet;&nbsp;&nbsp;&nbsp; // command set </code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jbyte cmd;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // command in specific command set </code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jbyte *data;&nbsp;&nbsp;&nbsp;&nbsp; // data carried by packet </code></div><div class="line number8 index7 alt1"><code class="htmlscript plain">} jdwpCmdPacket; </code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="htmlscript plain">typedef struct { </code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jint len;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // packet length </code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jint id;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // packet id </code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jbyte flags;&nbsp;&nbsp;&nbsp;&nbsp; // value 0x80 </code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jshort errorCode;&nbsp;&nbsp;&nbsp; // error code </code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jbyte *data;&nbsp;&nbsp;&nbsp;&nbsp; // data carried by packet </code></div><div class="line number16 index15 alt1"><code class="htmlscript plain">} jdwpReplyPacket; </code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="htmlscript plain">typedef struct jdwpPacket { </code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">union { </code></div><div class="line number20 index19 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jdwpCmdPacket cmd; </code></div><div class="line number21 index20 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">jdwpReplyPacket reply; </code></div><div class="line number22 index21 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">} type; </code></div><div class="line number23 index22 alt2"><code class="htmlscript plain">} jdwpPacket;</code></div></div></td></tr></tbody></table></div></div></div></span></h5><h2 id="major5" class="ibm-h2">JDWP 的命令实现机制</h2><p>下面将通过讲解一个 JDWP 命令的实例来介绍 JDWP 命令的实现机制。JDWP 作为一种协议，它的作用就在于充当了调试器与 Java 虚拟机的沟通桥梁。通俗点讲，调试器在调试过程中需要不断向 Java 虚拟机查询各种信息，那么 JDWP 就规定了查询的具体方式。</p><p>在 Java 6.0 中，JDWP 包含了 18 组命令集合，其中每个命令集合又包含了若干条命令。那么这些命令是如何实现的呢？下面我们先来看一个最简单的 VirtualMachine（命令集合 1）的 Version 命令，以此来剖析其中的实现细节。</p><p>因为 JDWP 在整个 JPDA 框架中处于相对底层的位置（在前两篇本系列文章中有具体说明），我们无法在现实应用中来为大家演示 JDWP 的单个命令的执行过程。在这里我们通过一个针对该命令的 Java 测试用例来说明。</p><h5 id="listing8" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_283883" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">CommandPacket packet = new CommandPacket( </code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">JDWPCommands.VirtualMachineCommandSet.CommandSetID, </code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">JDWPCommands.VirtualMachineCommandSet.VersionCommand); </code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="htmlscript plain">ReplyPacket reply = debuggeeWrapper.vmMirror.performCommand(packet); </code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="htmlscript plain">String description = reply.getNextValueAsString(); </code></div><div class="line number8 index7 alt1"><code class="htmlscript plain">int&nbsp;&nbsp;&nbsp; jdwpMajor&nbsp;&nbsp; = reply.getNextValueAsInt(); </code></div><div class="line number9 index8 alt2"><code class="htmlscript plain">int&nbsp;&nbsp;&nbsp; jdwpMinor&nbsp;&nbsp; = reply.getNextValueAsInt(); </code></div><div class="line number10 index9 alt1"><code class="htmlscript plain">String vmVersion&nbsp;&nbsp; = reply.getNextValueAsString(); </code></div><div class="line number11 index10 alt2"><code class="htmlscript plain">String vmName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = reply.getNextValueAsString(); </code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="htmlscript plain">logWriter.println("description\t= " + description); </code></div><div class="line number14 index13 alt1"><code class="htmlscript plain">logWriter.println("jdwpMajor\t= " + jdwpMajor); </code></div><div class="line number15 index14 alt2"><code class="htmlscript plain">logWriter.println("jdwpMinor\t= " + jdwpMinor); </code></div><div class="line number16 index15 alt1"><code class="htmlscript plain">logWriter.println("vmVersion\t= " + vmVersion); </code></div><div class="line number17 index16 alt2"><code class="htmlscript plain">logWriter.println("vmName\t\t= " + vmName);</code></div></div></td></tr></tbody></table></div></div></div></span><p>这里先简单介绍一下这段代码的作用。</p><p>首先，我们会创建一个 VirtualMachine 的 Version 命令的命令包实例 packet。你可能已经注意到，该命令包主要就是配置了两个参数 : CommandSetID 和 VersionComamnd，它们的值均为 1。表明我们想执行的命令是属于命令集合 1 的命令 1，即 VirtualMachine 的 Version 命令。</p><p>然后在 performCommand 方法中我们发送了该命令并收到了 JDWP 的回复包 reply。通过解析 reply，我们得到了该命令的回复信息。</p></h5><h5 id="listing9" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_327883" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">description = Java 虚拟机 version 1.6.0 (IBM J9 VM, J2RE 1.6.0 IBM J9 2.4 Windows XP x86-32 </code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">jvmwi3260sr5-20090519_35743 (JIT enabled, AOT enabled) </code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">J9VM - 20090519_035743_lHdSMr </code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">JIT&nbsp; - r9_20090518_2017 </code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">GC&nbsp;&nbsp; - 20090417_AA, 2.4) </code></div><div class="line number6 index5 alt1"><code class="htmlscript plain">jdwpMajor&nbsp;&nbsp;&nbsp; = 1 </code></div><div class="line number7 index6 alt2"><code class="htmlscript plain">jdwpMinor&nbsp;&nbsp;&nbsp; = 6 </code></div><div class="line number8 index7 alt1"><code class="htmlscript plain">vmVersion&nbsp;&nbsp;&nbsp; = 1.6.0 </code></div><div class="line number9 index8 alt2"><code class="htmlscript plain">vmName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = IBM J9 VM</code></div></div></td></tr></tbody></table></div></div></div></span><p>测试用例的执行结果显示，我们通过该命令获得了 Java 虚拟机的版本信息，这正是 VirtualMachine 的 Version 命令的作用。</p><p>前面已经提到，JDWP 接收到的是调试器发送的命令包，返回的就是反馈信息的回复包。在这个例子中，我们模拟的调试器会发送 VirtualMachine 的 Version 命令。JDWP 在执行完该命令后就向调试器返回 Java 虚拟机的版本信息。</p><p>返回信息的包内容同样是在 JDWP Spec 里面规定的。比如本例中的回复包，Spec 中的描述如下（测试用例中的回复包解析就是参照这个规定的 ):</p></h5><h5 id="N101E9" class="ibm-h5">表 2. VirtualMachine 的 Version 命令返回包定义</h5><div id="DataTables_Table_1_wrapper" class="dataTables_wrapper no-footer"><table border="0" cellpadding="0" cellspacing="0" class="ibm-data-table display dataTable no-footer dtr-inline" data-widget="datatable" summary="VirtualMachine 的 Version 命令返回包定义" width="100%" id="DataTables_Table_1" role="grid" style="width: 100%;"><thead xmlns:dw="http://www.ibm.com/developerWorks/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr role="row"><th class="ibm-background-neutral-white-30 sorting_disabled" scope="col" rowspan="1" colspan="1" style="width: 77px;">类型</th><th class="ibm-background-neutral-white-30 sorting_disabled" scope="col" rowspan="1" colspan="1" style="width: 129px;">名称</th><th class="ibm-background-neutral-white-30 sorting_disabled" scope="col" rowspan="1" colspan="1" style="width: 454px;">说明</th></tr></thead><tbody xmlns:dw="http://www.ibm.com/developerWorks/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">string</th><td>description</td><td>VM version 的文字描述信息。</td></tr><tr role="row" class="even"><th class="tb-row" scope="row" tabindex="0">int</th><td>jdwpMajor</td><td>JDWP 主版本号。</td></tr><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">int</th><td>jdwpMinor</td><td>JDWP 次版本号。</td></tr><tr role="row" class="even"><th class="tb-row" scope="row" tabindex="0">string</th><td>vmVersion</td><td>VM JRE 版本，也就是 java.version 属性值。</td></tr><tr role="row" class="odd"><th class="tb-row" scope="row" tabindex="0">string</th><td>vmName</td><td>VM 的名称，也就是 java.vm.name 属性值。</td></tr></tbody></table></div><p>通过这个简单的例子，相信大家对 JDWP 的命令已经有了一个大体的了解。 那么在 JDWP 内部是如何处理接收到的命令并返回回复包的呢？下面以 Apache Harmony 的 JDWP 为例，为大家介绍其内部的实现架构。</p><h5 id="fig5" class="ibm-h5">图 5. JDWP 架构图</h5><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image005.jpg" class="ibm-downsize" alt="图 5. JDWP 架构图" height="490" width="556"><p class="ibm-ind-link ibm-hide"><a class="ibm-popup-link" onclick="IBMCore.common.widget.overlay.show(&#39;N1022F&#39;);return false;" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#N1022F">点击查看大图</a></p><div class="overlayrp"></div><p>如图所示，JDWP 接收和发送的包都会经过 TransportManager 进行处理。JDWP 的应用层与传输层是独立的，就在于 TransportManager 调用的是 JDWP 传输接口（Java Debug Wire Protocol Transport Interface），所以无需关心底层网络的具体传输实现。TransportManager 的主要作用就是充当 JDWP 与外界通讯的数据包的中转站，负责将 JDWP 的命令包在接收后进行解析或是对回复包在发送前进行打包，从而使 JDWP 能够专注于应用层的实现。</p><p>对于收到的命令包，TransportManager 处理后会转给 PacketDispatcher，进一步封装后会继续转到 CommandDispatcher。然后，CommandDispatcher 会根据命令中提供的命令组号和命令号创建一个具体的 CommandHandler 来处理 JDWP 命令。</p><p>其中，CommandHandler 才是真正执行 JDWP 命令的类。我们会为每个 JDWP 命令都定义一个相对应的 CommandHandler 的子类，当接收到某个命令时，就会创建处理该命令的 CommandHandler 的子类的实例来作具体的处理。</p><h5 id="fig6" class="ibm-h5">图 6. JDWP 命令处理流程</h5><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image006.jpg" class="ibm-downsize" alt="图 6. JDWP 命令处理流程" height="325" width="572"><p class="ibm-ind-link ibm-hide"><a class="ibm-popup-link" onclick="IBMCore.common.widget.overlay.show(&#39;N1023F&#39;);return false;" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#N1023F">点击查看大图</a></p><div class="overlayrp"></div><h3 id="minor5.1" class="ibm-h3">单线程执行的命令</h3><p>上图就是一个命令的处理流程图。可以看到，对于一个可以直接在该线程中完成的命令（我们称为单线程执行的命令），一般其内部会调用 JVMTI 方法和 JNI 方法来真正对 Java 虚拟机进行操作。</p><p>例如，VirtualMachine 的 Version 命令中，对于 vmVersion 和 vmName 属性，我们可以通过 JNI 来调用 Java 方法 System.getProperty 来获取。然后，JDWP 将回复包中所需要的结果封装到包中后交由 TransportManager 来进行后续操作。</p><h3 id="minor5.2" class="ibm-h3">多线程执行的命令</h3><p>对于一些较为复杂的命令，是无法在 CommandHandler 子类的处理线程中完成的。例如，ClassType 的 InvokeMethod 命令，它会要求在指定的某个线程中执行一个静态方法。显然，CommandHandler 子类的当前线程并不是所要求的线程。</p><p>这时，JDWP 线程会先把这个请求先放到一个列表中，然后等待，直到所要求的线程执行完那个静态方法后，再把结果返回给调试器。</p><h2 id="major6" class="ibm-h2">JDWP 的事件处理机制</h2><p>前面介绍的 VirtualMachine 的 Version 命令过程非常简单，就是一个查询和信息返回的过程。在实际调试过程中，一个 JDI 的命令往往会有数条这类简单的查询命令参与，而且会涉及到很多更为复杂的命令。要了解更为复杂的 JDWP 命令实现机制，就必须介绍 JDWP 的事件处理机制。</p><p>在 Java 虚拟机中，我们会接触到许多事件，例如 VM 的初始化，类的装载，异常的发生，断点的触发等等。那么这些事件调试器是如何通过 JDWP 来获知的呢？下面，我们通过介绍在调试过程中断点的触发是如何实现的，来为大家揭示其中的实现机制。</p><p>在这里，我们任意调试一段 Java 程序，并在某一行中加入断点。然后，我们执行到该断点，此时所有 Java 线程都处于 suspend 状态。这是很常见的断点触发过程。为了记录在此过程中 JDWP 的行为，我们使用了一个开启了 trace 信息的 JDWP。虽然这并不是一个复杂的操作，但整个 trace 信息也有几千行。</p><p>可见，作为相对底层的 JDWP，其实际处理的命令要比想象的多许多。为了介绍 JDWP 的事件处理机制，我们挑选了其中比较重要的一些 trace 信息来说明：</p><h5 id="listing10" class="ibm-h5"><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_572324" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">[RequestManager.cpp:601] AddRequest: event=BREAKPOINT[2], req=48, modCount=1, policy=1 </code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">[RequestManager.cpp:791] GenerateEvents: event #0: kind=BREAKPOINT, req=48 </code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">[RequestManager.cpp:1543] HandleBreakpoint: BREAKPOINT events: count=1, suspendPolicy=1, </code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">location=0 </code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">[RequestManager.cpp:1575] HandleBreakpoint: post set of 1 </code></div><div class="line number6 index5 alt1"><code class="htmlscript plain">[EventDispatcher.cpp:415] PostEventSet -- wait for release on event: thread=4185A5A0, </code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">name=(null), eventKind=2 </code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="htmlscript plain">[EventDispatcher.cpp:309] SuspendOnEvent -- send event set: id=3, policy=1 </code></div><div class="line number10 index9 alt1"><code class="htmlscript plain">[EventDispatcher.cpp:334] SuspendOnEvent -- wait for thread on event: thread=4185A5A0, </code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">name=(null) </code></div><div class="line number12 index11 alt1"><code class="htmlscript plain">[EventDispatcher.cpp:349] SuspendOnEvent -- suspend thread on event: thread=4185A5A0, </code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">name=(null) </code></div><div class="line number14 index13 alt1"><code class="htmlscript plain">[EventDispatcher.cpp:360] SuspendOnEvent -- release thread on event: thread=4185A5A0, </code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">name=(null)</code></div></div></td></tr></tbody></table></div></div></div></span><p>首先，调试器需要发起一个断点的请求，这是通过 JDWP 的 Set 命令完成的。在 trace 中，我们看到 AddRequest 就是做了这件事。可以清楚的发现，调试器请求的是一个断点信息（event=BREAKPOINT[2]）。</p><p>在 JDWP 的实现中，这一过程表现为：在 Set 命令中会生成一个具体的 request, JDWP 的 RequestManager 会记录这个 request（request 中会包含一些过滤条件，当事件发生时 RequestManager 会过滤掉不符合预先设定条件的事件），并通过 JVMTI 的 SetEventNotificationMode 方法使这个事件触发生效（否则事件发生时 Java 虚拟机不会报告）。</p></h5><h5 id="fig7" class="ibm-h5">图 7. JDWP 事件处理流程</h5><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image007.jpg" class="ibm-downsize" alt="图 7. JDWP 事件处理流程" height="324" width="572"><p class="ibm-ind-link ibm-hide"><a class="ibm-popup-link" onclick="IBMCore.common.widget.overlay.show(&#39;N10275&#39;);return false;" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#N10275">点击查看大图</a></p><div class="overlayrp"></div><p>当断点发生时，Java 虚拟机就会调用 JDWP 中预先定义好的处理该事件的回调函数。在 trace 中，HandleBreakpoint 就是我们在 JDWP 中定义好的处理断点信息的回调函数。它的作用就是要生成一个 JDWP 端所描述的断点事件来告知调试器（Java 虚拟机只是触发了一个 JVMTI 的消息）。</p><p>由于断点的事件在调试器申请时就要求所有 Java 线程在断点触发时被 suspend，那这一步由谁来完成呢？这里要谈到一个细节问题，HandleBreakpoint 作为一个回调函数，其执行线程其实就是断点触发的 Java 线程。</p><p>显然，我们不应该由它来负责 suspend 所有 Java 线程。</p><p>原因很简单，我们还有一步工作要做，就是要把该断点触发信息返回给调试器。如果我们先返回信息，然后 suspend 所有 Java 线程，这就无法保证在调试器收到信息时所有 Java 线程已经被 suspend。</p><p>反之，先 Suspend 了所有 Java 线程，谁来负责发送信息给调试器呢？</p><p>为了解决这个问题，我们通过 JDWP 的 EventDispatcher 线程来帮我们 suspend 线程和发送信息。实现的过程是，我们让触发断点的 Java 线程来 PostEventSet（trace 中可以看到），把生成的 JDWP 事件放到一个队列中，然后就开始等待。由 EventDispatcher 线程来负责从队列中取出 JDWP 事件，并根据事件中的设定，来 suspend 所要求的 Java 线程并发送出该事件。</p><p>在这里，我们在事件触发的 Java 线程和 EventDispatcher 线程之间添加了一个同步机制，当事件发送出去后，事件触发的 Java 线程会把 JDWP 中的该事件删除，到这里，整个 JDWP 事件处理就完成了。</p><h2 id="major7" class="ibm-h2">结语</h2><p>我们在调试 Java 程序的时候，往往需要对虚拟机内部的运行状态进行观察和调试，JDWP Agent 就充当了调试器与 Java 虚拟机的沟通桥梁。它的工作原理简单来说就是对于 JDWP 命令的处理和事件的管理。由于 JDWP 在 JPDA 中处于相对底层的位置，调试器发出一个 JDI 指令，往往要通过很多 JDWP 命令来完成。在下一篇文章中，我们将具体介绍 JDI 是如何工作在 JDWP 协议上的。</p><!--CMA ID: 425507--><!--Site ID: 10--><!--XSLT stylesheet used to transform this file: dw-document-html-8.0.xsl--> 
                                        <!-- Article Resources -->
                                        <div class="ibm-alternate-rule"><hr></div><h4 id="artrelatedtopics" class="ibm-h4">相关主题</h4><ul><li>
				在 <a href="http://java.sun.com/javase/technologies/core/toolsapis/jpda/">JPDA 官方的主页</a>上，您可以查看关于 JPDA 标准实现的细节。
			</li><li>
				您可以参与 <a href="http://forums.sun.com/forum.jspa?forumID=543">JPDA 官方论坛</a>上的参与。
			</li><li><a href="http://www.eclipse.org/">Eclipse IDE</a>是一个非常受欢迎的开源开发工具，它集成了对 JPDA 的支持。
			</li><li>
				参阅 JDWP 协议规范：<a href="http://java.sun.com/javase/6/docs/technotes/guides/jpda/jdwp-spec.html">Specification of Java Debug Wire Protocol</a>。
			</li><li>
				参阅 JDWP 协议接口规范：<a href="http://java.sun.com/javase/6/docs/technotes/guides/jpda/jdwpTransport.html">Specification of Java Debug Wire Protocol Interface</a>。
			</li><li><a href="http://www.ibm.com/developerworks/cn/java/">developerWorks Java 技术专区</a>：查找数百篇有关 Java 编程各方面的文章。
			</li></ul>
                                        <!-- Commenting -->
<!-- INLINE_COMMENTS_BEGIN: -->
<div class="ibm-alternate-rule"><hr></div>
<div id="dw-article-cmts-top" class="ibm-columns">
    <div class="ibm-col-6-2">
        <h4 id="icomments" class="ibm-h4">评论</h4>
        <div id="dw-article-cmts-login">
            <p>添加或订阅评论，请先<a onclick="window.location=userLinks[0].url;" tabindex="0" role="link">登录</a>或<a onclick="window.location=userLinks[1].url;" tabindex="0" role="link">注册</a>。</p>
        </div>
    </div>    
    <div class="ibm-col-6-2" id="dw-notify"> 
        <input type="checkbox" value="1" name="comment_notification" id="comment_notification" disabled="">
        <label for="comment_notification" style="color: rgb(204, 204, 204);">有新评论时提醒我</label>	   
    </div>
</div>

<div class="dw-article-cmts-container">       
    <div class="ibm-no-print jquery-comments read-only" id="dw-icomments-container"><div class="commenting-field main"><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/user-icon.png" alt="" class="profile-picture round by-current-user"><div class="textarea-wrapper"><span class="close" style="display: none;"><span class="left"></span><span class="right"></span></span><div class="textarea" data-placeholder="添加评论" contenteditable="true" style="height: 3.65em;"></div><div class="control-row" style="display: none;"><span class="send save highlight-background">提交</span></div></div></div><ul class="navigation"><div class="navigation-wrapper"><li data-sort-key="newest" data-container-name="comments" class="active">最新的</li><li data-sort-key="oldest" data-container-name="comments">历史</li><li data-sort-key="popularity" data-container-name="comments">热门</li></div><div class="navigation-wrapper responsive"><li class="title active"><header>最新的</header></li><ul class="dropdown"><li data-sort-key="newest" data-container-name="comments" class="active">最新的</li><li data-sort-key="oldest" data-container-name="comments">历史</li><li data-sort-key="popularity" data-container-name="comments">热门</li></ul></div></ul><div class="data-container" data-container="comments"><ul id="comment-list" class="main"><li data-id="21810" class="comment"><div class="comment-wrapper"><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1415093959116">2014 年 11 月 04 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/%E5%B0%8F%E8%91%B1%E5%AE%9D%E5%AE%9D">小葱宝宝</a></div><div class="wrapper"><div class="content">推荐使用jdi的api来实现自己的调试工具 ：<a href="http://docs.oracle.com/javase/6/docs/jdk/api/jpda/jdi/index.html" target="_blank">http://docs.oracle.com/javase/6/docs/jdk/api/jpda/jdi/index.html</a>

example would be ：JDK/demo/jpda/examples.jar </div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jpda3%2Findex.html&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8jdi%E7%9A%84api%E6%9D%A5%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%20%EF%BC%9Ahttp%3A%2F%2Fdocs.oracle.com%2Fjavase%2F6%2Fdocs%2Fjdk%2Fapi%2Fjpda%2Fjdi%2Findex.html%0A%0Aexample%20would%20be%20%EF%BC%9AJDK%2Fdemo%2Fjpda%2Fexamples.jar%20%0D%E7%94%B1%20%E5%B0%8F%E8%91%B1%E5%AE%9D%E5%AE%9D%20%20%E4%BA%8E%202014%20%E5%B9%B4%2011%20%E6%9C%88%2004%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li><li data-id="21806" class="comment"><div class="comment-wrapper"><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1415069569534">2014 年 11 月 04 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/ldb111">ldb111</a></div><div class="wrapper"><div class="content">徐睿智： 你好！

        今天拜读此文，收获很大，谢谢。我现在需要开发一个自己的调试工具。按照你文章中所说，已经实现了VirtualMachine 的 Version 命令，并且获得了Java 虚拟机的返回信息。我现在遇到的问题是，tomat什么时候加载Java代码，我什么时候设置断点，启动Java 虚拟机运行代码，并停留在断点位置，返回控制权给我，能否发个sample给我，或者更详细的资料，已解燃眉之急，谢谢了。

 

刘德滨

2014.11.4
</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jpda3%2Findex.html&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20%E5%BE%90%E7%9D%BF%E6%99%BA%EF%BC%9A%20%E4%BD%A0%E5%A5%BD%EF%BC%81%0A%0A%20%20%20%20%20%20%20%20%E4%BB%8A%E5%A4%A9%E6%8B%9C%E8%AF%BB%E6%AD%A4%E6%96%87%EF%BC%8C%E6%94%B6%E8%8E%B7%E5%BE%88%E5%A4%A7%EF%BC%8C%E8%B0%A2%E8%B0%A2%E3%80%82%E6%88%91%E7%8E%B0%E5%9C%A8%E9%9C%80%E8%A6%81%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E3%80%82%E6%8C%89%E7%85%A7%E4%BD%A0%E6%96%87%E7%AB%A0%E4%B8%AD%E6%89%80%E8%AF%B4%EF%BC%8C%E5%B7%B2%E7%BB%8F%E5%AE%9E%E7%8E%B0%E4%BA%86VirtualMachine%20%E7%9A%84%20Version%20%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%8E%B7%E5%BE%97%E4%BA%86Java%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E8%BF%94%E5%9B%9E%E4%BF%A1%E6%81%AF%E3%80%82%E6%88%91%E7%8E%B0%E5%9C%A8%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%98%AF%EF%BC%8Ctomat%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%8A%A0%E8%BD%BDJava%E4%BB%A3%E7%A0%81%EF%BC%8C%E6%88%91%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%AE%BE%E7%BD%AE%E6%96%AD%E7%82%B9%EF%BC%8C%E5%90%AF%E5%8A%A8Java%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%90%E8%A1%8C%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%B9%B6%E5%81%9C%E7%95%99%E5%9C%A8%E6%96%AD%E7%82%B9%E4%BD%8D%E7%BD%AE%EF%BC%8C%E8%BF%94%E5%9B%9E%E6%8E%A7%E5%88%B6%E6%9D%83%E7%BB%99%E6%88%91%EF%BC%8C%E8%83%BD%E5%90%A6%E5%8F%91%E4%B8%AAsample%E7%BB%99%E6%88%91%EF%BC%8C%E6%88%96%E8%80%85%E6%9B%B4%E8%AF%A6%E7%BB%86%E7%9A%84%E8%B5%84%E6%96%99%EF%BC%8C%E5%B7%B2%E8%A7%A3%E7%87%83%E7%9C%89%E4%B9%8B%E6%80%A5%EF%BC%8C%E8%B0%A2%E8%B0%A2%E4%BA%86%E3%80%82%0A%0A%20%0A%0A%E5%88%98%E5%BE%B7%E6%BB%A8%0A%0A2014.11.4%0A%0D%E7%94%B1%20ldb111%20%20%E4%BA%8E%202014%20%E5%B9%B4%2011%20%E6%9C%88%2004%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li><li data-id="11407" class="comment"><div class="comment-wrapper"><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1347177600000">2012 年 09 月 09 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/BY13_guo_zhigang">BY13_guo_zhigang</a></div><div class="wrapper"><div class="content">小鸟路过...受教了</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jpda3%2Findex.html&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20%E5%B0%8F%E9%B8%9F%E8%B7%AF%E8%BF%87...%E5%8F%97%E6%95%99%E4%BA%86%0D%E7%94%B1%20BY13_guo_zhigang%20%20%E4%BA%8E%202012%20%E5%B9%B4%2009%20%E6%9C%88%2009%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li><li data-id="11406" class="comment"><div class="comment-wrapper"><img src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1332662400000">2012 年 03 月 25 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/changcheng">changcheng</a></div><div class="wrapper"><div class="content">谢谢分享，希望能看到更多、比较深入的分享。</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jpda3%2Findex.html&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20%E8%B0%A2%E8%B0%A2%E5%88%86%E4%BA%AB%EF%BC%8C%E5%B8%8C%E6%9C%9B%E8%83%BD%E7%9C%8B%E5%88%B0%E6%9B%B4%E5%A4%9A%E3%80%81%E6%AF%94%E8%BE%83%E6%B7%B1%E5%85%A5%E7%9A%84%E5%88%86%E4%BA%AB%E3%80%82%0D%E7%94%B1%20changcheng%20%20%E4%BA%8E%202012%20%E5%B9%B4%2003%20%E6%9C%88%2025%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li></ul><div class="no-comments no-data"><i class="fa fa-comments fa-2x"></i><br>第一个评论</div></div></div>
</div>
<!-- INLINE_COMMENTS_END -->                                        <!-- CENTER_6_4_CONTENT_COLUMN_END -->
                                    </div>   
                                </div>
                        <!--Rating_Meta_BEGIN--><div class="metavalue">static.content.url=http://www.ibm.com/developerworks/js/artrating/</div><div class="metavalue">SITE_ID=10</div><div class="metavalue">Zone=Java technology</div><div class="metavalue">ArticleID=425507</div><div class="metavalue">ArticleTitle=深入 Java 调试体系，第 3 部分: JDWP 协议及实现</div><div class="metavalue">publish-date=09032009</div><script language="javascript" type="text/javascript">document.write('<div class="metavalue">url='+location.href.replace(/</g,  '%3C')+'</div>');</script><div class="metavalue">url=https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html</div><!--Rating_Meta_END-->
                    <p class="ibm-ind-link ibm-nospacing ibm-icononly ibm-btt-auto ibm-hidden-small ibm-active"><a class="ibm-nospacing ibm-chevron-up-link" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#top" tabindex="0">回页首</a></p></div>
                    <!-- END_IBM-CONTENT-MAIN -->
                </div>
                <!-- END_IBM-CONTENT-BODY -->
            </div>
            <!-- END_IBM-CONTENT -->
        </div>
        <!-- END_IBM-PCON -->
    </main>
    <!-- MAIN_CONTENT_END -->
    
    <!-- END_CONTENT-WRAPPER -->	
</div>
<!-- FOOTER_BEGIN -->
<footer role="contentinfo" aria-label="IBM developerWorks">
    <div id="dw-footer-module" class="dw-footer-home">
        <section aria-label="参考资料" role="contentinfo">
            <div class="ibm-columns">
                <div class="ibm-col-6-1 dw-footer-col-1">
                    <ul>
                        <li class="dw-footer-heading" aria-label="developerWorks">developerWorks</li>
                        <li><a href="https://www.ibm.com/developerworks/secure/feedback.jsp?domain=dwchina">站点反馈</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/secure/myideas2.jsp?domain=dwchina">我要投稿</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/cn/author/">投稿指南</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/community/report?lang=zh">报告滥用</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/cn/community/terms/thirdparty/">第三方提示</a></li>
                    </ul>
                    <ul>
                        <li class="dw-footer-newline"><a href="https://weibo.com/ibmdw/">关注微博</a></li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-2">
                    <ul>
                        <li class="dw-footer-heading" aria-label="加入">加入</li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/partnerworld/isv/">ISV 资源 (英语)</a></li>
                    </ul>
                    <ul class="dw-footer-lang" aria-label="选择语言">
                        <li class="dw-footer-heading">选择语言</li>
                        <li><a href="https://www.ibm.com/developerworks/">English</a></li>
                        <li><a href="https://www.ibm.com/developerworks/cn/" lang="zh">中文</a></li>
                        <li><a href="https://www.ibm.com/developerworks/jp/" lang="ja">日本語</a></li>
                        <li><a href="https://www.ibm.com/developerworks/ru/" lang="ru">Русский</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/br/" lang="pt">Português (Brasil)</a></li>
                        <li><a href="https://www.ibm.com/developerworks/ssa/" lang="es">Español</a></li>
                        <li><a href="https://developer.ibm.com/kr/" lang="kr">한글</a></li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-3"> </div>
                <div class="ibm-col-6-1 dw-footer-col-4">
                    <ul class="dw-footer-categories">
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/cn/views/global/libraryview.jsp">技术文档库</a>
                        </li>
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/cn/rss/">订阅源</a>  
                        </li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-5">
                    <ul class="dw-footer-categories">
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/cn/community/">社区</a>  
                        </li>
                        <li class="dw-footer-category">
                            <a href="http://ibmdeveloperworks.mkt6741.com/developerWorksChina-NewsletterSubscriptionPage/">dW 中国时事通讯</a>  
                        </li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-6">
                    <ul class="dw-footer-categories">
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/cn/downloads/">软件下载</a>  
                        </li>
                    </ul>
                </div>
            </div>
        </section>
    </div>
    <div id="dw-footer" class="ibm-padding-normal ibm-alternate">
        <div class="ibm-columns">
            <div class="ibm-col-1-1">
                <div class="dw-footer-corporate-links">
                <ul>
                    <li><a href="https://www.ibm.com/contact/cn/zh/">联系 IBM</a></li>
                    <li><a href="https://www.ibm.com/privacy/cn/zh/">隐私条约</a></li>
                    <li><a href="https://www.ibm.com/developerworks/community/terms?lang=zh">使用条款</a></li>
                    <li><a href="https://www.ibm.com/accessibility/cn/zh/">信息无障碍选项</a></li>
                    <li class="ibm-feedbacklink"><a href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#">反馈</a></li>
                    <li id="ibm-truste-cp"><a onclick="truste.eu.clickListener();return false;" href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda3/index.html#">Cookie 首选项</a></li>
                </ul>                 
                </div>    
            </div>
        </div>
    </div>        
</footer> <!-- FOOTER_END -->

<!-- END_IBM-TOP -->
</div>

<!-- SCRIPTS_INCLUDE_BEGIN -->
<!-- Styles -->
<link rel="stylesheet" type="text/css" href="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/jquery-comments.css">
<link rel="stylesheet" href="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/font-awesome.min.css">

<!-- Libraries -->
<script type="text/javascript" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/jquery-comments.min.js"></script>
<script type="text/javascript" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/moment-with-locales.js"></script>
<script type="text/javascript" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/ContentComments.js"></script>
<script type="text/javascript" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/ContentCommentsFormatter.js"></script>
<script type="text/javascript" language="JavaScript">

	IBMCore.common.module.masthead.subscribe("ready", "customjs", setupCommentsPlugin).runAsap(setupCommentsPlugin);

	function setupCommentsPlugin(){
		//debugger;
			//alert(userLinks);
			var commentsInitInfo = {
				contentId : $("div[class=metavalue]:contains('ArticleID=')").text().split("=")[1],
				siteId :  $("div[class=metavalue]:contains('SITE_ID=')").text().split("=")[1],
				pluginDivId : '#dw-icomments-container',
				notifyElementId : "#comment_notification",
				loginMessageDivId : "#dw-article-cmts-login",
				totalCommentsDivId : "#nCmts"
			};				
								
			ContentComments.Setup(commentsInitInfo);
	}
</script>
<!-- Piwik -->
<script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(["setDomains", ["*.www.ibm.com/developerworks","*.www.ibm.com/developerworks"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
    var u="//developer.ibm.com/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 7]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
</script>
<noscript>&lt;p&gt;&lt;img src="//developer.ibm.com/piwik/piwik.php?idsite=7" style="border:0;" alt="" /&gt;&lt;/p&gt;</noscript>
<!-- End Piwik Code -->
<!-- SCRIPTS_INCLUDE_END -->



<div id="ibm-overlay-backdrop"></div><div class="ibm-common-overlay ibm-overlay-alt-three" id="ibm-overlaywidget-N1006E" role="dialog" aria-describedby="ibm-overlaywidget-N1006E-content" aria-label="Overlay content" data-widget="overlay container" data-name=""><div class="ibm-overlay-heading-con"><p class="ibm-icononly"><a href="javascript:void(0);" class="ibm-close-link" role="button">关闭</a></p></div><div id="ibm-overlaywidget-N1006E-content" class="content"><div class="" data-widget="overlay" id="N1006E"><img alt="图 1. JDWP agent 在调试中扮演的角色" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image001.jpg" width="555"></div></div></div><div class="ibm-common-overlay ibm-overlay-alt-three" id="ibm-overlaywidget-N10084" role="dialog" aria-describedby="ibm-overlaywidget-N10084-content" aria-label="Overlay content" data-widget="overlay container" data-name=""><div class="ibm-overlay-heading-con"><p class="ibm-icononly"><a href="javascript:void(0);" class="ibm-close-link" role="button">关闭</a></p></div><div id="ibm-overlaywidget-N10084-content" class="content"><div class="" data-widget="overlay" id="N10084"><img alt="图 2. JDWP 的握手协议" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image002.jpg" width="555"></div></div></div><div class="ibm-common-overlay ibm-overlay-alt-three" id="ibm-overlaywidget-N100A2" role="dialog" aria-describedby="ibm-overlaywidget-N100A2-content" aria-label="Overlay content" data-widget="overlay container" data-name=""><div class="ibm-overlay-heading-con"><p class="ibm-icononly"><a href="javascript:void(0);" class="ibm-close-link" role="button">关闭</a></p></div><div id="ibm-overlaywidget-N100A2-content" class="content"><div class="" data-widget="overlay" id="N100A2"><img alt="图 3. JDWP command packet 结构" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image003.jpg" width="555"></div></div></div><div class="ibm-common-overlay ibm-overlay-alt-three" id="ibm-overlaywidget-N100BC" role="dialog" aria-describedby="ibm-overlaywidget-N100BC-content" aria-label="Overlay content" data-widget="overlay container" data-name=""><div class="ibm-overlay-heading-con"><p class="ibm-icononly"><a href="javascript:void(0);" class="ibm-close-link" role="button">关闭</a></p></div><div id="ibm-overlaywidget-N100BC-content" class="content"><div class="" data-widget="overlay" id="N100BC"><img alt="图 4. JDWP reply packet 结构" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image004.jpg" width="556"></div></div></div><div class="ibm-common-overlay ibm-overlay-alt-three" id="ibm-overlaywidget-N1022F" role="dialog" aria-describedby="ibm-overlaywidget-N1022F-content" aria-label="Overlay content" data-widget="overlay container" data-name=""><div class="ibm-overlay-heading-con"><p class="ibm-icononly"><a href="javascript:void(0);" class="ibm-close-link" role="button">关闭</a></p></div><div id="ibm-overlaywidget-N1022F-content" class="content"><div class="" data-widget="overlay" id="N1022F"><img alt="图 5. JDWP 架构图" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image005.jpg" width="556"></div></div></div><div class="ibm-common-overlay ibm-overlay-alt-three" id="ibm-overlaywidget-N1023F" role="dialog" aria-describedby="ibm-overlaywidget-N1023F-content" aria-label="Overlay content" data-widget="overlay container" data-name=""><div class="ibm-overlay-heading-con"><p class="ibm-icononly"><a href="javascript:void(0);" class="ibm-close-link" role="button">关闭</a></p></div><div id="ibm-overlaywidget-N1023F-content" class="content"><div class="" data-widget="overlay" id="N1023F"><img alt="图 6. JDWP 命令处理流程" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image006.jpg" width="572"></div></div></div><div class="ibm-common-overlay ibm-overlay-alt-three" id="ibm-overlaywidget-N10275" role="dialog" aria-describedby="ibm-overlaywidget-N10275-content" aria-label="Overlay content" data-widget="overlay container" data-name=""><div class="ibm-overlay-heading-con"><p class="ibm-icononly"><a href="javascript:void(0);" class="ibm-close-link" role="button">关闭</a></p></div><div id="ibm-overlaywidget-N10275-content" class="content"><div class="" data-widget="overlay" id="N10275"><img alt="图 7. JDWP 事件处理流程" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/image007.jpg" width="572"></div></div></div><div id="ibm-mobilemenu-screen"></div><iframe id="LOTCCFrameWed Jul 19 2017 19:16:47 GMT+0800 (CST)" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/rt=ifr.html" title="empty" tabindex="-1" role="presentation" style="border: 0px; width: 0px; height: 0px; display: block;"></iframe><div id="ttdUniversalPixelTag14a49df88763436db0795df4fc90e6a7" style="display:none"><iframe id="universal_pixel" allowtransparency="true" height="0" width="0" style="visibility:hidden;" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/up.html"></iframe></div><div id="ttdUniversalPixelTagaf477d928c164ae0b8f3e1717b910617" style="display:none"><iframe id="universal_pixel" allowtransparency="true" height="0" width="0" style="visibility:hidden;" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/up(1).html"></iframe></div><script type="text/javascript" src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/Serving" async=""></script><script src="./深入 Java 调试体系，第 3 部分_ JDWP 协议及实现_files/js(1)" id="mm_pp_background"></script></body></html>