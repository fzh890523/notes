<!doctype html><html lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#" class="no-js"><head><meta charset="UTF-8"><link type="text/css" media="all" href="https://blog.codecentric.de/wp-content/cache/autoptimize/2/autoptimize_06a85d694f971f4152da449e38354fab.php" rel="stylesheet" /><title>Useful JVM Flags - Part 7 (CMS Collector) - codecentric AG Blog</title><link href="https://blog.codecentric.de/wp-content/themes/codecentric2015/img/icons/favicon.ico" rel="shortcut icon"><link href="https://blog.codecentric.de/wp-content/themes/codecentric2015/img/icons/touch.png" rel="apple-touch-icon-precomposed"><link rel="profile" href="http://gmpg.org/xfn/11"/><link rel="pingback" href="https://blog.codecentric.de/xmlrpc.php"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="udyUJphOAc3iTldVhEpkEzYUeCNAQm1RJM4xXwKi82Q" /> <script>(function(i,s,o,g,r,a,m){i['InstanaEumObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//eum.instana.io/eum.min.js','ineum'); ineum('apiKey', 'cnkUbWdYSY-gaq4B26lgxw'); // Backend trace ID to facilitate correlation of frontend/backend traces. // Trace ID is available in backend to user code. // User is himself responsible for embedding this trace ID in this snippet. // ineum('traceId', '<backend trace id>'); // free form key/value pairs for advanced end-user tracking // ineum('meta', 'user', 'tom.mason@example.com');</script> <link rel="canonical" href="https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/" /><link rel="publisher" href="https://plus.google.com/+codecentricDe"/><meta property="og:locale" content="en_US" /><meta property="og:type" content="article" /><meta property="og:title" content="Useful JVM Flags - Part 7 (CMS Collector) - codecentric AG Blog" /><meta property="og:description" content="The Concurrent Mark Sweep Collector (“CMS Collector”) of the HotSpot JVM has one primary goal: low application pause times. This goal is important for most interactive applications like web applications. Before we take a look at the relevant JVM flags, let us briefly recap the operation of the CMS Collector and the main challenges that... Read more" /><meta property="og:url" content="https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/" /><meta property="og:site_name" content="codecentric AG Blog" /><meta property="article:publisher" content="https://www.facebook.com/codecentric" /><meta property="article:section" content="Java" /><meta property="article:published_time" content="2013-10-16T21:10:57+02:00" /><meta property="fb:admins" content="828173743" /><meta name="twitter:card" content="summary" /><meta name="twitter:description" content="The Concurrent Mark Sweep Collector (“CMS Collector”) of the HotSpot JVM has one primary goal: low application pause times. This goal is important for most interactive applications like web applications. Before we take a look at the relevant JVM flags, let us briefly recap the operation of the CMS Collector and the main challenges that... Read more" /><meta name="twitter:title" content="Useful JVM Flags - Part 7 (CMS Collector) - codecentric AG Blog" /><meta name="twitter:site" content="@codecentric" /><meta name="twitter:creator" content="@codecentric" /><link rel='dns-prefetch' href='//ajax.googleapis.com' /><link rel='dns-prefetch' href='//s.w.org' /> <script type="text/javascript">window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.codecentric.de\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.1"}}; !function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b===c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);</script> <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js?ver=1.11.0'></script> <link rel='https://api.w.org/' href='https://blog.codecentric.de/en/wp-json/' /><link rel="alternate" type="application/json+oembed" href="https://blog.codecentric.de/en/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.codecentric.de%2Fen%2F2013%2F10%2Fuseful-jvm-flags-part-7-cms-collector%2F" /><link rel="alternate" type="text/xml+oembed" href="https://blog.codecentric.de/en/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.codecentric.de%2Fen%2F2013%2F10%2Fuseful-jvm-flags-part-7-cms-collector%2F&#038;format=xml" /><meta name="generator" content="WPML ver:3.2.2 stt:1,3;" /><link rel="alternate" hreflang="en-US" href="https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/"/><link rel="alternate" hreflang="x-default" href="https://blog.codecentric.de/2013/03/nutzliche-jvm-flags-teil-7/"/><link rel="shortcut icon" type="image/x-icon" href="/wp-content/themes/codecentric2015-HP/img/icons/favicon.ico" /> <script type="text/javascript">var analyticsFileTypes = ['']; var analyticsSnippet = 'disabled'; var analyticsEventTracking = 'enabled';</script> <script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-2828835-3', 'auto'); ga('send', 'pageview');</script> </head><body class="post-template-default single single-post postid-20127 single-format-standard en useful-jvm-flags-part-7-cms-collector"><header class="hidden-xs"><div class="header-top-outer-wrap"><div class="header-search-wrap"><div class="header-search"><div class="container"><div class="row"><div class="col-md-12"><div class="row"><form class="search" method="get" action="https://blog.codecentric.de/en" role="search"> <input class="search-input col-md-10" type="search" name="s" placeholder="To search, type and hit enter."><div class="col-md-2 pull-right text-right"> <input type="image" src="/wp-content/themes/codecentric2015/img/suche_lupe.png" alt="To search, type and hit enter."/> <span class="searchform-close"></span></div><input type='hidden' name='lang' value='en' /></form></div></div></div></div></div></div><div class="header-top-wrap"><div class="header-top"><div class="container"><div class="row regular"><div class="col-md-3 hidden-sm"> <a href="https://www.codecentric.de/"> <img src="https://blog.codecentric.de/wp-content/themes/codecentric2015/img/codecentric-logo.png" class="cc-logo" alt="codecentric"/> </a></div><div class="col-sm-2 visible-sm"> <a href="https://www.codecentric.de/"> <img src="https://blog.codecentric.de/wp-content/themes/codecentric2015/img/codecentric-logo-mobil-active.png" class="cc-logo" alt="codecentric"/> </a></div><div class="col-sm-10 col-md-9 pull-right"><ul class="list-inline list-unstyled top-nav"><li><a href="https://www.codecentric.de/leistungen/" class="">Services</a></li><li><a href="https://www.codecentric.de/karriere/" class="">Career</a></li><li><a href="https://www.codecentric.de/wissen/" class="">Knowledge</a></li><li><a href="https://blog.codecentric.de/en/" class="active">Blog</a></li><li><a href="https://www.codecentric.de/aktuelles/" class="">News</a></li><li><a href="https://www.codecentric.de/ueber-uns/" class="">About us</a></li><li class="searchform-wrap"> <span class="searchform"></span></li><li class="last"> <a href="https://blog.codecentric.de/2013/03/nutzliche-jvm-flags-teil-7/" class="lang">de</a></li></ul></div></div></div></div></div></div><div class="header-bottom"><div class="container"><div class="row"><div class="col-md-12"><div class="title"><a href="https://blog.codecentric.de/">codecentric Blog</a></div><h1 class="homepage"> IT Knowledge from developers for developers</h1><div class="counterWrap"><div class="counterWrapInner"><p> <span class="counter" data-count="1408">0</span><br/> Posts</p></div></div></div></div></div></div></header><header class="visible-xs"><div class="header-search header-search-mobil"><div class="row"><form class="search" method="get" action="https://blog.codecentric.de/en" role="search"> <input class="search-input col-md-10" type="search" name="s" placeholder="To search, type and hit enter."><div class="col-md-2 pull-right text-right"> <input type="image" src="/wp-content/themes/codecentric2015/img/suche_lupe.png" alt="To search, type and hit enter."/> <span class="searchform-close"></span></div><input type='hidden' name='lang' value='en' /></form></div></div><div class="header-top header-top-mobil"><div class="container"><div class="row"><div class="col-xs-2"><div class="trigger-menu trigger-menu-mobil"> <span></span></div></div><div class="col-xs-8 text-center"> <img src="https://blog.codecentric.de/wp-content/themes/codecentric2015/images/codecentric-logo.png" class="logo img-responsive" alt="codecentric"></div><div class="col-xs-2 text-right"><span class="search-trigger-mobil"> <img src="/wp-content/themes/codecentric2015/img/suche_lupe.png" alt="codecentric"/> </span></div></div></div></div><div class="header-bottom"><div class="container"><div class="row"><div class="col-md-12"><div class="title"><a href="https://blog.codecentric.de/">codecentric Blog</a></div></div></div></div></div></header><nav class="category-nav"><div class="container"><div class="row"><div class="col-md-12"><ul id="menu-category-navigation-en" class="list-inline list-unstyled"><li id="menu-item-28513" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-28513"><a href="/en/">New</a></li><li id="menu-item-28518" class="agile menu-item menu-item-type-taxonomy menu-item-object-category menu-item-28518"><a href="https://blog.codecentric.de/en/category/agile-en/">Agile</a></li><li id="menu-item-28519" class="architektur menu-item menu-item-type-taxonomy menu-item-object-category menu-item-28519"><a href="https://blog.codecentric.de/en/category/architecture/">Architecture</a></li><li id="menu-item-28520" class="java menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28520"><a href="https://blog.codecentric.de/en/category/java-en/">Java</a></li><li id="menu-item-28521" class="performance menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28521"><a href="https://blog.codecentric.de/en/category/performance-en/">Performance</a></li><li id="menu-item-28522" class="continuous-delivery menu-item menu-item-type-taxonomy menu-item-object-category menu-item-28522"><a href="https://blog.codecentric.de/en/category/continuous-delivery-agile-en/">Continuous Delivery</a></li><li id="menu-item-28523" class="microservices menu-item menu-item-type-taxonomy menu-item-object-category menu-item-28523"><a href="https://blog.codecentric.de/en/category/architecture/microservices-architecture/">Microservices</a></li><li id="menu-item-28524" class="cloud menu-item menu-item-type-taxonomy menu-item-object-category menu-item-28524"><a href="https://blog.codecentric.de/en/category/architecture/cloud-architecture/">Cloud</a></li></ul><div class="close-category-nav"></div><div class="open-category-nav"></div><div class="rssLink"><a href="" class="hidden-xs"><i class="fa fa-rss" aria-hidden="true"></i> RSS-Feed</a></div></div></div></div></nav><main role="main"><section class="article-single-item"><div class="container"><div class="row"><div class="col-lg-3 col-md-2"> <a href="https://blog.codecentric.de/en/category/java-en/" title="Java" class="back">Overview</a><div class="banner hidden-sm hidden-xs"><div id="instanaBanner"> <span class="hs-cta-wrapper" id="hs-cta-wrapper-cab37222-7327-4b41-8534-bd8c4154b2d1"> <span class="hs-cta-node hs-cta-cab37222-7327-4b41-8534-bd8c4154b2d1" id="hs-cta-cab37222-7327-4b41-8534-bd8c4154b2d1"> <!--[if lte IE 8]><div id="hs-cta-ie-element"></div><![endif]--> <a href="http://cta-redirect.hubspot.com/cta/redirect/1918859/cab37222-7327-4b41-8534-bd8c4154b2d1" target="_blank" ><img class="hs-cta-img img-responsive" id="hs-cta-img-cab37222-7327-4b41-8534-bd8c4154b2d1" style="border-width:0px;" src="https://no-cache.hubspot.com/cta/default/1918859/cab37222-7327-4b41-8534-bd8c4154b2d1.png" alt="The instana robot complete"/></a> </span> <script charset="utf-8" src="https://js.hscta.net/cta/current.js"></script> <script type="text/javascript">hbspt.cta.load(1918859, 'cab37222-7327-4b41-8534-bd8c4154b2d1', {});</script> </span></div></div></div><div class="col-lg-6 col-md-8"><article id="post-20127" class="post-20127 post type-post status-publish format-standard hentry category-java-en category-performance-en"><h1> <a href="https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/" title="Useful JVM Flags &#8211; Part 7 (CMS Collector)">Useful JVM Flags &#8211; Part 7 (CMS Collector)</a></h1><p class="article-details pull-left"> <span class="post-date">10/16/13</span> <span class="post-author">by <a href="https://blog.codecentric.de/en/author/patrick-peschlow/" title="Posts by Patrick Peschlow" rel="author">Patrick Peschlow</a> </span></p><p class="article-comments pull-right"> <a href="https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/#comments" title="Useful JVM Flags &#8211; Part 7 (CMS Collector)">3 Comments </a></p><div class="clearfix"></div><p>The Concurrent Mark Sweep Collector (“CMS Collector”) of the HotSpot JVM has one primary goal: low application pause times. This goal is important for most interactive applications like web applications. Before we take a look at the relevant JVM flags, let us briefly recap the operation of the CMS Collector and the main challenges that may arise when using it.</p><p><span id="more-20127"></span>Just like the Throughput Collector (see <a title="Useful JVM Flags – Part 6 (Throughput Collector)" href="http://blog.codecentric.de/en/2013/01/useful-jvm-flags-part-6-throughput-collector/">part 6</a> of the series), the CMS Collector handles objects in the old generation, yet its operation is much more complex. The Throughput Collector always pauses the application threads, possibly for a considerable amount of time, which however enables its algorithms to safely ignore the application. In contrast to that, the CMS Collector is designed to run mostly concurrent to the application threads and only cause few (and short) pause times. The downside of running GC concurrently to the application is that various synchronization and data inconsistency issues may arise. In order to achieve safe and correct concurrent execution, a GC cycle of the CMS Collector is divided into a number of consecutive phases.</p><p><strong>Phases of the CMS Collector</strong></p><p>A GC cycle of the CMS Collector consists of six phases. Four of the phases (the names of which start with „Concurrent“) are run concurrently to the actual application while the other two phases need to stop the application threads.</p><ol><li>Initial Mark: The application threads are paused in order to collect their object references. When this is finished, the application threads are started again.</li><li>Concurrent Mark: Starting from the object references collected in phase 1, all other referenced objects are traversed.</li><li>Concurrent Preclean: Changes to object references made by the application threads while phase 2 was running are used to update the results from phase 2.</li><li>Remark: As phase 3 is concurrent as well, further changes to object references may have happened. Therefore, the application threads are stopped once more to take any such updates into account and ensure a correct view of referenced objects before the actual cleaning takes place. This step is essential because it must be avoided to collect any objects that are still referenced.</li><li>Concurrent Sweep: All objects that are not referenced anymore get removed from the heap.</li><li>Concurrent Reset: The collector does some housekeeping work so that there is a clean state when the next GC cycle starts.</li></ol><p>A common misconception is that the CMS collector runs fully concurrent to the application. We have seen that this is not the case, even if the stop-the-world phases are usually very short when compared to the concurrent phases.</p><p>It should be noted that, even though the CMS Collector offers a mostly concurrent solution for old generation GCs, young generation GCs are still handled using a stop-the-world approach. The rationale behind this is that young generation GCs are typically short enough so that the resulting pause times are satisfactory even for interactive applications.</p><p><strong>Challenges</strong><br /> When using the CMS Collector in real-world applications, we face two major challenges that may create a need for tuning:</p><ol><li>Heap fragmentation</li><li>High object allocation rate</li></ol><p>Heap fragmentation is possible because, unlike the Throughput Collector, the CMS Collector does not contain any mechanism for defragmentation. As a consequence, an application may find itself in a situation where an object cannot be allocated even though the total heap space is far from exhausted – simply because there is no consecutive memory area available to fully accommodate the object. When this happens, the concurrent algorithms do not help anymore and thus, as a last resort, the JVM triggers a full GC. Recall that a full GC runs the algorithm used by the Throughput Collector and thus resolves the fragmentation issues – but it also stops the application threads. Thus, despite all the concurrency that the CMS Collector brings, there is still a risk of a long stop-the-world pause happening. This is “by design” and cannot be switched off – we can only reduce its likelihood by tuning the collector. Which is problematic for interactive applications that would like to have a 100% guarantee of being safe from any noticeable stop-the-world pauses.</p><p>The second challenge is high object allocation rate of the application. If the rate at which objects get instantiated is higher than the rate at which the collector removes dead objects from the heap, the concurrent algorithm fails once again. At some point, the old generation will not have enough space available to accommodate an object that is to be promoted from the young generation. This situation is referred to as “concurrent mode failure”, and the JVM reacts just like in the heap fragmentation scenario: It triggers a full GC.</p><p>When one of these scenarios manifests itself in practice (which, as is so often the case, usually happens on a production system), it often turns out that there is an unnecessary large amount of objects in the old generation. One possible countermeasure is to increase young generation size, in order to prevent premature promotions of short-lived objects into the old generation. Another approach is to use a profiler, or take heap dumps of the running system, to analyze the application for excessive object allocation, identify these objects, and eventually reduce the amount of objects allocated.</p><p>In the following we will take a look at the most relevant JVM flags available for tuning the CMS Collector.</p><p><strong>-XX:+UseConcMarkSweepGC</strong></p><p>This flag is needed to activate the CMS Collector in the first place. By default, HotSpot uses the Throughput Collector instead.</p><p><strong>-XX:+UseParNewGC</strong></p><p>When the CMS collector is used, this flag activates the parallel execution of young generation GCs using multiple threads. It may seem surprising at first that we cannot simply reuse the flag <code>-XX:+UseParallelGC</code> known from the Throughput Collector, because conceptually the young generation GC algorithms used are the same. However, since the interplay between the young generation GC algorithm and the old generation GC algorithm is different with the CMS collector, there are two different implementations of young generation GC and thus two different flags.</p><p>Note that with recent JVM versions <code>-XX:+UseParNewGC</code> is enabled automatically when <code>-XX:+UseConcMarkSweepGC</code> is set. As a consequence, if parallel young generation GC is not desired, it needs to be disabled by setting <code>-XX:-UseParNewGC</code>.</p><p><strong>-XX:+CMSConcurrentMTEnabled</strong></p><p>When this flag is set, the concurrent CMS phases are run with multiple threads (and thus, multiple GC threads work in parallel with all the application threads). This flag is already activated by default. If serial execution is preferred, which may make sense depending on the hardware used, multithreaded execution can be deactivated via <code>-XX:-CMSConcurrentMTEnabled</code>.</p><p><strong>-XX:ConcGCThreads</strong></p><p>The flag <code>-XX:ConcGCThreads=&lt;value&gt;</code> (in earlier JVM versions also known as <code>-XX:ParallelCMSThreads</code>) defines the number of threads with which the concurrent CMS phases are run. For example, value=4 means that all concurrent phases of a CMS cycle are run using 4 threads. Even though a higher number of threads may well speed up the concurrent CMS phases, it also causes additional synchronization overhead. Thus, for a particular application at hand, it should be measured if increasing the number of CMS threads really brings an improvement or not.</p><p>If this flag is not explicitly set, the JVM computes a default number of parallel CMS threads which depends on the value of the flag <code>-XX: ParallelGCThreads</code> known from the Throughput Collector. The formula used is ConcGCThreads = (ParallelGCThreads + 3)/4. Thus, with the CMS Collector, the flag <code>-XX:ParallelGCThreads</code> does not only affect stop-the-world GC phases but also the concurrent phases.</p><p>In summary, there are quite a few ways of configuring multithreaded execution of the CMS collector. Precisely for this reason, it is recommended to first run the CMS Collector with its default settings and then measure if there is a need for tuning at all. Only if measurements in a production system (or a production-like test system) show that the pause time goals of the application are not reached, GC tuning via these flags should be considered.</p><p><strong>-XX:CMSInitiatingOccupancyFraction</strong></p><p>The Throughput Collector starts a GC cycle only when the heap is full, i.e., when there is not enough space available to store a newly allocated or promoted object. With the CMS Collector, it is not advisable to wait this long because it the application keeps on running (and allocating objects) during concurrent GC. Thus, in order to finish a GC cycle before the application runs out of memory, the CMS Collector needs to start a GC cycle much earlier than the Throughput Collector.</p><p>As different applications have different object allocation patterns, the JVM collects run time statistics about the actual object allocations (and deallocations) it observes and uses them to determine when to start a CMS GC cycle. To bootstrap this process, the JVM takes a hint when to start the very first CMS run. The hint may be set via <code>-XX:CMSInitiatingOccupancyFraction=&lt;value&gt;</code> where value denotes the utilization of old generation heap space in percent. For example, value=75 means that the first CMS cycle starts when 75% of the old generation is occupied. Traditionally, the default value of CMSInitiatingOccupancyFraction is 68 (which was determined empirically quite some time ago).</p><p><strong>-XX+UseCMSInitiatingOccupancyOnly</strong></p><p>We can use the flag <code>-XX+UseCMSInitiatingOccupancyOnly</code> to instruct the JVM not to base its decision when to start a CMS cycle on run time statistics. Instead, when this flag is enabled, the JVM uses the value of <code>CMSInitiatingOccupancyFraction</code> for every CMS cycle, not just for the first one. However, keep in mind that in the majority of cases the JVM does a better job of making GC decisions than us humans. Therefore, we should use this flag only if we have good reason (i.e., measurements) as well as really good knowledge of the lifecycle of objects generated by the application.</p><p><strong>-XX:+CMSClassUnloadingEnabled</strong></p><p>In contrast to the Throughput Collector, the CMS Collector does not perform GC in the permanent generation by default. If permanent generation GC is desired, it can be enabled via <code>-XX:+CMSClassUnloadingEnabled</code>. In earlier JVM versions, it may be required to additionally set the flag <code>-XX:+CMSPermGenSweepingEnabled</code>. Note that, even if this flag is not set, there will be an attempt to garbage-collect permanent generation once it runs out of space, but the collection will not be concurrent – instead, once again, a full GC will be run.</p><p><strong>-XX:+CMSIncrementalMode</strong></p><p>This flag activates the incremental mode of the CMS Collector. Incremental mode pauses the concurrent CMS phases regularly, so as to yield completely to the application threads. As a consequence, the collector will take longer to complete a whole CMS cycle. Therefore, using incremental mode only makes sense if it has been measured that the threads running a normal CMS cycle interfere too much with the application threads. This happens rather rarely on modern server hardware which usually has enough processors available to accommodate concurrent GC.</p><p><strong>-XX:+ExplicitGCInvokesConcurrent and -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses</strong></p><p>Nowadays, the widely accepted best practice is to refrain from explicitly invoking GC (a so-called “system GC”) by calling System.gc() in the application. While this advice holds regardless of the GC algorithm used, it is worth mentioning that a system GC is an especially unfortunate event when the CMS Collector is used, because it triggers a full GC by default. Luckily, there is a way to change the default. The flag <code>-XX:+ExplicitGCInvokesConcurrent</code> instructs the JVM to run a CMS GC instead of a full GC whenever system GC is requested. There is a second flag, <code>-XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses</code>, which additionally ensures that the permanent generation is included into the CMS GC in case of a system GC request. Thus, by using these flags, we can safeguard ourselves against unexpected stop-the-world system GCs.</p><p><strong>-XX:+DisableExplicitGC</strong></p><p>And while we are on the subject&#8230; this is a good opportunity to mention the flag <code>-XX:+DisableExplicitGC</code> which tells the JVM to completely ignore system GC requests (regardless of the type of collector used). For me, this flag belongs to a set of “default” flags that can be safely specified on every JVM run without further thinking.</p></article></div><div class="col-lg-3 col-md-2 pull-right"> <span class="next-posts"> <a href="https://blog.codecentric.de/en/2013/10/java-8-first-steps-lambdas-streams/" rel="next">Java 8 first steps with Lambdas and Streams</a> </span><div class="banner hidden-sm hidden-xs"></div></div></div></div><div class="article-single-author"><div class="container"><div class="row"><div class="col-lg-3 col-md-2"><h2><a href="https://blog.codecentric.de/en/author/patrick-peschlow/" title="Posts by Patrick Peschlow" rel="author">Patrick Peschlow</a></h2></div><div class="col-lg-6 col-md-8"><div class="row"><div class="col-md-2 col-xs-3 col-sm-3"> <img src="https://blog.codecentric.de/files/2015/10/patrick_peschlow-250x250.jpg" width="200" height="200" alt="Patrick Peschlow" class="avatar avatar-200 wp-user-avatar wp-user-avatar-200 alignnone photo" /></div><div class="col-md-10 col-xs-9 col-sm-9"></div></div></div></div><div class="row"><div class="col-md-6 col-md-offset-3"><div class="ssba ssba-wrap"><div style="text-align:left"><a data-site="" class="ssba_facebook_share" href="http://www.facebook.com/sharer.php?u=https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/" target="_blank" ><img src="/wp-content/themes/codecentric2015/img/icon-facebook.png" title="Facebook" class="ssba ssba-img" alt="Share on Facebook" /></a><a data-site="" class="ssba_google_share" href="https://plus.google.com/share?url=https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/" target="_blank" ><img src="/wp-content/themes/codecentric2015/img/icon-google.png" title="Share on Google+" class="ssba ssba-img" alt="Google+" /></a><a data-site="linkedin" class="ssba_linkedin_share ssba_share_link" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/" target="_blank" ><img src="/wp-content/themes/codecentric2015/img/icon-linkedin.png" alt="Share on LinkedIn" title="LinkedIn" class="ssba ssba-img" /></a><a data-site="" class="ssba_twitter_share" href="http://twitter.com/share?url=https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/&amp;text=Useful+JVM+Flags+%E2%80%93+Part+7+%28CMS+Collector%29+%23codecentric" target="_blank" ><img src="/wp-content/themes/codecentric2015/img/icon-twitter.png" title="Twitter" class="ssba ssba-img" alt="Tweet about this on Twitter" /></a><a data-site="reddit" class="ssba_reddit_share" href="http://reddit.com/submit?url=https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/&amp;title=Useful JVM Flags &#8211; Part 7 (CMS Collector)" target="_blank" ><img src="/wp-content/themes/codecentric2015/img/icon-reddit.png" title="Reddit" class="ssba ssba-img" alt="Share on Reddit" /></a><a data-site="digg" class="ssba_diggit_share ssba_share_link" href="http://www.digg.com/submit?url=https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/" target="_blank" ><img src="/wp-content/themes/codecentric2015/img/icon-digg.png" title="Digg" class="ssba ssba-img" alt="Digg this" /></a><a data-site="stumbleupon" class="ssba_stumbleupon_share ssba_share_link" href="http://www.stumbleupon.com/submit?url=https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/&#038;title=Useful%20JVM%20Flags%20&#8211;%20Part%207%20(CMS%20Collector)" target="_blank" ><img src="/wp-content/themes/codecentric2015/img/icon-stumple.png" alt="Share on StumbleUpon" title="StumbleUpon" class="ssba ssba-img" /></a></div></div></div></div></div></div><div class="container"><div class="row article-single-links"><div class="col-md-5 col-md-5"><h2>Post by <strong>Patrick Peschlow</strong></h2><div class="author-post-item"><p><a href="https://blog.codecentric.de/2015/04/elasticon-erste-elasticsearch-user-konferenz-in-san-francisco/">Elastic{ON}: Erste Elasticsearch-User-Konferenz in San Francisco</a></p></div><div class="author-post-item"><span class="cat-name">Search</span><p><a href="https://blog.codecentric.de/en/2015/03/scaling-elasticsearch-index-introduction/">Scaling an Elasticsearch Index &#8211; Introduction</a></p></div></div><div class="col-md-7 col-md-5"><div class="row"><div class="col-md-12"><h2>More content about <strong>Java</strong></h2><div class="row"><div class="col-md-8"><div class="related-post-item"> <span class="cat-name">Java</span><p> <a href="https://blog.codecentric.de/en/2017/08/parsing-of-localdate-query-parameters-in-spring-boot/">Parsing of LocalDate query parameters in Spring Boot</a></p></div><div class="related-post-item"> <span class="cat-name">Java</span><p> <a href="https://blog.codecentric.de/en/2017/08/defence-autistic-tools/">In defence of pedantic tools</a></p></div></div></div></div></div></div></div></div><a id="comments"></a><div class="container article-single-comments"><div class="row"><div class="col-md-3"><h2>Kommentare</h2></div><div class="col-md-6"><ul class="list-unstyled"><li class="comment even thread-even depth-1" id="comment-165025"><div id="div-comment-165025" class="comment-body row"><div class="comment-author vcard col-md-2"> <img src="https://secure.gravatar.com/avatar/cf478e1835a5980a8b05055cd9a5f9f9?s=96&d=mm&r=g" alt="JPaul"/></div><div class="comment-text col-md-10"><p class="comment-info"> <a href="https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/#comment-165025"> 19. October 2013</a> von <a href='http://java67.blogspot.com' rel='external nofollow' class='url'>JPaul</a></p></div><div class="col-md-10 col-md-offset-2"><p>Great post and nice information on CMS Collector working. Knowledge of JVM internals and flags is always important for a senior developer, and your article did help on that, some flags are also worth including in my my list of <a href="http://javarevisited.blogspot.com/2011/11/hotspot-jvm-options-java-examples.html" rel="nofollow">Top 10 JVM flags for Java programmers</a>. keep it up</p><div class="reply"> <a rel='nofollow' class='comment-reply-link' href='https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/?replytocom=165025#respond' onclick='return addComment.moveForm( "div-comment-165025", "165025", "respond", "20127" )' aria-label='Reply to JPaul'>Reply</a></div></div></div></li><li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-165044"><div id="div-comment-165044" class="comment-body row"><div class="comment-author vcard col-md-2"> <img src="https://secure.gravatar.com/avatar/f879549f79442edf85697e5bfe95fc61?s=96&d=mm&r=g" alt="Kelvin Woo"/></div><div class="comment-text col-md-10"><p class="comment-info"> <a href="https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/#comment-165044"> 31. October 2013</a> von Kelvin Woo</p></div><div class="col-md-10 col-md-offset-2"><p>this series of Useful JVM Flags is a useful and practical article that could not be found in the book!! good articles !!</p><div class="reply"> <a rel='nofollow' class='comment-reply-link' href='https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/?replytocom=165044#respond' onclick='return addComment.moveForm( "div-comment-165044", "165044", "respond", "20127" )' aria-label='Reply to Kelvin Woo'>Reply</a></div></div></div><ul class="children"><li class="comment byuser comment-author-patrick-peschlow bypostauthor even depth-2" id="comment-165045"><div id="div-comment-165045" class="comment-body row"><div class="comment-author vcard col-md-2"> <img src="https://blog.codecentric.de/files/2015/10/patrick_peschlow-120x120.jpg" alt="Patrick Peschlow"/></div><div class="comment-text col-md-10"><p class="comment-info"> <a href="https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/#comment-165045"> 31. October 2013</a> von <a href='http://blog.codecentric.de' rel='external nofollow' class='url'>Patrick Peschlow</a></p></div><div class="col-md-10 col-md-offset-2"><p>Thanks! As you mention &#8220;the book&#8221;, when I recently opened &#8220;Java Performance&#8221; by Charlie Hunt and Binu John it turned out it contains a nice overview of HotSpot flags in the appendix. I would recommend it.</p><div class="reply"> <a rel='nofollow' class='comment-reply-link' href='https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/?replytocom=165045#respond' onclick='return addComment.moveForm( "div-comment-165045", "165045", "respond", "20127" )' aria-label='Reply to Patrick Peschlow'>Reply</a></div></div></div></li></ul></li></ul></div></div><div class="row"><div class="col-md-3"><h2>Comment</h2></div><div class="col-md-7"><div id="respond" class="comment-respond"><h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="/en/2013/10/useful-jvm-flags-part-7-cms-collector/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://blog.codecentric.de/wp-comments-post.php" method="post" id="commentform" class="comment-form form-horizontal"><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><div class="form-group"><div class="col-md-12"><textarea autocomplete="nope"  placeholder="Nachricht" id="9467023d12"  name="6ae7ba517c"  class="form-control"  cols="45" rows="8" aria-required="true"></textarea><textarea id="comment" aria-hidden="true" name="comment" autocomplete="nope" style="clip:rect(1px, 1px, 1px, 1px);position:absolute !important;white-space:nowrap;height:1px;width:1px;overflow:hidden;" tabindex="-1"></textarea><script type="text/javascript">document.getElementById("comment").setAttribute( "id", "e2b0c4f90d0d30a77ff27d4e7a7ae539" );document.getElementById("9467023d12").setAttribute( "id", "comment" );</script></div></div><div class="form-group"><div class="col-md-6"><input id="author" class="form-control" placeholder="Name" name="author" type="text" value="" size="30" /></div><div class="col-md-6"><input placeholder="E-Mail" id="email" name="email" class="form-control" type="text" value="" size="30" /></div></div><p class="form-submit"><input name="submit" type="submit" id="submit" class="btn btn-default pull-right" value="Submit" /> <input type='hidden' name='comment_post_ID' value='20127' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></p><p class="subscribe-to-doi-comments"> <label for="subscribe"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;" /> Notify me of followup comments via e-mail</label></p></form></div></div></div></div></section></main><footer class="footer" role="contentinfo"><div class="container"><div class="row footer-sitemap"><div class="col-md-4 col-sm-12"><h3> Newsletter</h3><form action="https://www.codecentric.de/formulare/newsletter/" class="form-inline" target="_blank" method="post"><div class="form-group"><div class="row"><div class="col-xs-12"> <input type="email" class="form-control" name="email" placeholder="E-Mail Adresse"/><input type="submit" value="Submit" class=" form-control btn btn-default"/></div></div></div></form></div></div><div class="row"><div class="visible-xs col-xs-12"><ul class="list-inline list-unstyled icons-footer"><li class="first"> <a href="https://www.facebook.com/codecentric" target="_blank"> <img src="/wp-content/themes/codecentric2015/img/facebook.gif" alt="codecentric - Facebook"/> </a></li><li class="last"> <a href="https://twitter.com/codecentric" target="_blank"> <img src="/wp-content/themes/codecentric2015/img/twitter.gif" alt="codecentric - Twitter"/> </a></li></ul></div><div class="col-xs-12 col-sm-10"><ul class="list-inline list-unstyled footer-metanav"><li><a href="https://www.codecentric.de/impressum-datenschutz/" target="_blank" class="">Imprint</a></li><li><a href="https://www.codecentric.de/terms-and-conditions/" target="_blank" class="">Privacy Policy</a></li><li><a href="https://www.codecentric.de/ueber-codecentric/kontakt/" target="_blank" class="">Contact</a></li></ul></div><div class="hidden-xs col-sm-2 pull-right"><ul class="list-inline list-unstyled pull-right icons-footer"><li class="first"> <a href="https://www.facebook.com/codecentric" target="_blank"> <img src="/wp-content/themes/codecentric2015/img/facebook.gif" alt="codecentric - Facebook"/> </a></li><li class="last"> <a href="https://twitter.com/codecentric" target="_blank"> <img src="/wp-content/themes/codecentric2015/img/twitter.gif" alt="codecentric - Twitter"/> </a></li></ul></div></div></div></footer><div class="searchform-overlay"></div><div class="mobile-navi-overlay"></div><div class="mobile-navi"><div class="container"><div class="row"><div class="col-xs-12"><div class="trigger-menu trigger-menu-mobil-active"> <span>X</span></div><ul class="list-unstyled"><li><a href="https://www.codecentric.de/leistungen/" class="">Services</a></li><li><a href="https://www.codecentric.de/karriere/" class="">Career</a></li><li><a href="https://www.codecentric.de/wissen/" class="">Knowledge</a></li><li><a href="https://blog.codecentric.de/en/" class="active">Blog</a></li><li><a href="https://www.codecentric.de/aktuelles/" class="">News</a></li><li><a href="https://www.codecentric.de/ueber-uns/" class="">About us</a></li><li><a href="https://blog.codecentric.de/2013/03/nutzliche-jvm-flags-teil-7/" class="lang">Deutsch</a></li></ul></div></div></div></div> <script type='text/javascript'>var icl_vars = {"current_language":"en","icl_home":"https:\/\/blog.codecentric.de\/en\/"};</script> <script>(function(h,o,t,j,a,r){ h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)}; h._hjSettings={hjid:325170,hjsv:5}; a=o.getElementsByTagName('head')[0]; r=o.createElement('script');r.async=1; r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv; a.appendChild(r); })(window,document,'//static.hotjar.com/c/hotjar-','.js?sv=');</script> <script type="text/javascript">(function(d,s,i,r) { if (d.getElementById(i)){return;} var n=d.createElement(s),e=d.getElementsByTagName(s)[0]; n.id=i;n.src='//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/1918859.js'; e.parentNode.insertBefore(n, e); })(document,"script","hs-analytics",300000);</script> <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/1918859.js"></script> <script type="application/ld+json">{ "@context" : "http://schema.org", "@type": "LocalBusiness", "geo":{ "@type":"GeoCoordinates", "latitude":51.162073, "longitude":-7.007063 }, "address" : { "addressLocality": "Solingen", "addressRegion": "NRW", "postalCode": "42697", "streetAddress": "Hochstraße 11" }, "name":"codecentric AG", "url":"https://www.codecentric.de/", "email":"info@codecentric.de", "telephone":"+4902122336280", "image":"https://blog.codecentric.de/wp-content/themes/codecentric2015/img/codecentric-logo.png" }</script> <script type="text/javascript" defer src="https://blog.codecentric.de/wp-content/cache/autoptimize/2/autoptimize_e2f30fc27c1231b8c228cc68eac4af9b.php"></script></body></html>

<!--
Cachify | http://cachify.de
Ohne Plugin: 124 DB-Anfragen, 0.36 Sekunden, 16.67 MB
Mit Plugin: 50 DB-Anfragen, 0.16 Sekunden, 13.87 MB
Generiert: 13 mins zuvor
-->