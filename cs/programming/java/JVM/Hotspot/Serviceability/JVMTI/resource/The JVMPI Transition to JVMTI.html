<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html class="nobg">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript">
   var _U = "undefined";
   var g_HttpRelativeWebRoot = "/ocom/";
   var SSContributor = false;
   var SSForceContributor = false;
   var SSHideContributorUI = false;
   var ssUrlPrefix = "/technetwork/";
   var ssUrlType = "2";
   
   var g_navNode_Path = new Array();
       g_navNode_Path[0] = 'otnen';
       g_navNode_Path[1] = 'otnen_articles';
       g_navNode_Path[2] = 'otnen_articles_java';
   var g_ssSourceNodeId = "otnen_articles_java";
   var g_ssSourceSiteId = "otnen";
</script>



  <script id="ssInfo" type="text/xml" warning="DO NOT MODIFY!">
  <ssinfo >
    <fragmentinstance  id="fragment14" fragmentid="Universal_Localization_Fragment" library="server:UNIVERSAL_LOCALIZATION_FRAG">
    </fragmentinstance>
    <fragmentinstance  id="fragment16" fragmentid="Universal_Localization_Fragment" library="server:UNIVERSAL_LOCALIZATION_FRAG">
    </fragmentinstance>
    <fragmentinstance  id="fragment17" fragmentid="Universal_Localization_Fragment" library="server:UNIVERSAL_LOCALIZATION_FRAG">
    </fragmentinstance>
    <fragmentinstance  id="fragment18" fragmentid="universal-search-fragment" library="server:UNIVERSAL-SEARCH-FRAGMET-LIB">
      
    </fragmentinstance>
    <fragmentinstance  id="fragment22" fragmentid="Universal_Localization_Fragment" library="server:UNIVERSAL_LOCALIZATION_FRAG">
    </fragmentinstance>
    <fragmentinstance  id="fragment23" fragmentid="ocom-commonassets" library="server:OCOM-FRAGMENT-LIBRARAY">
      
    </fragmentinstance>
    <fragmentinstance  id="fragment24" fragmentid="ExternalNavigationHorizontal" library="server:EXTERNALNAVHORIZONTALLIB">
    </fragmentinstance>
    <fragmentinstance  id="fragment25" fragmentid="ExternalNavVertical" library="server:EXTERNAL_NAV_VERTICAL">
    </fragmentinstance>
    <fragmentinstance  id="fragment27" fragmentid="Universal_Localization_Fragment" library="server:UNIVERSAL_LOCALIZATION_FRAG">
    </fragmentinstance>
    <fragmentinstance  id="fragment28" fragmentid="Universal_Localization_Fragment" library="server:UNIVERSAL_LOCALIZATION_FRAG">
    </fragmentinstance>
    <fragmentinstance  id="fragment29" fragmentid="ExternalBreadCrumb" library="server:EXTERNAL_BREADCRUMB">
    </fragmentinstance>
    <fragmentinstance  id="fragment32" fragmentid="universal-metatag" library="server:UNIVERSAL-FRAGMENTS">
    </fragmentinstance>
    <fragmentinstance  id="fragment33" fragmentid="ExternalNavTabsTop" library="server:EXTERNAL_NAV_TABS_TOP">
    </fragmentinstance>
    <fragmentinstance  id="fragment35" fragmentid="universal-webcache-integration" library="server:UNIVERSAL-WEBCACHE-INTEGRATION">
      
    </fragmentinstance>
    <fragmentinstance  id="fragment37" fragmentid="Universal_Localization_Fragment" library="server:UNIVERSAL_LOCALIZATION_FRAG">
    </fragmentinstance>
    <fragmentinstance  id="fragment38" fragmentid="sitecatalyst-otn-standard" library="server:SITECATALYST-OTN-STANDARD">
      
    </fragmentinstance>
    <fragmentinstance  id="fragment39" fragmentid="universal-addthis-print-email" library="server:UNIVERSAL-FRAGMENTS">
      
    </fragmentinstance>
      <fragmentinstance  id="fragment40" fragmentid="mosaic-header-content" library="server:MOSAIC-HEADER-CONTENT">
        
      </fragmentinstance>
      <fragmentinstance  id="fragment41" fragmentid="ocomheader" library="server:OCOMHEADER">
        
      </fragmentinstance>
      <fragmentinstance  id="fragment42" fragmentid="ocomfooter" library="server:OCOMFOOTER">
        
      </fragmentinstance>
      <fragmentinstance  id="fragment43" fragmentid="ocom-commonassets" library="server:OCOM-FRAGMENT-LIBRARAY">
        
      </fragmentinstance>
  </ssinfo>
  </script>

  
  

<script language="JavaScript" src="https://www.oracle.com/asset/web/js/oraclelib.js" type="text/javascript"></script>
  <style type="text/css">
    HTML,BODY,TD,H1,H2,H3,H4,OL,UL,DL,LI,DT,DD {font-family:arial,helvetica,sans-serif;}
    HTML,BODY,TD,CODE,KBD,TT,OL,UL,DL,LI,DT,DD {font-size:12px;}
    a:link {color:#000;text-decoration:none;}
    a:visited {color:#000;text-decoration:none;}
    a:hover {color:#FF0000;text-decoration:underline;}

    #Wrapper_FixedWidth {text-align: left; margin: 0px auto; padding: 0px; border:0; width: 1000px;}
    #Wrapper_FixedWidth_Header {margin: 0 0 15px 0; width:100%; display:block; }
    #Wrapper_FixedWidth_Leftnav {float: left; width: 181px;}
    #Wrapper_FixedWidth_Rightnav {float: right;  width: 185px; }
    #Wrapper_FixedWidth_Centercontent {float: left; width: 810px;}
    #Wrapper_FixedWidth_Maincontent {float: left; width: 595px;}
    #Wrapper_FixedWidth_Footer{ clear: both; }
    .header{display:block; width:100%; padding:2px 0px 5px 0px; margin:0px 0px 10px 0px;}
    .logo{width:140px; float:left; padding:12px 0px 0px 12px;}
    .welcomeMsg{text-align:right; font-size:10px; padding:5px 12px 0px 0px; float:right;}
    .secureSearch{text-align:right; padding:10px 0px 0px 0px; margin-top:20px;}
    .greybarhomebot{background: #DCDCDC;height: 7px; margin-top: 7px; float:left; width:100%; margin-top:20px;}
    .footerLinks {font-size:10px;}
    .sngPsta {font-size:11px;line-height:13px;color:#000;text-align:left;}
    a.sngPsta:link {color:#000;text-decoration:none;display:block;padding:3px 10px;}
    a.sngPsta:visited {color:#000;text-decoration:none;display:block;padding:3px 10px;}
    a.sngPsta:hover {color:#fff;text-decoration:none;display:block;background-color:#9a9a9a;padding:3px 10px;}
    /* For Mosaic */
    ul#navigation li.top-level p a.noimg {background:none;}
    /* For Mosaic */
    #centerSectBlankPS {display: block;min-width: 570px;}
    .lock {position:absolute; top:1px;*top:1px; left:152px; margin:0px; padding:0px;}
	.menu-ocom {display:none}
  </style>
  <link media="screen" href="/us/assets/otn-otn.css" type="text/css" rel="stylesheet" />
  <link media="screen" href="/us/assets/ocom-decouple-ocom-decouple.css" type="text/css" rel="stylesheet" />
<!-- SS_BEGIN_SNIPPET(fragment43,ocom-commonassets-droppoint)-->
				
				
			<!-- SS_END_SNIPPET(fragment43,ocom-commonassets-droppoint)-->
  <!--<link media="screen" href="/ocom/groups/systemobject/@mktg_admin/documents/systemobject/sdn.css" type="text/css" rel="stylesheet" /> -->

<!--SS_BEGIN_SNIPPET(fragment32,code)-->			<!--SS_END_SNIPPET(fragment32,code)-->

  <style type="text/css">
    <!-- Add logo class to styles.css file -->
    .logo{FLOAT: left; WIDTH: 151px;  PADDING-TOP: 4px}
    #centerSectBlankPS {display: block;min-width: 570px;}
    .sunquicklinks_wrapper{DISPLAY: block; FLOAT: right; WIDTH: 200px; TEXT-ALIGN: right;}
    .welcomesignin_wrapper{FLOAT: left; WIDTH: 634px; *width:621px; TEXT-ALIGN: right;VERTICAL-ALIGN: bottom; PADDING-TOP: 12px}
    .logo_wrapper{DISPLAY: block; MARGIN-BOTTOM: 6px; float:left; WIDTH: 974px; HEIGHT: 40px;}
  </style><!--Mosaic Header --><!--[if IE]>
  <STYLE>
    .logo_align{margin-bottom: 4px; margin-left:0px;}
    .search_position{margin:7px 3px 14px 16px;}
    #panelDiv_search .contentBg{padding:15px 5px 5px 5px; } 
    ul#navigation div.submenu {border-bottom:1px solid #b7b7b7;}
    ul#navigation div.submenu .bottomleft{background:none; width:15px; height:30px; float:left;  margin-left:-16px; margin-bottom:-42px; }
    ul#navigation div.submenu .bottomcenter{background:none; height:30px;  margin-left:15px; margin-right:15px; float:left; width:360px;} 
    ul#navigation div.submenu .bottomright{background:none; width:15px; height:30px; float:left; margin-left:360px; }
    ul#navigation div.submenu .partner_bottomleft{ background:none; width:15px; height:30px;  float:left; margin-left:-16px; margin-bottom:-42px; clear:left; margin-top:15px;}
    ul#navigation div.submenu .partner_bottomcenter{  background:none; width:362px; height:30px; margin-left:15px;  float:center;}
    ul#navigation div.submenu .partner_bottomright{  background:none; width:15px; height:30px; float:right; margin-right:-15px;}
    </STYLE>
  <![endif]-->
<!--SS_BEGIN_SNIPPET(fragment29,1)--><!--SS_END_SNIPPET(fragment29,1)-->

<!--SS_BEGIN_SNIPPET(fragment32,head_tags)-->


												     
     	




	
<title>The JVMPI Transition to JVMTI</title>
<meta name="Title" content="The JVMPI Transition to JVMTI">
<meta name="Description" content="Have you ever heard about or used JVMPI? Are you aware that the JVMPI interface has always been experimental and is being replaced with JVMTI? This article describes the basics of converting JVMPI agents into JVMTI agents, and provides some good tips on problems to avoid and techniques to use with JVMTI.">
<meta name="Keywords" content="JVM, JVMTI, tool interface, VM profiling, debugging, JVMDI, JVMPI, jsr163, BCI">
<meta name="robots" content="INDEX, FOLLOW">
<meta name="country" content="USA">
<meta name="Language" content="en">
<meta name="Updated Date" content="3/28/13 6:57 PM">

			<!--SS_END_SNIPPET(fragment32,head_tags)-->

<!--SS_BEGIN_SNIPPET(fragment33,1)-->
				<link rel="stylesheet" type="text/css" href="/us/assets/receiver-style-css.css" type="text/css" media="screen" />
<link rel="stylesheet" type="text/css" href="/us/assets/subtabs-css.css" type="text/css" media="screen" />
<script language="JavaScript" type="text/javascript" src="/us/assets/prototype-1.7.2.0.js"></script>
			<!--SS_END_SNIPPET(fragment33,1)-->

<!--SS_BEGIN_SNIPPET(fragment35,code)-->
			<!--SS_END_SNIPPET(fragment35,code)-->

<!-- SS_BEGIN_SNIPPET(fragment43,ocom-commonassets)--><link rel="stylesheet" type="text/css" href="https://www.oracle.com/asset/web/css/ocom-mosaic.css" />
<link rel="stylesheet" type="text/css" href="https://www.oracle.com/asset/web/css/master-mosaic.css" />
<script language="JavaScript" type="text/javascript" src="https://www.oracle.com/asset/web/js/jquery.js"></script>
<script language="JavaScript" type="text/javascript" src="https://www.oracle.com/asset/web/js/oraclelib-mosaic.js"></script>

    <script async="async" type="text/javascript" src='//consent.truste.com/notice?domain=oracle.com&c=teconsent&js=bb&noticeType=bb&text=true' crossorigin></script>
<!--[if IE]>
  <STYLE>
    .logo_align{margin-bottom: 4px; margin-left:0px;}
    .search_position{margin:7px 3px 14px 16px;}
    #panelDiv_search .contentBg{padding:30px 5px 5px 5px; } 
    ul#navigation div.submenu {border-bottom:1px solid #b7b7b7;}
    ul#navigation div.submenu .bottomleft{background:none; width:15px; height:30px; float:left;  margin-left:-16px; margin-bottom:-42px; }
    ul#navigation div.submenu .bottomcenter{background:none; height:30px;  margin-left:15px; margin-right:15px; float:left; width:380px;} 
    ul#navigation div.submenu .bottomright{background:none; width:15px; height:30px; float:left; }
    ul#navigation div.submenu .partner_bottomleft{ background:none; width:15px; height:30px;  float:left; margin-left:-16px; margin-bottom:-42px; clear:left; margin-top:15px;}
	ul#navigation div.submenu .partner_bottomcenter{  background:none; width:382px; height:30px; margin-left:15px;  float:center;}
	ul#navigation div.submenu .partner_bottomright{  background:none; width:15px; height:30px; float:right; margin-right:-15px;}
  </STYLE>
<![endif]-->
<!--[if IE 6]>
  <style>
  #panelDiv_search .BottomleftCurv{background:none; width:15px; height:30px; float:left;}
  #panelDiv_search .centerBottom{background:none;width:153px;height:30px;float:left;}
  #panelDiv_search .BottomrightCurv{background:none;width:15px;height:30px;float:right;}
  #panelDiv_search .contentBg{border-bottom:1px solid #ababab;}
  #navigation{width:971px;}
  </style>
<![endif]-->
 <!--Brightcove script line and lightbox code--> 
<div id="bcVideoPlayer" style="display: none;">&nbsp;</div>
<div class="lightbox_overlay" id="lightbox_brightcove" onClick="showclose();" style="display: none; z-index: 30000;"><!--spacer-->&nbsp;</div>
			<!-- SS_END_SNIPPET(fragment43,ocom-commonassets)-->
<!--DTM embed code - Header -->
<script src="//assets.adobedtm.com/6f37a0dc9cdbe818dc4979828b58b88e3f060ea4/satelliteLib-e598c5b61e39a10b402e048e87dd27b0f1cd2d4c.js"></script>
<!--End-->
</head>
<body class="f01 f01v0 f01bg">
<a name="top"></a>
	<div class="f01bg"></div>
	<div class="f01v0w1">
 	
   <!-- SS_BEGIN_SNIPPET(fragment41,ocomheader)-->				
		<!-- U02v0 -->

<nav class="u02nav">
  <div id="u02" class="u02">
    <div data-skiptxtappend="" data-skiptxtprepend="Skip" tabindex="-1" id="u02skip2content">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a id="u02skip2c" href="#maincontent">Skip to Content</a></li>
        <li><a id="u02skip2s" href="#skip_to_search_form">Skip to Search</a></li>
      </ul>
    </div>
    <div class="u02w1"><!-- logo -->
      <div data-trackas="header" class="u02logo">
        <div class="u02logow1"><a class="o_icon" data-lbl="logo" data-trackas="header" href="https://www.oracle.com/index.html"><span>Oracle</span></a></div>
      </div>
      <!-- menu -->
      <div data-trackas="menu" class="u02menu">
        <div class="u02mlink" id="u02main">
          <div class="u02mlinkw1"><a data-lbl="menu" id="u02menulink" href="/us/assets/MENUCONTENT-EN">
            <div class="u02mlinkw2">Menu</div>
            </a></div>
        </div>
      </div>
      
 <!-- search -->
<div data-trackas="header" class="u02search" id="u02search">
  <form class="u02searchform" name="searchForm" method="get" action="https://www.oracle.com/search/results?cat=otn">
    <input type="hidden" value="otn" name="cat" />
    <input type="hidden" value="S3" name="Ntk" />
    <input id="txtSearch" class="textcnt autoclear" name="Ntt" value="" />
    <input type="submit" class="u02searchbttn" value="Submit Search" />
  </form>
</div>
  
      
      
      <div data-trackas="header" class="u02tools">
        <ul>
          <!-- user tools -->
          <li class="u02mtool u02toolsloggedout"><a data-lbl="profile:sign-in-account" class="u02ticon u02user" href="#usermenu"> <span class="u02signin">Sign In</span> <span class="u02signout">Account</span> </a>
            <div data-lbl="profile" class="u02user u02toolpop">
              <div class="u02userin">
                <div data-lbl="oracle-account" class="u02userinw1 u02userloggedin">
                  <h5>Oracle Account</h5>
                  <p id="u02userinfo">&nbsp;</p>
                  <a class="u02bttn" id="u02pfile-sout" data-lbl="sign-out" href="javascript:sso_sign_out();">Sign Out</a>
                  <ul id="u02usertools">
                    <li><a id="u02pfile-acct" data-lbl="account" href="https://profile.oracle.com/myprofile/account/secure/update-account.jspx?nexturl=">Account</a></li>
                    <li><a data-lbl="help" href="/us/corporate/contact/about-your-account-070507.html">Help</a></li>
                  </ul>
                </div>
                <div data-lbl="oracle-account" class="u02userinw1 u02userloggedout">
                  <h5>Oracle Account</h5>
                  <p>Manage your account and access personalized content.</p>
                  <a class="u02bttn" data-lbl="signin" id="u02pfile-regs" href="http://www.oracle.com/webapps/redirect/signon?nexturl=">Sign in</a>
                  <ul id="u02usertools">
                    <li><a data-lbl="createaccount" href="https://profile.oracle.com/myprofile/account/create-account.jspx">Create an account</a></li>
                    <li><a data-lbl="help" href="http://www.oracle.com/us/corporate/contact/about-your-account-070507.html">Help</a></li>
                  </ul>
                </div>
                <div data-lbl="cloud-account" class="u02userinw2">
                  <h5>Cloud Account</h5>
                  <p>Access your cloud dashboard, manage orders, and more.</p>
                  <a class="u02bttn" data-lbl="signin" href="https://cloud.oracle.com/sign-in">Sign in</a></div>
              </div>
            </div>
          </li>
          <!-- country select -->
          <li id="u02cmenu" class="u02mtool"><a class="u02ticon u02regn" href="/us/mosaicmenu/index.html#u02countrymenu"><span>Country</span></a></li>
          <!-- call -->
          <li id="u02call" class="u02mbttn"><a data-lbl="call" class="u02ticon u02call o-call" href="#callOracle"><span>Call</span></a></li>
          <!-- chat --> <!--<li class="u02mbttn" id="u02chat">
					<a data-lbl="chat" href="#chat" class="u02ticon u02chat"><span>Chat</span></a>
				</li>-->
        </ul>
      </div>
    </div>
    <a id="maincontent">&nbsp;</a></div>
</nav>
<!-- /U02v0 -->
 
			<!-- SS_END_SNIPPET(fragment41,ocomheader)-->
   <!--SS_BEGIN_SNIPPET(fragment29,2)-->
	
	<!--**override root for testing purposes:**-->
	<!--** Header Logo ** -->
	<!--** Header Search ** -->
	<!--** Welcome SignIn ** -->
	 
	
	<!--** Footer ** -->
	
   
    
<!--** Header Logo ** -->
             
    

  <!-- MOSAIC -->
<!-- Communities-->

<!-- User Category -->
 
<!-- User Intrest -->
<!-- Navigation starts here -->
     
          
                    
        
        
          

        
      
      
     
    
     
        
            
            
       
        
      
     
     
        
<!-- User Community SC code -->

<!-- User Category SC code -->

 
<!-- User Interest SC code -->


	
	    <div id="breadCrumb">
	    <div class="breadCrumb_Left"></div>
	    <div class="breadCrumb_Center">
	    <div style="position:relative;">
	    <span class="breadCrumb_Content">
			    <a href="/technetwork/index.html" onclick="navTrack('otn','en','breadcrumb','otnen');"><span class=red>Oracle</span> Technology Network</a>
			    <span class="rightarrow"><img src="/us/assets/rightarrow-066625.gif" /></span>
			    <a href="/technetwork/articles/index.html" onclick="navTrack('otn','en','breadcrumb','otnen_articles');">Articles</a>
			    <span class="rightarrow"><img src="/us/assets/rightarrow-066625.gif" /></span>
			    <span class="active">Java</span>
	    </span>
	    </div>
	    </div>
	    <div class="breadCrumb_Right"></div>
	    </div>

			<!--SS_END_SNIPPET(fragment29,2)-->
        <!-- F02v0 -->
      <div class="f02 f02v0">
      <div class="f02w1">
      <div id="wrapper_lnav_maincont_rcol_foot">
        <div id="Wrapper_FixedWidth_Leftnav">
          
<!--SS_BEGIN_SNIPPET(fragment25,2)-->
	
	<!--**override root for testing purposes:**-->
	<!--** Header Logo ** -->
	<!--** Header Search ** -->
	<!--** Welcome SignIn ** -->
	 
	
	<!--** Footer ** -->
	
   
    
<!--** Header Logo ** -->
             
    

  <!-- MOSAIC -->
<!-- Communities-->

<!-- User Category -->
 
<!-- User Intrest -->
<!-- Navigation starts here -->
     
          
                    
        
        
          

        
      
      
     
    
     
        
            
            
       
        
      
     
     
        
<!-- User Community SC code -->

<!-- User Category SC code -->

 
<!-- User Interest SC code -->


 <!--** retrieve input parameters: **-->
		

			
		
	<!--** retrieve the root node: **-->
	<!--rootId = ssGetFirstNodeId(siteId)-->
	<!--nodeId = rootId-->

	<!--** retrieve the nodeLevel and set it to ssNumVertLevels **-->
	<!--** retrieving the nodeLevel **-->
		        	            
		<!--** setting the nodelevel to ssNumVertLevels **-->
                <!--** Get the section ID in custom section property **-->		
				                             
   
                	
                 
                
                <div class="topLeftNavBorder_li"><!--Spacer--></div> 
                <div class="XMLLeftNav_li" id="XMLLeftNav">

		
 
		<!--** section link: **-->    
		     
		    		   
 
											
               <ul class="level01">
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/adf/index.html" onclick="navTrack('otn','en','lnav','articles_adf');"   target=_top><div>Application Development Framework</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/apex/index.html" onclick="navTrack('otn','en','lnav','articles_apex');"   target=_top><div>Application Express</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/bigdata/index.html" onclick="navTrack('otn','en','lnav','articles_bigdata');"   target=_top><div>Big Data</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/bi/index.html" onclick="navTrack('otn','en','lnav','articles_bi');"   target=_top><div>Business Intelligence</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/cloudcomp/index.html" onclick="navTrack('otn','en','lnav','articles_cloudcomp');"   target=_top><div>Cloud Computing</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/communications/index.html" onclick="navTrack('otn','en','lnav','articles_comm');"   target=_top><div>Communications</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/database-performance/index.html" onclick="navTrack('otn','en','lnav','articles_dbperformance');"   target=_top><div>Database Performance & Availability</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/datawarehouse/index.html" onclick="navTrack('otn','en','lnav','articles_datawarehouse');"   target=_top><div>Data Warehousing</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/database/index.html" onclick="navTrack('otn','en','lnav','articles_db');"   target=_top><div>Database</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/dotnet/index.html" onclick="navTrack('otn','en','lnav','articles_dotnet');"   target=_top><div>.NET</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/dsl/index.html" onclick="navTrack('otn','en','lnav','articles_dynamicscript');"   target=_top><div>Dynamic Scripting Languages</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/embedded/index.html" onclick="navTrack('otn','en','lnav','articles_embedded');"   target=_top><div>Embedded</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/enterprise2/index.html" onclick="navTrack('otn','en','lnav','articles_enterprise2');"   target=_top><div>Digital Experience</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/entarch/index.html" onclick="navTrack('otn','en','lnav','articles_entarch');"   target=_top><div>Enterprise Architecture</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/oem/index.html" onclick="navTrack('otn','en','lnav','articles_oem');"   target=_top><div>Enterprise Management</div></a></li>
                     	 			 							
				

                          
 		          			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/idm/index.html" onclick="navTrack('otn','en','lnav','articles_idm');"   target=_top><div>Identity & Security</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/java/index.html" onclick="navTrack('otn','en','lnav','articles_java');"   target=_top><div>Java</div></a></li>
                     	 			 							
				

                          
 		          			 							
				

                          
 		          			 							
				

                          
 		          			 							
				

                          
 		          			 							
				

                          
 		          			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/linux/index.html" onclick="navTrack('otn','en','lnav','articles_linux');"   target=_top><div>Linux</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/mobile/index.html" onclick="navTrack('otn','en','lnav','articles_mobile');"   target=_top><div>Mobile</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/soa/index.html" onclick="navTrack('otn','en','lnav','articles_soa');"   target=_top><div>Service-Oriented Architecture</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/solaris/index.html" onclick="navTrack('otn','en','lnav','articles_solaris');"   target=_top><div>Solaris</div></a></li>
                     	 			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/sql/index.html" onclick="navTrack('otn','en','lnav','articles_sql');"   target=_top><div>SQL & PL/SQL</div></a></li>
                     	 			 							
				

                          
 		          			 							
				

                          
 		          			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/systems/index.html" onclick="navTrack('otn','en','lnav','articlesSystems');"   target=_top><div>Systems - All Articles</div></a></li>
                     	 			 							
				

                          
 		          			 							
				

                          
 		            	
				  <li><a class="level01_top_link_subnav" href = "/technetwork/articles/virtualization/index.html" onclick="navTrack('otn','en','lnav','articles_virtualization');"   target=_top><div>Virtualization</div></a></li>
                     	 			 							
				
		 </ul>										
 
     	        </div>
		<div class="botLeftNavBorder_li"><!--Spacer--></div>
											
	<!--** end of ExternalNavMultiV **-->


			<!--SS_END_SNIPPET(fragment25,2)-->

        </div>
        <div id="Wrapper_FixedWidth_Centercontent">
          <div class="pg0 pg0v0 pg0x1v1 pg0x1">
            
<!--SS_BEGIN_SNIPPET(fragment33,2)-->
	







			<!--SS_END_SNIPPET(fragment33,2)-->
		<h1>The JVMPI Transition to JVMTI</h1>
<!-- content goes here -->
<table width="100%" cellspacing="0" cellpadding="0" border="0">
    <tbody>
        <tr>
            <td valign="top" class="smaller">&nbsp;</td>
            <td width="10">&nbsp;</td>
            <td valign="bottom" align="right">
            <div style="padding:0px;" class="sitelinks">
            <table cellspacing="0" cellpadding="0" border="0">
                <tbody>
                    <tr>
                        <td valign="bottom" align="right">&nbsp;</td>
                        <td valign="bottom" nowrap="nowrap" class="smaller">&nbsp;</td>
                    </tr>
                </tbody>
            </table>
            </div>
            </td>
        </tr>
    </tbody>
</table>
<table width="100%" cellspacing="0" cellpadding="0" border="0">
    <tbody>
        <tr>
            <td valign="top" class="smaller"><em>By                     <a href="/technetwork/articles/javase/jvmpitransition-138768.html#5">Kelly O'Hair</a>, July 1, 2004                 </em></td>
            <td width="10">&nbsp;</td>
            <td valign="bottom" align="right">
            <div style="padding:0px;" class="sitelinks">
            <table cellspacing="0" cellpadding="0" border="0">
                <tbody>
                    <tr>
                        <!--
<td valign="bottom" align="right"><img src="/im/ic_email.gif" width="14" height="12" border="0" hspace="4" vspace="1" alt=" " /></td>
<td valign="bottom" class="smaller" nowrap="nowrap"><a href="#{link placeholder}">E-mail</a></td>
<td>&nbsp;&nbsp;</td>
<td valign="bottom" align="right">&nbsp;</td>
<td valign="bottom" class="smaller" nowrap="nowrap"><a href="/jsp_utils/PrintPage.jsp" target="printFriendlyView" onclick="openPopup('','printFriendlyView',710,650,'no',1,1,0,0,0,0); return true;"><img src="/im/ic_print.gif" width="14" height="12" alt="Print-friendly Version" border="0" hspace="4" />Print-friendly Version</a></td>
<td>&nbsp;&nbsp;</td>
<td valign="bottom" align="right"><img src="/im/ic_download_thin.gif" width="9" height="14" hspace="4" border="0" alt=" " /></td>
<td valign="bottom" class="smaller" nowrap="nowrap"><a href="#{link placeholder}">Download</a></td>
-->
                    </tr>
                </tbody>
            </table>
            </div>
            </td>
        </tr>
    </tbody>
</table>
<div class="contentdivider">
<table width="100%" cellspacing="0" cellpadding="0" border="0" class="grey4">
    <tbody>
        <tr>
            <td><img width="1" height="4" border="0" src="/ocom/groups/public/@otn/documents/digitalasset/148611.gif" alt=" " /></td>
        </tr>
    </tbody>
</table>
</div>
<p><a href="/technetwork/java/features-141912.html">Articles Index</a></p>
<div class="padbottom10">The Java Virtual Machine Tool Interface (             <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jvmti/jvmti.html">JVMTI</a>) is a new native interface available in the               <a href="http://docs.oracle.com/javase/1.5.0/docs/">Java 2 Software Development Kit (SDK), version 1.5.0</a>. The Java Virtual Machine Profiling Interface (             <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jvmpi/jvmpi.html">JVMPI</a>) is also available in the Java 2 Platform, Standard Edition (J2SE) SDK version 1.5.0, but has been deprecated in version 1.5.0. Transitioning from JVMPI to JVMTI may or may not be an easy task, depending on how JVMPI was used in the agent library. The intent of this article is to provide help in this transition and perhaps provide some general guidance in writing JVMTI agents. Make sure you have an installation of Java 2 SDK version 1.5.0 available to browse the JVMTI demos as you read this document, downloads are available on the               <a href="/technetwork/java/javase/downloads/index-jdk5-jsp-142662.html">J2SE 1.5.0 Beta 2</a> page.</div>
<div><strong>Contents</strong></div>
<span class="sp2">&nbsp;</span><br />
<table cellspacing="0" cellpadding="0" border="0" class="vatop">
    <tbody>
        <tr>
            <td class="hyphen">-&nbsp;</td>
            <td><a href="/technetwork/articles/javase/jvmpitransition-138768.html#0" class="named">Some History and Background</a></td>
        </tr>
        <tr>
            <td class="hyphen">-&nbsp;</td>
            <td><a href="/technetwork/articles/javase/jvmpitransition-138768.html#1" class="named">Transition Issues for JVMPI Agents</a></td>
        </tr>
        <tr>
            <td class="hyphen">-&nbsp;</td>
            <td><a href="/technetwork/articles/javase/jvmpitransition-138768.html#2" class="named">Some Basics on JVMTI Usage</a></td>
        </tr>
        <tr>
            <td class="hyphen">-&nbsp;</td>
            <td><a href="/technetwork/articles/javase/jvmpitransition-138768.html#3" class="named">Object Tagging and Heap Iteration</a></td>
        </tr>
        <tr>
            <td class="hyphen">-&nbsp;</td>
            <td><a href="/technetwork/articles/javase/jvmpitransition-138768.html#4" class="named">Summary</a></td>
        </tr>
        <tr>
            <td class="hyphen">-&nbsp;</td>
            <td><a href="/technetwork/articles/javase/jvmpitransition-138768.html#5" class="named">About the Author</a></td>
        </tr>
    </tbody>
</table>
<span class="sp20">&nbsp;</span><br />
<a name="0" id="0"></a>
<div><strong>Some History and Background</strong></div>
<div class="contentdivider">
<table width="100%" cellspacing="0" cellpadding="0" border="0" class="grey4">
    <tbody>
        <tr>
            <td><img width="1" height="4" border="0" src="/ocom/groups/public/@otn/documents/digitalasset/148611.gif" alt=" " /></td>
        </tr>
    </tbody>
</table>
</div>
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong>              <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jvmti/">Java Virtual Machine Tool Interface (JVMTI)</a>             </strong>             </div>
<div>JVMTI provides for all the functional capabilities of the previous native interfaces JVMDI and JVMPI. However, it does not have many of the limitations of those older interfaces. Some of the JVMPI capabilities require the use of JVMTI and the technique called Byte Code Insertion (             <a href="/technetwork/articles/javase/jvmpitransition-138768.html#BCI">BCI</a>), sometimes referred to as Byte Code Injection or Byte Code Instrumentation. JVMTI allows for all JVM functionality to continue to operate, like JIT or JVM compilation and different GC implementations. Certain JVMTI features are controlled by asking for JVMTI Capabilities, and some of these can cause changes in JVM performance, but most features are available while the JVM is running &quot;full speed&quot;. All JVMTI object handles are               <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jni/">JNI</a> handles, and JVMTI Event callbacks always include a               <code>JNIEnv*</code> argument to facilitate JNI usage. Multiple JVMTI agents can operate in a single JVM and all interfaces return an error code to determine success or failure of the request. It is the intention of JVMTI to displace both JVMPI and JVMDI, and to ultimately be the single native tool interface into the JVM.</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong>              <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jni/">Java Virtual Machine Profiling Interface (JVMPI)</a>             </strong>             </div>
<div>JVMPI was introduced in Java 2 SDK version 1.1, but was always labeled as a native &quot;experimental&quot; profiling interface. It was ported to the HotSpot Virtual Machine in Java 2 SDK version 1.3.0 but was never as stable as in the original Classic Java virtual machine             <a href="/technetwork/articles/javase/jvmpitransition-138768.html#TJVM">               <sup>1</sup>             </a>. JVMPI uses object IDs, not JNI object types, requiring agent libraries to manage them and convert them when using JNI. It also included some binary dump formats that you won't see in JVMTI. Certain Garbage Collectors would not work with JVMPI, and use of JVMPI did have a performance impact on the JVM. It has been deprecated in Java 2 SDK version 1.5.0, and the current plan of record is to remove it from Java 2 SDK version 1.6.0.</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong>              <a href="/technetwork/java/javase/jvmdi-spec-135507.html">Java Virtual Machine Debug Interface (JVMDI)</a>             </strong>             </div>
<div>The JVMDI was also a native interface that was introduced in Java 2 SDK version 1.1. It is mentioned here because along with JVMPI, JVMDI will also be targeted for removal in Java 2 SDK version 1.6.0. The transition from JVMDI to JVMTI is considerably easier than from JVMPI, and we will not be covering the JVMDI transition in this document. The use of JVMDI in the Java Debug Wire Protocol (             <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp-spec.html">JDWP</a>) in the Java Platform Debugging Architecture (             <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/">JPDA</a>) has been replaced with JVMTI in the Java 2 SDK version 1.5.0.</div>
<span class="sp10">&nbsp;</span><br />
<a name="1" id="1"></a>
<div><strong>Transition Issues for JVMPI Agents</strong></div>
<div class="contentdivider">
<table width="100%" cellspacing="0" cellpadding="0" border="0" class="grey4">
    <tbody>
        <tr>
            <td><img width="1" height="4" border="0" src="/ocom/groups/public/@otn/documents/digitalasset/148611.gif" alt=" " /></td>
        </tr>
    </tbody>
</table>
</div>
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">Interfaces</strong>             </div>
<div>
<p>In general, you will find that JVMTI has many more interfaces than JVMPI. Here is a map from JVMPI to JVMTI, or some notes on why there is no mapping.</p>
<span class="sp10">&nbsp;</span>             <br />
<table width="100%" cellspacing="0" cellpadding="2" border="0" class="vatop">
    <tbody>
        <tr>
            <th align="left" scope="col" class="headerbar6">
            <div class="headerpadding2"><strong>JVMPI</strong></div>
            </th>
            <th align="left" scope="col" class="headerbar6">
            <div class="headerpadding2"><strong>JVMTI</strong></div>
            </th>
            <th align="left" scope="col" class="headerbar6">
            <div class="headerpadding2"><strong>Notes</strong></div>
            </th>
        </tr>
        <tr valign="top" align="left">
            <td><code>EnableEvent</code></td>
            <td><code>SetEventNotificationMode</code></td>
            <td>Use                     <code>jvmtiEventMode == JVMTI_ENABLE</code></td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>DisableEvent</code></td>
            <td><code>SetEventNotificationMode</code></td>
            <td>Use                     <code>jvmtiEventMode == JVMTI_DISABLE</code></td>
        </tr>
        <tr valign="top" align="left">
            <td><code>RequestEvent</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent. This was used for creation of JVMPI Heap, Monitor, or Object event dumps, which are not created by JVMTI. JVMTI instead uses function calls to extract this information. JVMTI                     <code>GenerateEvents</code> is not the same thing, be careful.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>GetCallTrace</code></td>
            <td><code>GetStackTrace</code></td>
            <td>JVMTI provides bytecode offsets, not line numbers.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>ProfilerExit</code>                   </td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. It wasn't clear that a special JVMTI Exit function was necessary. Use of the standard                     <code>exit()</code> function or JNI                     <code>FatalError</code> seemed to cover this.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>RawMonitorCreate</code></td>
            <td><code>CreateRawMonitor</code></td>
            <td>Basic raw monitor usage is the same, just a                     <code>typedef</code> name change:                     <code>JVMPI_RawMonitor</code> -&gt;                     <code>jrawMonitorID</code></td>
        </tr>
        <tr valign="top" align="left">
            <td><code>RawMonitorEnter</code></td>
            <td><code>RawMonitorEnter</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>RawMonitorExit</code></td>
            <td><code>RawMonitorExit</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>RawMonitorWait</code></td>
            <td><code>RawMonitorWait</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>RawMonitorNotifyAll</code></td>
            <td><code>RawMonitorNotifyAll</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>RawMonitorDestroy</code></td>
            <td><code>DestroyRawMonitor</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>GetCurrentThreadCpuTime</code></td>
            <td><code>GetCurrentThreadCpuTime</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>SuspendThread</code></td>
            <td><code>SuspendThread</code></td>
            <td>For all thread interfaces, JVMTI accepts a                     <code>jthread,</code> not a                     <code>JNIEnv*</code>, and                     <code>NULL</code> can be used as the current thread.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>SuspendThreadList</code></td>
            <td><code>SuspendThreadList</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>ResumeThread</code></td>
            <td><code>ResumeThread</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>ResumeThreadList</code></td>
            <td><code>ResumeThreadList</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>GetThreadStatus</code></td>
            <td><code>GetThreadState</code></td>
            <td>The JVMTI thread state contains more detail on the thread state.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>ThreadHasRun</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. Sampling the current frame location and the                     <code>GetCurrentThreadCpuTime</code> may provide a replacement for this feature.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>CreateSystemThread</code></td>
            <td><code>RunAgentThread</code></td>
            <td>JVMTI requires the caller to provide a freshly created                     <code>java.lang.Thread</code> object.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>SetThreadLocalStorage</code></td>
            <td><code>SetThreadLocalStorage</code></td>
            <td>&nbsp;                   </td>
        </tr>
        <tr valign="top" align="left">
            <td><code>GetThreadLocalStorage</code></td>
            <td><code>GetThreadLocalStorage</code></td>
            <td>&nbsp;                   </td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>DisableGC</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent. JVMPI required GC to be disabled for some operations, JVMTI does not.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>EnableGC</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent. JVMPI required GC to be disabled for some operations, JVMTI does not.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>RunGC</code></td>
            <td><code>ForceGarbageCollection</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>GetThreadObject</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent, not needed. JVMTI uses jobject not object IDs.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>GetMethodClass</code></td>
            <td><code>GetMethodDeclaringClass</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>jobjectID2jobject</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent, not needed. JVMTI uses jobject not object IDs.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>jobject2jobjectI</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent, not needed. JVMTI uses jobject not object IDs.</td>
        </tr>
        <!--  FINAL LINE IS OF A DIFFERENT COLOR  -->
        <tr>
            <td colspan="4" class="headerbar6"><img width="1" height="1" border="0" src="/ocom/groups/public/@otn/documents/digitalasset/148611.gif" alt=" " /></td>
        </tr>
    </tbody>
</table>
<br />
<span class="sp10">&nbsp;</span>             </div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">Events</strong>             </div>
<div>
<p>The JVMPI event callback mechanism consisted of one callback function that was passed a large C                 <code>struct/union</code> of information. In JVMTI, each event has its own callback function with a unique function prototype for that event.</p>
<span class="sp10">&nbsp;</span>             <br />
<table width="100%" cellspacing="0" cellpadding="2" border="0" class="vatop">
    <tbody>
        <tr>
            <th align="left" scope="col" class="headerbar6">
            <div class="headerpadding2"><strong>JVMPI Event</strong></div>
            </th>
            <th align="left" scope="col" class="headerbar6">
            <div class="headerpadding2"><strong>JVMTI Event</strong></div>
            </th>
            <th align="left" scope="col" class="headerbar6">
            <div class="headerpadding2"><strong>Notes</strong></div>
            </th>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_ARENA_DELETE</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent. Never implemented in the Reference Implementation of JVMPI. Depends too much on the specific Garbage Collection being used.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_ARENA_NEW</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent. Never implemented in the Reference Implementation of JVMPI. Depends too much on the specific Garbage Collection being used.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_CLASS_LOAD</code></td>
            <td><code>JVMTI_EVENT_CLASS_LOAD</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_CLASS_LOAD_HOOK</code></td>
            <td><code>JVMTI_EVENT_CLASS_FILE_LOAD_HOOK</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_CLASS_UNLOAD</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. Class unloads can be detected by a query of all classes loaded, and comparing it to a previously saved list. Or can be detected by using SetTag and ObjectFree events.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_COMPILED_METHOD_LOAD</code></td>
            <td><code>JVMTI_EVENT_COMPILED_METHOD_LOAD</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_COMPILED_METHOD_UNLOAD</code></td>
            <td><code>JVMTI_EVENT_COMPILED_METHOD_UNLOAD</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_DATA_DUMP_REQUEST</code></td>
            <td><code>JVMTI_EVENT_DATA_DUMP_REQUEST</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_DATA_RESET_REQUEST</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent. In all known JVMPI implementations it was redundant with                     <code>JVMPI_EVENT_DATA_DUMP_REQUEST</code>. It was determined that this event was not necessary in JVMTI.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_GC_FINISH</code></td>
            <td><code>JVMTI_EVENT_GARBAGE_COLLECTION_FINISH</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_GC_START</code></td>
            <td><code>JVMTI_EVENT_GARBAGE_COLLECTION_START</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_HEAP_DUMP</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. See JVMTI Heap Iterate.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_JNI_GLOBALREF_ALLOC</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. See JVMTI                     <code>SetJNIFunctionTable</code>.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_JNI_GLOBALREF_FREE</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. See JVMTI                     <code>SetJNIFunctionTable</code>.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_JNI_WEAK_GLOBALREF_ALLOC</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. See JVMTI                     <code>SetJNIFunctionTable</code>.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_JNI_WEAK_GLOBALREF_FREE</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. See JVMTI                     <code>SetJNIFunctionTable</code>.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_JVM_INIT_DONE</code></td>
            <td><code>JVMTI_EVENT_VM_INIT</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_JVM_SHUT_DOWN</code></td>
            <td><code>JVMTI_EVENT_VM_DEATH</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_METHOD_ENTRY</code></td>
            <td><code>JVMTI_EVENT_METHOD_ENTRY</code></td>
            <td>JVMTI version not equivalent to JVMPI version and should not be used where performance is an issue. See                     <a href="/technetwork/articles/javase/jvmpitransition-138768.html#BCI">BCI</a>.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_METHOD_ENTRY2</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. With JVMTI, you would need to use                     <code>GetLocalVariable</code> on &quot;this&quot;.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_METHOD_EXIT</code></td>
            <td><code>JVMTI_EVENT_METHOD_EXIT</code></td>
            <td>JVMTI version not equivalent to JVMPI version and should not be used where performance is an issue. See                     <a href="/technetwork/articles/javase/jvmpitransition-138768.html#BCI">BCI</a>.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_MONITOR_CONTENDED_ENTER</code></td>
            <td><code>JVMTI_EVENT_MONITOR_CONTENDED_ENTER</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_MONITOR_CONTENDED_ENTERED</code></td>
            <td><code>JVMTI_EVENT_MONITOR_CONTENDED_ENTERED</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_MONITOR_CONTENDED_EXIT</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_MONITOR_DUMP</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. See JVMTI Thread and Monitor.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_MONITOR_WAIT</code></td>
            <td><code>JVMTI_EVENT_MONITOR_WAIT</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_MONITOR_WAITED</code></td>
            <td><code>JVMTI_EVENT_MONITOR_WAITED</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_OBJECT_ALLOC</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. See                     <a href="/technetwork/articles/javase/jvmpitransition-138768.html#BCI">BCI</a>.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_OBJECT_DUMP</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. See                     <a href="/technetwork/articles/javase/jvmpitransition-138768.html#BCI">BCI</a>.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_OBJECT_FREE</code></td>
            <td><code>JVMTI_EVENT_OBJECT_FREE</code></td>
            <td>Requires that the object be tagged (see JVMTI                     <code>SetTag</code>) which likely requires                     <a href="/technetwork/articles/javase/jvmpitransition-138768.html#BCI">BCI</a>.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_OBJECT_MOVE</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent, not needed. The object type                     <code>jobject</code> does not move.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_RAW_MONITOR_CONTENDED_ENTER</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_RAW_MONITOR_CONTENDED_ENTERED</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent.</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_RAW_MONITOR_CONTENDED_EXIT</code></td>
            <td>&nbsp;</td>
            <td>No JVMTI equivalent.</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_THREAD_END</code></td>
            <td><code>JVMTI_EVENT_THREAD_END</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left" class="grey5">
            <td><code>JVMPI_EVENT_THREAD_START</code></td>
            <td><code>JVMTI_EVENT_THREAD_START</code></td>
            <td>&nbsp;</td>
        </tr>
        <tr valign="top" align="left">
            <td><code>JVMPI_EVENT_INSTRUCTION_START</code></td>
            <td>&nbsp;</td>
            <td>No direct JVMTI equivalent. See                     <code>JVMTI_EVENT_SINGLE_STEP</code> for a possible replacement. Also see                     <a href="/technetwork/articles/javase/jvmpitransition-138768.html#BCI">BCI</a>.                   </td>
        </tr>
        <!--  FINAL LINE IS OF A DIFFERENT COLOR  -->
        <tr>
            <td colspan="4" class="headerbar6"><img width="1" height="1" border="0" src="/ocom/groups/public/@otn/documents/digitalasset/148611.gif" alt=" " /></td>
        </tr>
    </tbody>
</table>
<br />
<span class="sp10">&nbsp;</span>             </div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">JNI and Local/Global References</strong>             </div>
<div>The JNI references returned by JVMTI are all JNI Local References. That means you may need to call JNI functions to create Global or Weak Global references to objects if you need to save or preserve these objects between JVMTI event callbacks. In general, it is best to avoid creating JNI Global references unless absolutely necessary, since they basically prevent the object from being garbage collected, along with all objects that this object refers to. The JNI documents cover this topic fairly well and I won't go into further detail here. This is probably the only major porting issue for JVMDI to JVMTI conversion. But for JVMPI, just converting to JNI reference types from JVMPI object ID form can be significant.</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">Heap Dumps, Heap Iteration Functions, Tagging Objects and Byte Code Insertion (               <a href="/technetwork/articles/javase/jvmpitransition-138768.html#BCI">BCI</a>)             </strong>             </div>
<div>
<p>Probably the most significant difference between JVMPI and JVMTI is the handling of the Java Heap. With JVMPI, a request would be made for a Heap Dump, and the resulting JVMPI event would contain a single large block of data in a specific format that would need to be parsed by the agent library. With JVMTI, there are some basic Heap Iteration functions to traverse the Heap in various general ways, but to track all object allocations in detail, the objects need to be captured at the allocation site and tagged. The tags are carried with the object and can be used in various ways. In some situations like the                 <code>JVMTI_EVENT_OBJECT_FREE</code> event, the object must be tagged to get the event. Tagging objects usually requires some degree of BCI, which JVMTI supports in various ways. BCI involves inserting additional bytecodes into methods to instrument the method. BCI can be accomplished by displacing the original classes through the                 <a href="http://docs.oracle.com/javase/1.5.0/docs/tooldocs/solaris/classpath.html">                 <code>CLASSPATH</code>               </a> with the instrumented classes, changing the class image at class load time with the                 <code>JVMTI_EVENT_CLASS_FILE_LOAD_HOOK</code> event, or calling JVMTI                 <code>RedefineClasses</code> to displace a class image that was previously loaded. Note that JVMTI just provides the ability to do BCI, it does not provide BCI support code for you. See the                 <code>demo/jvmti</code> library                 <code>java_crw_demo</code>.</p>
The JVMPI event               <code>JVMPI_EVENT_OBJECT_ALLOC</code> is not available in JVMTI. Use of BCI,               <code>SetTag,</code> and the event               <code>JVMTI_EVENT_OBJECT_FREE</code> can be used to obtain the same functionality.</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">Expected JVM Performance Differences</strong>             </div>
<div>Just using JVMPI triggers a different JVM bytecode interpretation loop, changing the overall application performance. With JVMTI, adding certain capabilities can cause a change in the JVM and the application performance. However, most JVMTI usage incurs little or no performance penalty. Doing BCI has the potential to drastically change overall application performance, depending on the injected bytecodes and what they cause to happen in the application.</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">Differences in Agent and VM Initialization</strong>             </div>
<div>
<p>With JVMPI, the first agent library code to be executed was the                 <code>JVM_OnLoad</code> extern, with JVMTI it is the                 <code>Agent_OnLoad</code> extern. The initial JVMPI event is                 <code>JVMPI_EVENT_JVM_INIT_DONE</code>, for JVMTI the equivalent event is                 <code>JVMTI_EVENT_VM_INIT</code>. However, JVMTI also provides an earlier event,                 <code>JVMTI_EVENT_VM_START</code>, that represents the earliest possible time where a JNI call can be made. JVMTI has distinct phases (see                 <code>jvmtiPhase</code>) and all interfaces have specifications as to which phases they can be called in. With JVMTI, it is important that the needed JVMTI capabilities be added to the JVMTI environment (               <code>jvmtiEnv*</code>) during the on load phase (inside                 <code>Agent_OnLoad</code>). JVMTI also provides an equivalent                 <code>Agent_OnUnload</code> for when the agent library is actually unloaded from the VM process.</p>
<p>A special note here for people attempting to create a single shared library that is composed of both JVMPI or JVMDI usage along with JVMTI. A JVMTI agent library can be loaded into the JVM with the                 <strong>                 <code>-agentlib</code>               </strong> or                 <strong>                 <code>-agentpath</code>               </strong> options, but can also be loaded in with the older                 <strong>                 <code>-Xrun</code>               </strong> option. The version 1.5.0 JVM, when given the                 <strong>                 <code>-Xrun</code>               </strong> option, first looks for the                 <code>Agent_OnLoad</code> extern in the library, and if seen, gives JVMTI priority, only calling                 <code>Agent_OnLoad</code> and ignoring any                 <code>JVM_OnLoad</code> extern, effectively treating this                 <strong>                 <code>-Xrun</code>               </strong> option usage as if it was an                 <strong>                 <code>-agentlib</code>               </strong> option. Since the older JVM implementations only accept the                 <strong>                 <code>-Xrun</code>               </strong> option, and will only be looking for the                 <code>JVM_OnLoad</code> extern, a single shared library containing both the                 <code>Agent_OnLoad</code> and the                 <code>JVM_OnLoad</code> externs could serve as double agents when using the                 <strong>                 <code>-Xrun</code>               </strong> option, appearing as a JVMPI or JVMDI agent library to the older JVM implementations, and as a JVMTI agent library to the version 1.5.0 JVM implementation. Whether this is a good idea or not is left as an exercise to the reader.</p>
<p>In addition, another difference to note is that                 <code>Agent_OnLoad</code> will be called earlier in the JVM startup than                 <code>JVM_OnLoad</code>. The JVMTI phases protect you from calls happening too early inside                 <code>Agent_OnLoad,</code> but this could be an important difference for some users.</p>
</div>
<span class="sp10">&nbsp;</span><br />
<a name="2" id="2"></a>
<div><strong>Some Basics on JVMTI Usage</strong></div>
<div class="contentdivider">
<table width="100%" cellspacing="0" cellpadding="0" border="0" class="grey4">
    <tbody>
        <tr>
            <td><img width="1" height="4" border="0" src="/ocom/groups/public/@otn/documents/digitalasset/148611.gif" alt=" " /></td>
        </tr>
    </tbody>
</table>
</div>
<div>All code examples in this document have been taken from the available JVMTI demo agents provided in the Java 2 SDK version 1.5.0 (look in the               <code>demo/jvmti</code> directory).</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">Startup</strong>             </div>
<div>
<p>Agents are loaded into a JVM through one of the                 <a href="http://docs.oracle.com/javase/1.5.0/docs/tooldocs/solaris/java.html">                 <strong>                   <code>java</code>                 </strong>               </a> options                 <strong>                 <code>-agentlib:</code>               </strong>               <code>                 <em>agent</em>[=                 <em>options</em>]               </code> or                 <strong>                 <code>&ndash;agentpath:</code>               </strong>               <code>                 <em>path</em>[=                 <em>options</em>]               </code>. In addition, the older                 <strong>                 <code>java</code>               </strong> option                 <strong>                 <code>&ndash;Xrun</code>               </strong> can be used (for example,                 <code>&ndash;Xrun agent [:options]</code>).</p>
<p>The                 <code>Agent_OnLoad</code> extern is the very first agent library code to be executed. Inside                 <code>Agent_OnLoad</code> the JVMTI environment is requested from the JVM, the necessary JVMTI capabilities are added to that environment, and the initial JVMTI event callbacks are setup and enabled. Some of the JVMTI setup can be done here, or in the                 <code>JVMTI_EVENT_VM_INIT</code> event callback, but parts of JVMTI cannot be called until the                 <code>JVMTI_EVENT_VM_INIT</code> event, so JVMTI calls inside                 <code>Agent_OnLoad</code> are limited to the &quot;onload&quot; phase (see the discussion of JVMTI phases below).</p>
<!-- begin VCD7 CODE SAMPLE COMPONENT  -->
<table width="100%" cellspacing="0" cellpadding="10" border="0" class="grey4">
    <tbody>
        <tr>
            <td><code>JNIEXPORT jint JNICALL</code>                   <br />
            <code>Agent_OnLoad(JavaVM *vm, char *options, void *reserved)</code>                   <br />
            <code>{</code>                   <br />
            <div style="margin-left: 40px;"><code>jint rc;</code>                     <br />
            <code>jvmtiCapabilities capabilities;</code>                     <br />
            <code>jvmtiEventCallbacks callbacks;</code>                     <br />
            <code>jvmtiEnv *jvmti;</code>                     <br />
            <br />
            <code>rc = (*vm)-&gt;GetEnv(vm, (void **)&amp;jvmti, JVMTI_VERSION);</code>                     <br />
            <code>if (rc != JNI_OK) {</code>                     </div>
            <div style="margin-left: 80px;"><code>fprintf(stderr, &quot;ERROR: Unable to create jvmtiEnv, GetEnv failed, error=%d\n&quot;, rc);</code>                     <br />
            <code>return -1;</code>                     </div>
            <div style="margin-left: 40px;"><code>}</code>                     <br />
            <code>(*jvmti)-&gt;GetCapabilities(jvmti, &amp;capabilities);</code>                     <br />
            <code>capabilities.can_tag_objects = 1;</code>                     <br />
            <code>capabilities.can_generate_garbage_collection_events = 1;</code>                     <br />
            <code>(*jvmti)-&gt;AddCapabilities(jvmti, &amp;capabilities);</code>                     <br />
            <code>memset(&amp;callbacks, 0, sizeof(callbacks));</code>                     <br />
            <code>callbacks.VMInit = &amp;vmInit;</code>                     <br />
            <code>callbacks.VMDeath = &amp;vmDeath;                       <br />
            callbacks.DataDumpRequest = &amp;dataDumpRequest;                       <br />
            </code>                    <code>(*jvmti)-&gt;SetEventCallbacks(jvmti, &amp;callbacks, sizeof(callbacks));</code>                     <br />
            <code>(*jvmti)-&gt;SetEventNotificationMode(jvmti, JVMTI_ENABLE, JVMTI_EVENT_VM_INIT, NULL);</code>                     <br />
            <code>(*jvmti)-&gt;SetEventNotificationMode(jvmti, JVMTI_ENABLE, JVMTI_EVENT_VM_DEATH, NULL);</code>                     <br />
            <code>return 0;</code>                     </div>
            <code>}</code>                   </td>
        </tr>
    </tbody>
</table>
<!-- end VCD7 CODE SAMPLE COMPONENT  -->              <br />
<p>Note that all of the JVMTI error return handling and checking code has been left out of the above example. Do not do this in real life; those error returns are always worth checking.</p>
<p>The JVMTI capabilities are best added very early, depending on the implementation. The available capabilities and the ability to add capabilities may be restricted to particular JVMTI phases. The phases (               <code>jvmtiPhase</code>) represent periods of time that the JVMTI environment exists. The key boundaries are:                 <code>Agent_OnLoad</code>,                 <code>JVMTI_EVENT_VM_START</code>,                 <code>JVMTI_EVENT_VM_INIT</code>, and                 <code>JVMTI_EVENT_VM_DEATH</code>.</p>
<p>The typical                 <code>vmInit</code> function might look like:               <br />
<br />
<!-- begin VCD7 CODE SAMPLE COMPONENT  --></p>
<table width="100%" cellspacing="0" cellpadding="10" border="0" class="grey4">
    <tbody>
        <tr>
            <td><code>static void JNICALL</code>                   <br />
            <code>vmInit(jvmtiEnv *jvmti, JNIEnv *env, jthread thread)</code>                   <br />
            <code>{</code>                   <br />
            <div style="margin-left: 40px;"><code>(*jvmti)-&gt;SetEventNotificationMode(jvmti, JVMTI_ENABLE, JVMTI_EVENT_DATA_DUMP_REQUEST, NULL);</code>                     </div>
            <div style="margin-left: 80px;">&nbsp;</div>
            <code>}</code>                   </td>
        </tr>
    </tbody>
</table>
<!-- end VCD7 CODE SAMPLE COMPONENT  -->              <br />
<p>Note that in                 <code>Agent_OnLoad</code>, the callback for the                 <code>JVMTI_EVENT_DATA_DUMP_REQUEST</code> (Data Dump Request) was already set, we just enabled this event inside the                 <code>vmInit</code> function.</p>
</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">Interfaces</strong>             </div>
<div>
<p>JVMTI in combination with JNI provides just about everything needed. It is recommended that you browse the JVMTI specification and also look again at all the possible JNI functions that can be used inside a JVMTI agent library. All JVMTI event callbacks get both the                 <code>jvmtiEnv*</code> pointer and also the                 <code>JNIEnv*</code> for the current thread, enabling easy JVMTI and JNI access. The interfaces can easily be called from C or C++, but the calls take on a slightly different appearance in the two languages:</p>
<ul>
    <li>C++                 <br />
    <code>jvmtiError err = jvmti-&gt;SetTag(object, tag);</code></li>
    <li style="list-style: none">&nbsp;</li>
    <li>C                 <br />
    <code>jvmtiError err = (*jvmti)-&gt;SetTag(jvmti, object, tag);</code></li>
</ul>
The               <strong>               <code>#include</code>             </strong> file               <strong>               <code>&quot;jvmti.h&quot;</code>             </strong> works for both languages, and both use full prototypes in all cases, so that as long as you avoid needless casts on the addresses of functions, the compilers should find any missing arguments or incorrect type usage. See the               <code>demo/jvmti/waiters</code> demo for an example C++ agent library. All of JVMTI will return an error code. It is important that you check these error codes, even though the examples in this document don't.</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">Event Callbacks</strong>             </div>
<div>Once you have set up the event callback, and enabled the events, the callback functions will get called from the JVM. Keep in mind that most of these callback functions need to be completely MT-safe (some such as the               <code>JVMTI_EVENT_VM_INIT</code> will only be called once per VM initialization and you have a little flexibility knowing that it's the only active thread), so that means access to any static or extern data needs to be carefully handled, and any native system functions also need to be MT-safe. Ideally, all your C or C++ functions should be designed in a re-entrant style, and static or extern data should be avoided. The simplest approach to protecting static or global data (as seen in most of the JVMTI demos) is to create a single raw monitor in               <code>Agent_OnLoad</code> or               <code>vmInit</code>, and use that raw monitor in all the callbacks to assure that only one callback is active at any given point in time (creates a critical section in the native code). This is also the approach that can create performance bottlenecks in the application using the agent library, by preventing threads from executing at the same time. Often times, a per-thread raw monitor, or multiple raw monitors, will be a better performance solution, but may also become a correctness issue with regards to deadlocks if you aren't careful on the nesting orders when parts of the code need both raw monitors.</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">              <a name="BCI" id="BCI"></a>Byte Code Insertion             </strong>             </div>
<div>
<p>The ability to change the bytecodes of a class has existed in both JVMPI by way of the event                 <code>JVMPI_EVENT_CLASS_LOAD_HOOK,</code> and in JVMDI by way of                 <code>RedefineClasses</code>. In fact, by changing the classpath or using class loaders, the same BCI ability has always existed in some basic form. JVMTI just makes all of these possible. It is important to clarify that JVMTI does not actually do the BCI, just allows for it to happen. BCI can be done with various third party or open source classfile transformation libraries or tools. However, in this document I will treat BCI as a subset of what can be done by a class transformation library, so my definition of BCI limits the class transformation to just the addition of bytecodes and constant pool entries, and the necessary changes to any attributes that refer to the bytecode index values or the constant pool index values. Furthermore, it is intended that this BCI operation does not change the basic nature of the classfile's methods. In other words, you can't change the methods to do something functionally different, and you can't add methods or fields to the classfile. The intent with BCI is to insert bytecodes to understand the normal behavior of a class and the methods of that class.</p>
<p>As an example for the Java 2 SDK, the basic                 <code>hprof</code> ability (that has historically been provided with the Java 2 SDK since version 1.1) was converted from JVMPI to JVMTI. This is the new                 <code>hprof</code> provided in version 1.5.0, using JVMTI and BCI, and the complete source to this                 <code>hprof</code> agent, is available in the                 <code>demo/jvmti</code> directory, along with a fairly detailed HTML user manual. In addition, there is a smaller and simpler demo called                 <code>heapViewer</code> that should provide a basic understanding of how the                 <code>JVMTI_EVENT_CLASS_FILE_LOAD_HOOK</code> event works, which is also used by                 <code>hprof</code>.</p>
<p>Several of the                 <code>demo/jvmti</code> agents, including                 <code>hprof</code> and                 <code>heapViewer</code>, use a small shared demo library called                 <code>java_crw_demo</code> that is delivered as part of the Java 2 SDK version 1.5.0. The source to this library is also provided in the                 <code>demo/jvmti</code> directory. The                 <code>java_crw_demo</code> native library is a primitive classfile transformation library that will insert bytescodes at selected and limited locations in methods, returning a new classfile image. It is important that you understand the classfile layout as described in the                 <a href="#">Java Virtual Machine Specification</a>. Some of the common issues you may encounter doing classfile transformations are:</p>
<ul>
    <li>Additions to the constant pool will be needed. It is easiest if these are added at the end of the constant pool. Don't forget to set the constant pool count correctly in the classfile header. If you do change the constant pool order, watch out for the                   <strong>ldc</strong> bytecodes, some may need to change to                   <strong>ldc_w</strong> bytecodes, and any attribute that uses a constant pool index will need to change, e.g., &quot;                 <strong>InnerClasses</strong>&quot;.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Adding bytecodes can cause some of the bytecodes that follow to need different bytecodes to deal with changing ranges, e.g., a                   <strong>jsr</strong> vs. a                   <strong>jsr_w</strong> instruction. Special care needs to be taken when re-constructing the new Code attribute that all the bytecodes, both inserted and original, are using the correct                   <strong>wide</strong> and '                 <strong>*_w</strong>' bytecodes.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Changes to the bytecodes means that the offsets in the &quot;                 <strong>Exceptions</strong>&quot;, &quot;                 <strong>LineNumberTable</strong>&quot;, &quot;                 <strong>LocalVariableTable</strong>&quot;, and (new for version 1.5.0) &quot;                 <strong>LocalVariableTypeTable</strong>&quot; tables will be invalid. You will need to adjust all these offsets.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>If the inserted bytecode causes or could cause the maximum stack size to increase, the &quot;                 <strong>Code</strong>&quot; attribute will need the                   <strong>                   <code>max_stack</code>                 </strong> field adjusted along with the                   <strong>                   <code>code_length</code>                 </strong>. If you add local variables, you will also need to adjust                   <strong>                   <code>max_locals</code>                 </strong>.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Insertion of bytecodes at the very beginning needs to be done carefully, consider a jump to offset 0 in the original bytecodes. You need to decide if the inserted bytecodes will be executed once on entry, or also when the method does a jump to offset 0.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Insertion before                   <strong>return</strong> bytecodes can also be tricky. If in the original bytecodes this                   <strong>return</strong> bytecode is a target of a                   <strong>jump,</strong> do you want the inserted bytecodes to be executed?</li>
    <li style="list-style: none">&nbsp;</li>
    <li>The special case of the                   <strong>new</strong> bytecode is a less-than-obvious problem. Objects that have not been initialized cannot be passed to ANY Java methods, so doing the obvious injection of a                   <strong>dup</strong> and an                   <strong>invokestatic</strong> after the                   <strong>new</strong> bytecode will not work when bytecode verification is on. This object must be initialized first. So if you wish to capture newly-allocated objects, the best place to catch them is in the                   <strong>                   <code>java.lang.Object.&lt;init&gt;</code>                 </strong>method. Once the object makes it here, you can pass the object around (or of course you could run Java with the verifier off, but that generally isn't a good idea). The                   <strong>newarray</strong> bytecode doesn't have this problem, and in fact the only way to capture these objects is by inserting bytecodes immediately after the                   <strong>newarray</strong> bytecode (don't forget the                   <strong>anewarray</strong> and                   <strong>multianewarray</strong> bytecodes).</li>
    <li style="list-style: none">&nbsp;</li>
    <li>It is best to insert the fewest bytecodes possible, and in                   <code>java_crw_demo</code>, the insertion is limited to pushing a few items on the stack, and making a static method call to a class found in the boot classpath. This so-called tracker class and tracker methods contain Java code that, in our demos, grab the current Thread with a call to                   <code>java.lang.Thread.currentThread</code>, and pass all the arguments, plus the current thread to a native method belonging to the class. The agent will have registered the natives for this class and those native functions are actually static functions inside the agent library.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Any bytecode insertion needs to be careful of the state of the VM when it is called, e.g., has the VM started, or has the VM been initialized. The downside to the JNI call in the Tracker class is that you can't make the JNI call unless the VM is started and the natives have been registered, and the downside to calling                   <code>currentThread</code> is that before the VM is initialized, this thread reference could be                   <code>null</code>.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Once past the VM initialization, any JNI usage and all the native code in the agent library needs to watch out for                   <code>JVMTI_EVENT_VM_DEATH,</code> making sure the code can recover cleanly.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>You may wish to be selective in what classes or methods you apply BCI to, depending on what information you are after. It is always best to limit the intrusion of BCI on the application.</li>
</ul>
<p>As an example, consider the following Java code:               <br />
<br />
<!-- begin VCD7 CODE SAMPLE COMPONENT  --></p>
<table width="100%" cellspacing="0" cellpadding="10" border="0" class="grey4">
    <tbody>
        <tr>
            <td><code>public class Demo {                     <br />
            </code>
            <div style="margin-left: 40px;"><code>private Demo[] newDemo() {                       <br />
            </code>
            <div style="margin-left: 40px;"><code>Demo d[] = new Demo[3];                         <br />
            return d;                         <br />
            </code></div>
            <code>}                       <br />
            </code></div>
            <code>}</code></td>
        </tr>
    </tbody>
</table>
<!-- end VCD7 CODE SAMPLE COMPONENT  -->              <br />
<br />
<p>The                 <code>hprof</code> agent library does BCI in 4 different places, method entry and method exit for the                 <strong>                 <code>cpu=times</code>               </strong> option, and                 <code>java.lang.Object.&lt;init&gt;</code> and                 <strong>newarray</strong> bytecodes for the                 <code>heap=*</code> option. What hprof (or technically                 <code>java_crw_demo</code> gets as input) looks basically like this (used                 <strong>                 <code>javap -c -l -private</code>               </strong> to dump the class file):</p>
<!-- begin VCD7 CODE SAMPLE COMPONENT  -->
<table width="100%" cellspacing="0" cellpadding="10" border="0" class="grey4">
    <tbody>
        <tr>
            <td><code>Compiled from &quot;Demo.java&quot;                     <br />
            public class Demo extends java.lang.Object{                     <br />
            public Demo();                     <br />
            Code:                     <br />
            0: aload_0                     <br />
            1: invokespecial #1; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V                     <br />
            4: return                     <br />
            <br />
            LineNumberTable:                     <br />
            line 1: 0                     <br />
            LocalVariableTable:                     <br />
            Start Length Slot Name Signature                     <br />
            0 5 0 this LDemo;                     <br />
            <br />
            private Demo[] newDemo();                     <br />
            Code:                     <br />
            0: iconst_3                     <br />
            1: anewarray #2; //class Demo                     <br />
            4: astore_1                     <br />
            5: aload_1                     <br />
            6: areturn                     <br />
            <br />
            LineNumberTable:                     <br />
            line 3: 0                     <br />
            line 4: 5                     <br />
            LocalVariableTable:                     <br />
            Start Length Slot Name Signature                     <br />
            0 7 0 this LDemo;                     <br />
            5 2 1 d [LDemo;                   </code>                   <br />
            <code>                    <br />
            }                   </code>                   </td>
        </tr>
    </tbody>
</table>
<!-- end VCD7 CODE SAMPLE COMPONENT  -->              <br />
<p>After                 <code>hprof</code> or                 <code>java_crw_demo</code> gets done with the class, the class would look like:</p>
<!-- begin VCD7 CODE SAMPLE COMPONENT  -->
<table width="100%" cellspacing="0" cellpadding="10" border="0" class="grey4">
    <tbody>
        <tr>
            <td><code>                    <br />
            Compiled from &quot;Demo.java&quot;                     <br />
            public class Demo extends java.lang.Object{                     <br />
            public Demo();                     <br />
            Code:                     <br />
            0: ldc #20; //int 267309056                     <br />
            2: iconst_0                     <br />
            3: invokestatic #34; //Method sun/tools/hprof/Tracker.CallSite:(II)V                     <br />
            6: aload_0                     <br />
            7: invokespecial #1; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V                     <br />
            10: ldc #20; //int 267309056                     <br />
            12: iconst_0                     <br />
            13: invokestatic #38; //Method sun/tools/hprof/Tracker.ReturnSite:(II)V                     <br />
            16: return                     <br />
            <br />
            LineNumberTable:                     <br />
            line 1: 0                     <br />
            LocalVariableTable:                     <br />
            Start Length Slot Name Signature                     <br />
            0 17 0 this LDemo;                     <br />
            <br />
            private Demo[] newDemo();                     <br />
            Code:                     <br />
            0: ldc #20; //int 267309056                     <br />
            2: iconst_1                     <br />
            3: invokestatic #34; //Method sun/tools/hprof/Tracker.CallSite:(II)V                     <br />
            6: iconst_3                     <br />
            7: anewarray #2; //class Demo                     <br />
            10: dup                     <br />
            11: invokestatic #30; //Method sun/tools/hprof/Tracker.NewArray:(Ljava/lang/Object;)V                     <br />
            14: astore_1                     <br />
            15: aload_1                     <br />
            16: ldc #20; //int 267309056                     <br />
            18: iconst_1                     <br />
            19: invokestatic #38; //Method sun/tools/hprof/Tracker.ReturnSite:(II)V                     <br />
            22: areturn                     <br />
            <br />
            LineNumberTable:                     <br />
            line 3: 0                     <br />
            line 4: 15                     <br />
            LocalVariableTable:                     <br />
            Start Length Slot Name Signature                     <br />
            0 23 0 this LDemo;                     <br />
            15 8 1 d [LDemo;                     <br />
            <br />
            }                   </code>                   </td>
        </tr>
    </tbody>
</table>
<!-- end VCD7 CODE SAMPLE COMPONENT  -->              <br />
<p>With appropriate changes to other fields in the class file not shown here (               <code>max_stack</code>, constant pool, etc.). The                 <code>267309056</code> number is the class number assigned to this class by the caller of the                 <code>java_crw_demo</code> library, the second number is the method index for the method getting the insertion. Note the adjustments made to the                 <strong>LineNumberTable</strong> and                 <strong>LocalVariableTable</strong>.</p>
<p>At runtime, the methods in                 <code>sun/tools/hprof/Tracker</code> will call native methods that reside inside the agent library, where JVMTI can be used to sample the stack or in general track this BCI event you have created.</p>
</div>
<span class="sp10">&nbsp;</span><br />
<a name="3" id="3"></a>
<div><strong>Object Tagging and Heap Iteration</strong></div>
<div class="contentdivider">
<table width="100%" cellspacing="0" cellpadding="0" border="0" class="grey4">
    <tbody>
        <tr>
            <td><img width="1" height="4" border="0" src="/ocom/groups/public/@otn/documents/digitalasset/148611.gif" alt=" " /></td>
        </tr>
    </tbody>
</table>
</div>
<div>
<p>JVMTI allows you to attach a tag of type                 <code>jlong</code> (64 bit value) to any Java object in the Heap. This tag stays with the Java object, including movements caused by compaction after Garbage Collection. JVMTI's object-free event provides you that                 <code>jlong</code> tag value instead of an object reference, and JVMTI Heap Iterate also provides these tag values as a form of object identification. The tags can be used to uniquely identify an object, or provide a way to categorize objects. Capturing the objects in order to tag them often involves using BCI, but doesn't require it.</p>
<p>A simple non-BCI heap dump can be obtained by tagging all the loaded classes (               <code>jclass</code> objects or                 <code>java.lang.Class</code>) and then using JVMTI                 <code>IterateOverHeap</code>:</p>
<!-- begin VCD7 CODE SAMPLE COMPONENT  -->
<table width="100%" cellspacing="0" cellpadding="10" border="0" class="grey4">
    <tbody>
        <tr>
            <td><code>static jvmtiIterationControl JNICALL                     <br />
            heapObject(jlong class_tag, jlong size, jlong* tag_ptr, void* user_data)                     <br style="font-family: monospace;" />
            {                     <br />
            </code>
            <div style="margin-left: 40px;"><code>if ( class_tag != (jlong)0 ) {                       <br />
            </code>
            <div style="margin-left: 40px;"><code>ClassDetails *d;                         <br />
            d = (ClassDetails*)(void*)(ptrdiff_t)class_tag;                         <br />
            d-&gt;count++;                         <br />
            d-&gt;space += size;                         <br />
            </code></div>
            <code>}                       <br />
            return JVMTI_ITERATION_CONTINUE;                       <br />
            </code></div>
            <code>}                     <br />
            <br />
            static void JNICALL                     <br />
            dataDumpRequest(jvmtiEnv *jvmti)                     <br />
            {                     <br />
            </code>
            <div style="margin-left: 40px;"><code>jclass *classes;                       <br />
            jint count;                       <br />
            jint i;                       <br />
            ClassDetails *details;                       <br />
            <br />
            (*jvmti)-&gt;GetLoadedClasses(jvmti, &amp;count, &amp;classes);                       <br />
            details = (ClassDetails*)calloc(sizeof(ClassDetails), count);                       <br />
            for ( i = 0 ; i &lt; count ; i++ ) {                       <br />
            </code></div>
            <div style="margin-left: 80px;"><code>char *sig;                       <br />
            </code></div>
            <div style="margin-left: 80px;"><code>(*jvmti)-&gt;GetClassSignature(jvmti, classes[i], &amp;sig, NULL);                       <br />
            details[i].signature = strdup(sig);                       <br />
            (*jvmti)-&gt;Deallocate(jvmti, sig);                       <br />
            (*jvmti)-&gt;SetTag(jvmti, classes[i], (jlong)(ptrdiff_t)(void*)(&amp;details[i]));                       <br />
            </code></div>
            <div style="margin-left: 40px;"><code>}                       <br />
            (*jvmti)-&gt;IterateOverHeap(jvmti, JVMTI_HEAP_OBJECT_EITHER, &amp;heapObject, NULL);                       <br />
            </code></div>
            <code>}                     <br />
            </code></td>
        </tr>
    </tbody>
</table>
<!-- end VCD7 CODE SAMPLE COMPONENT  -->              <br />
<p>Note that much of the error handling and checking code has been left out of the above example, you should refer to the complete source of this demo for complete details. The above example code does not tell you where these objects were allocated, and not all objects will be accounted for (primitive classes are not included), but it does provide a quick and easy way to find statistics on the space used by the various objects in the heap. Some common tips around tags and heap iterations:</p>
<ul>
    <li>When using a tag that is a pointer, use a cast to                   <code>ptrdiff_t</code>(Standard C                   <code>typedef</code> for an integer that holds a pointer difference) to avoid compiler warnings and errors. Never use                   <code>int</code> or                   <code>long</code>, you'll find out that                   <code>int</code> and                   <code>long</code> are not always big enough to hold a pointer, truncating your address, where                   <code>ptrdiff_t</code> will always be big enough to hold all the bits of a pointer.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Remember that any pointer used as a tag is native memory that cannot move, or if moved, the tag is invalid.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>The heap iteration callbacks can execute with a different thread than the iterate call, so holding a raw monitor around the iterate call is a guarantee of a deadlock if the callbacks also need that raw monitor.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>The iterate callbacks allow you to change or set the tags on objects, so they also serve as a quick way to tag groups of objects, or remove tags.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Don't forget the other objects not allocated in bytecodes: track JNI allocations using JVMTI JNI function interception, and track misc JVM allocations with the                   <code>JVMTI_EVENT_VM_OBJECT_ALLOC</code> event.</li>
</ul>
</div>
<span class="sp10">&nbsp;</span><br />
<div><!-- <span class="sp10">&nbsp;</span><br /> -->              <strong class="dkgrey">General JVMTI and Agent Library Advice</strong>             </div>
<div>
<ul>
    <li>Use                   <code>GetCurrentThreadCpuTime</code> over                   <code>GetThreadCpuTime</code>. Access to the current thread data will almost always be faster than accessing thread data from another thread.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>When doing BCI, be careful to avoid infinite recursion (the BCI bytecodes calling the BCI code, or the BCI code making some other Java call which results in calls to the BCI code).</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Be very careful with                   <code>RawMonitorEnter</code> calls inside BCI code. Holding locks in BCI code can destroy performance on multiple-CPU machines.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Operations on thread lists will naturally be more efficient than cycling over the threads yourself, e.g., use                   <code>GetThreadListStackTraces</code> instead of looping over                   <code>GetStackTrace</code>.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Isolate any JNI object references (                 <code>jobject</code>,                   <code>jstring</code>,                   <code>jclass</code>, or                   <code>jthread</code>) that need to be saved. These will need JNI Global or Weak references created for them, and you will need to manage these references, using JNI to delete them when they are no longer needed.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Check ALL the                   <code>jvmtiError</code> returns, you'd be surprised how important it is to find these non-                 <code>JVMTI_ERROR_NONE</code> error returns early in the agent library execution.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>The                   <code>JVMTI_ERROR_WRONG_PHASE</code> errors are your friends, they are likely telling you that the agent library has a thread race condition. The older interfaces JVMPI and JVMDI did not have this feature, and with JVMTI having documented and specified phases where everything can be called, these PHASE errors can help you track down synchronization errors during agent startup and shutdown.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Watch out for JVMTI memory allocations by some of the interfaces. It is the caller's responsibility to deallocate this space with JVMTI                   <code>Deallocate</code>.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>You can use JVMTI                   <code>Allocate</code> to allocate all your agent memory needs, or you can use the system                   <code>malloc</code> functions. If you choose to use                   <code>malloc</code> or something other than JVMTI, be very careful not to mix these up. Using multiple memory allocation schemes in your native code can be error-prone.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>On Linux and Solaris, use version scripts or mapfiles when building your shared library, to limit the externs available to                   <code>Agent_OnLoad</code> and                   <code>Agent_OnUnload</code>. On Windows only, export the                   <code>Agent_OnLoad</code> and                   <code>Agent_OnUnload</code> externs. In general, this is just a safe way to build your shared library.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>See the main                   <code>demo/jvmti/index.html</code> page for help in selecting the right C and C++ compiler options.</li>
    <li style="list-style: none">&nbsp;</li>
    <li>Consider some kind of tracing or logging option in your agent. Something as simple as this might prove useful to you:
    <table width="100%" cellspacing="0" cellpadding="10" border="0" class="grey4">
        <tbody>
            <tr>
                <td><code>#define LOG(a) ( gdata-&gt;logflags != 0 ? printf a : 0 )                         <br />
                ...                         <br />
                </code>                      <code>LOG((&quot;Entered callback %s\n&quot;, VMStart));</code></td>
            </tr>
        </tbody>
    </table>
    <!-- end VCD7 CODE SAMPLE COMPONENT  --></li>
    <li style="list-style: none">&nbsp;</li>
    <li>Consider a                   <code>pause=y</code> option that will pause the process at                   <code>Agent_OnLoad</code> option parsing time, allowing for a debugger to attach to the process. Have the                   <code>pause=y</code> option print out a message containing the PID (see                   <code>getpid</code>).</li>
    <li style="list-style: none">&nbsp;</li>
    <li>JVMTI does provide some tracing options in the VM. These options may not be available in all the VM's and this is not an officially supported option. The syntax is                   <code>'</code>                 <strong>                   <code>java -XX:TraceJVMTI=</code>                 </strong>                 <em>                   <strong>desc</strong>                 </em>                 <strong>                   <code>{,</code>                 </strong>                 <strong>desc</strong>                 <strong>                   <code>} ...</code>                 </strong>                 <code>'</code> where each                   <em>                   <strong>desc</strong>                 </em> is composed of 3 fields (no blanks) '                 <em>                   <strong>domain action kind</strong>                 </em>'. The                   <em>                   <strong>domain</strong>                 </em> field is one of                   <em>                   <strong>name</strong>                 </em> (a particular function or event name),                   <strong>                   <code>all</code>                 </strong> (all functions and events),                   <strong>                   <code>func</code>                 </strong>(all major functions),                   <strong>                   <code>allfunc</code>                 </strong>(all functions),                   <strong>                   <code>event</code>                 </strong> (all events), or                   <strong>                   <code>ec</code>                 </strong> (event controller). The action field is                   <strong>                   <code>'+'</code>                 </strong> to add or                   <code>'-'</code>to remove. The kind field is                 <strong>                   <code>'i'</code>                 </strong> (input params),                   <strong>                   <code>'e'</code>                 </strong> (error returns),                   <strong>                   <code>'o'</code>                 </strong> (output),                   <strong>                   <code>'t'</code>                 </strong> (event triggered a.k.a. posted), or                   <strong>                   <code>'s'</code>                 </strong>(event sent). An example:                   <strong>                   <code>java-XX:TraceJVMTI=ec+,GetCallerFrame+ie,Breakpoint+s ...</code>                 </strong></li>
    <li style="list-style: none">&nbsp;</li>
    <li>Don't be afraid to use the java options like                   <strong>                   <code>-Xcheck:jni</code>                 </strong></li>
</ul>
</div>
<span class="sp10">&nbsp;</span><br />
<a name="4" id="4"></a>
<div><strong>Summary</strong></div>
<div class="contentdivider">
<table width="100%" cellspacing="0" cellpadding="0" border="0" class="grey4">
    <tbody>
        <tr>
            <td><img width="1" height="4" border="0" src="/ocom/groups/public/@otn/documents/digitalasset/148611.gif" alt=" " /></td>
        </tr>
    </tbody>
</table>
</div>
<div>
<p>How easy the transition from JVMPI to JVMTI is really depends on the complexity of the specific agent library, how much of JVMPI was used, and using JVMTI in such a way that performance of the target application doesn't suffer. Some of the conversion will be fairly straightforward, but other parts may take some time and even require several iterations over the design. Don't underestimate this effort.</p>
<p>JVMTI is part of Java Specification Request 163 (               <a href="http://jcp.org/en/jsr/detail?id=163">JSR-163</a>) of the Java Community Process (               <a href="http://jcp.org">JCP</a>).</p>
<p>All the examples in this document have been taken from operating JVMTI demo agents available with the Java 2 SDK version 1.5.0. To see the latest JVMTI demos, just point your browser to the                 <code>demo/jvmti</code> directory of your Java 2 SDK installation and you should have access to all the demo documents plus the complete source of all the JVMTI demos in the file                 <code>demo/jvmti/src.zip</code>. Downloads are available at the                 <a href="/technetwork/java/javase/downloads/index-jdk5-jsp-142662.html">J2SE 1.5.0 Beta 2 downloads</a> page.</p>
</div>
<span class="sp10">&nbsp;</span><br />
<a name="5" id="5"></a>
<div><strong>About the Author</strong></div>
<div class="contentdivider">
<table width="100%" cellspacing="0" cellpadding="0" border="0" class="grey4">
    <tbody>
        <tr>
            <td><img width="1" height="4" border="0" src="/ocom/groups/public/@otn/documents/digitalasset/148611.gif" alt=" " /></td>
        </tr>
    </tbody>
</table>
</div>
<div>Kelly O'Hair is a Senior Staff Engineer in Sun Microsystems' Java Serviceability group. He has been at Sun for over 11 years having worked on dbx, Java WorkShop, fastjavac, Java on Solaris, native compiler Dwarf debug format generation, and the Native Connector Tool that allows Java easy access to native shared libraries.             <br />
<br />
More recently Kelly has been working with the JVMTI interface, making sure this new interface is well tested, documented, and easy to use. He holds an M.S. degree in Computing Science from University of California, Davis and a B.A. in Mathematics from California State University, Long Beach.</div>
<span class="sp10">&nbsp;</span><br />
<hr width="5%" align="left" />
<br />
<p><a name="TJVM" id="TJVM"></a>              <sup>1</sup>              As used on this web site, the terms &quot;Java virtual machine&quot; or &quot;JVM&quot; mean a virtual machine for the Java platform.</p>
<script xmlns="http://www.w3.org/1999/xhtml" src="" type="text/javascript">
//<![CDATA[
<!-- Hide script from older browsers
// Popup window function
function onRateSubmitHandler()
{
var w = window.open("","rr","width=800,height=600,status=no,toolbar=no,scrollbars=yes"); 
w.setTimeout("window.close();", 30000 );
return true;
}
// End of javascript 
-->
//]]>
</script>
<form target="rr" onsubmit="return onRateSubmitHandler()" name="form" method="post" action="https://www2.sun.de/dc/servlets/incoming">
    <input type="hidden" value="1" name="errcount" />               <input type="hidden" value="http://www2.sun.de/dc/forms/reg_xh_2610_243.jsp" name="ref" />               <input type="hidden" value="" name="" />
    <table width="100%" cellspacing="0" cellpadding="1" border="0" style="margin-top:7px" class="dkgrey">
        <tbody>
            <tr>
                <td>
                <table width="100%" cellspacing="0" cellpadding="4" border="0" class="white">
                    <tbody>
                        <tr>
                            <td class="dkgrey1"><strong>Rate and Review</strong></td>
                        </tr>
                        <tr>
                            <td>Tell us what you think of the content of this page.</td>
                        </tr>
                        <tr>
                            <td><strong>                          <input type="radio" value="Excellent" name="custom_3" /> Excellent&nbsp;&nbsp;                             <input type="radio" value="Good" name="custom_3" /> Good&nbsp;&nbsp;                             <input type="radio" value="Fair" name="custom_3" /> Fair&nbsp;&nbsp;                             <input type="radio" value="Poor" name="custom_3" /> Poor&nbsp;&nbsp;                         </strong></td>
                        </tr>
                        <tr>
                            <td><strong>Comments:</strong>                         <br />
                            <textarea wrap="virtual" rows="3" name="custom_2" cols="60"></textarea></td>
                        </tr>
                        <tr>
                            <td><strong>Your email address (no reply is possible without an address):</strong>                         <br />
                            <a target="_new" href="http://sun.com/privacy/">Sun Privacy Policy</a>                         <br />
                            <input type="text" value="" size="35" name="custom_1" maxlength="60" />                        <br />
                            Note: We are not able to respond to all submitted comments.</td>
                        </tr>
                        <tr>
                            <td><input type="submit" border="0" value="&nbsp;Submit &raquo;&nbsp;" onmouseover="this.style.color='#fbe249';" onmouseout="this.style.color='#FFF';" class="buttonblue" />                           <input type="hidden" value="Kelly O'Hair" name="custom_0" />                           <input type="hidden" value="The JVMPI Transition to JVMTI" name="custom_4" />                           <input type="hidden" value="#" name="custom_5" />                           <input type="hidden" value="Rate and Review - article feedback" name="cf_Form_Name" />                           <input type="hidden" value="Registrations" name="cf_Form_Location" />                           <input type="hidden" value="XH" name="cf_iso2" />                           <input type="hidden" value="ISO-8859-1" name="charset" /></td>
                        </tr>
                    </tbody>
                </table>
                </td>
            </tr>
        </tbody>
    </table>
</form>
		false
		,,,,,,,,,,,,,,,

          </div>
        </div>
  	</div>
	</div>
	<!-- /F02v0 -->      
        <div id="Wrapper_FixedWidth_Footer">
        <div class="addThisPrintEmail">
        <!--SS_BEGIN_SNIPPET(fragment39,1)--> &nbsp;&nbsp;&nbsp;
	<a href="javascript:mailpage()"><img height="16" alt="E-mail this page" src="/us/assets/email.gif" width="19" border="0" /></a> <span style="MARGIN-BOTTOM: 2px">
	<a href="javascript:mailpage()">E-mail this page</a></span>&nbsp;&nbsp;&nbsp;
	<a onclick="printerView()" href="javascript: void 0;"><img height="16" alt="Printer View" src="/us/assets/print_icon.gif" width="19" border="0" />&nbsp;Printer View</a>
			<!--SS_END_SNIPPET(fragment39,1)-->
         </div>

<!-- SS_BEGIN_SNIPPET(fragment42,ocomfooter)-->				
		<!-- U10v0 -->
<div id="u10" class="u10v0" data-trackas="ffooter">
<div class="u10w1">
<div class="u10w2">
<div class="u10w3">
<h5>Contact Us</h5>
<ul>
    <li>US Sales: +1.800.633.0738</li>
    <li><a data-lbl="contact-us:have-oracle-call-you" href="javascript:startCallback('0i2wzK12842','customer data')" onclick="navTrack('ocom','en','rhs-contact','callmenow-oracle');">Have Oracle Call You</a></li>
    <li><a data-lbl="contact-us:global-contacts" href="https://www.oracle.com/corporate/contact/global.html">Global Contacts</a></li>
    <li><a data-lbl="contact-us:support-directory" href="https://www.oracle.com/support/contact.html">Support Directory</a></li>
</ul>
</div>
<div class="u10w3">
<h5>About Oracle</h5>
<ul>
    <li><a data-lbl="about-oracle:company-information" href="https://www.oracle.com/corporate/index.html">Company Information</a></li>
    <li><a data-lbl="about-oracle:communities" href="https://www.oracle.com/communities/index.html">Communities</a></li>
    <li><a data-lbl="about-oracle:careers" href="https://www.oracle.com/corporate/careers/index.html">Careers</a></li>
</ul>
</div>
</div>
<div class="u10w2">
<div class="u10w3">
<h5>Cloud</h5>
<ul>
    <li><a data-lbl="cloud:overview-of-cloud-solutions" href="https://www.oracle.com/cloud/index.html">Overview of Cloud Solutions</a></li>
    <li><a data-lbl="cloud:software(saas)" href="https://cloud.oracle.com/saas?intcmp=ocom-ft">Software (SaaS)</a></li>
    <li><a data-lbl="cloud:platform(paas)" href="https://cloud.oracle.com/paas?intcmp=ocom-ft">Platform (PaaS)</a></li>
    <li><a data-lbl="cloud:infrastructure(iaas)" href="https://cloud.oracle.com/iaas?intcmp=ocom-ft">Infrastructure (IaaS)</a></li>
    <li><a data-lbl="cloud:data(daas)" href="https://cloud.oracle.com/data-cloud?intcmp=ocom-ft">Data (DaaS)</a></li>
    <li><a data-lbl="cloud:free-cloud-trial" href="https://cloud.oracle.com/tryit?intcmp=ocom-ft">Free Cloud Trial</a></li>
</ul>
</div>
<div class="u10w3">
<h5>Events</h5>
<ul>
    <li><a data-lbl="events:oracle-openworld" href="https://www.oracle.com/openworld/index.html">Oracle OpenWorld</a></li>
    <li><a data-lbl="events:oracle-code" href="https://developer.oracle.com/code">Oracle Code</a></li>
    <li><a data-lbl="events:javaone" href="https://www.oracle.com/javaone/index.html">JavaOne</a></li>
    <li><a data-lbl="events:all-oracle-events" href="https://www.oracle.com/search/events">All Oracle Events</a></li>
</ul>
</div>
</div>
<div class="u10w2">
<div class="u10w3">
<h5>Top Actions</h5>
<ul>
    <li><a data-lbl="top-actions:download-java" href="https://www.java.com/download/">Download Java</a></li>
    <li><a data-lbl="top-actions:download-java-for-developers" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Download Java for Developers</a></li>
    <li><a data-lbl="top-actions:try-oracle-cloud" href="https://cloud.oracle.com/tryit?intcmp=ocom-ft">Try Oracle Cloud</a></li>
    <li><a data-lbl="top-actions:subscribe-to-emails" href="https://go.oracle.com/subscriptions?l_code=en-us&amp;src1=OW:O:FO">Subscribe to Emails</a></li>
</ul>
</div>
<div class="u10w3">
<h5>News</h5>
<ul>
    <li><a data-lbl="news:newsroom" href="https://www.oracle.com/corporate/press/index.html">Newsroom</a></li>
    <li><a data-lbl="news:magazines" href="http://www.oracle.com/us/corporate/publishing/index.html">Magazines</a></li>
    <li><a data-lbl="news:customer-success-stories" href="https://www.oracle.com/search/customers">Customer Success Stories</a></li>
    <li><a data-lbl="news:blogs" href="https://blogs.oracle.com/">Blogs</a></li>
</ul>
</div>
</div>
<div class="u10w2">
<div class="u10w3">
<h5>Key Topics</h5>
<ul>
    <li><a data-lbl="key-topics:erp-erm(finance)" href="https://www.oracle.com/applications/erp/index.html">ERP, EPM (Finance)</a></li>
    <li><a data-lbl="key-topics:hcm(hr-talent)" href="https://www.oracle.com/applications/human-capital-management/index.html">HCM (HR, Talent)</a></li>
    <li><a data-lbl="key-topics:marketing" href="https://www.oracle.com/marketingcloud/index.html">Marketing</a></li>
    <li><a data-lbl="key-topics:cx(sales-service-commerce)" href="https://www.oracle.com/applications/customer-experience/index.html">CX (Sales, Service, Commerce)</a></li>
    <li><a data-lbl="key-topics:supply-chain" href="https://www.oracle.com/applications/supply-chain-management/index.html">Supply Chain</a></li>
    <li><a data-lbl="key-topics:industry-solutions" href="https://www.oracle.com/industries/index.html">Industry Solutions</a></li>
    <li><a data-lbl="key-topics:database" href="https://www.oracle.com/database/index.html">Database</a></li>
    <li><a data-lbl="key-topics:mysql" href="https://www.oracle.com/mysql/index.html">MySQL</a></li>
    <li><a data-lbl="key-topics:middleware" href="https://www.oracle.com/middleware/index.html">Middleware</a></li>
    <li><a data-lbl="key-topics:java" href="https://www.oracle.com/java/index.html">Java</a></li>
    <li><a data-lbl="key-topics:engineered-systems" href="https://www.oracle.com/engineered-systems/index.html">Engineered Systems</a></li>
</ul>
</div>
</div>
<div class="u10w4"><hr />
</div>
<div class="u10w5" data-trackas="footer">
<ul class="scl-icons">
    <li class="scl-facebook"><a data-lbl="scl-icon:facebook" href="http://www.oracle.com/us/social-media/facebook/index.html" title="Oracle on Facebook">Facebook</a></li>
    <li class="scl-twitter"><a data-lbl="scl-icon:twitter" href="http://www.oracle.com/us/social-media/twitter/index.html" title="Follow Oracle on Twitter">Twitter</a></li>
    <li class="scl-linkedin"><a data-lbl="scl-icon:linkedin" href="http://www.oracle.com/us/social-media/linkedin/index.html" title="Oracle on LinkedIn">LinkedIn</a></li>
    <li class="scl-googleplus"><a data-lbl="scl-icon:google-plus" href="https://plus.google.com/115607918987921226255" title="Follow Oracle on Google+">Google+</a></li>
    <li class="scl-youtube"><a data-lbl="scl-icon:you-tube" href="http://www.youtube.com/oracle/" title="Watch Oracle on YouTube">YouTube</a></li>
    <li class="scl-feed"><a data-lbl="scl-icon:rss" href="http://www.oracle.com/us/syndication/feeds/index.html" title="Oracle RSS Feeds">Oracle RSS Feed</a></li>
</ul>
<div class="u10-ologo"><a data-lbl="integrated-cloud-applications-and-platform-services" href="https://www.oracle.com/index.html">Oracle</a></div>
<h3>Integrated Cloud Applications &amp; Platform Services</h3>
<ul class="u10-links">
    <li><a data-lbl="copyright" href="https://www.oracle.com/legal/copyright.html">&copy; Oracle</a></li>
    <li><a data-lbl="site-map" href="/sitemap.html">Site Map</a></li>
    <li><a data-lbl="terms-of-use-and-privacy" href="https://www.oracle.com/legal/privacy/index.html">Terms of Use and Privacy</a></li>
    <li>
    <div id="teconsent">&nbsp;</div>
    </li>
    <li class="u10last"><a data-lbl="ad-choices" href="https://www.oracle.com/legal/privacy/privacy-policy.html#advertising">Ad Choices</a></li>
</ul>
</div>
</div>
</div>
<!-- /U10v0 -->
 
			<!-- SS_END_SNIPPET(fragment42,ocomfooter)-->

        </div>
      </div>

      <div class="sitefinder_content" id="light">
        <!--spacer-->
      </div>

      <div class="lightbox_overlay" id="fade">
        <!--spacer-->
      </div>
<!--SS_BEGIN_SNIPPET(fragment38,1)-->
				<!-- Start SiteCatalyst code -->
<script language="JavaScript" src="/us/assets/metrics/ora_otn.js"></script>
<!-- End SiteCatalyst code --> 

			<!--SS_END_SNIPPET(fragment38,1)-->

    </div>
  </div>
<!--SS_BEGIN_SNIPPET(fragment35,universal-webcache-integration)-->
				
				
			<!--SS_END_SNIPPET(fragment35,universal-webcache-integration)-->


<!--DTM embed code - Footer -->
<script type="text/javascript">_satellite.pageBottom();</script>
<!--End-->
</body>
</html>