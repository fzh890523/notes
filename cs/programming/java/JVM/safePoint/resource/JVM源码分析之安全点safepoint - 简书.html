<!DOCTYPE html>
<!--[if IE 6]><html class="ie lt-ie8"><![endif]-->
<!--[if IE 7]><html class="ie lt-ie8"><![endif]-->
<!--[if IE 8]><html class="ie ie8"><![endif]-->
<!--[if IE 9]><html class="ie ie9"><![endif]-->
<!--[if !IE]><!-->
<html><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">

  <!-- Start of Baidu Transcode -->
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta name="applicable-device" content="pc,mobile">
  <meta name="MobileOptimized" content="width">
  <meta name="HandheldFriendly" content="true">
  <meta name="mobile-agent" content="format=html5;url=http://www.jianshu.com/p/c79c5e02ebe6">
  <!-- End of Baidu Transcode -->

    <meta name="description" content="简书 占小狼转载请注明原创出处，谢谢！ 上周有幸参加了一次关于JVM的小范围分享会，听完R大对虚拟机C2编译器的讲解，我的膝盖一直是肿的，能记住的实在有点少，能听进去也不多1、什么时候进行C2编译，如何进行C2编译（这个实在太复杂）2、C2编译的时候，是对整个方法体进行编译，而不是某个方法段3、JVM中的safepoint 一直都知道，当发生GC时，正在执行Java code的线程必须全部停...">

  <meta name="360-site-verification" content="604a14b53c6b871206001285921e81d8">
  <meta property="wb:webmaster" content="294ec9de89e7fadb">
  <meta property="qc:admins" content="104102651453316562112116375">
  <meta property="qc:admins" content="11635613706305617">
  <meta property="qc:admins" content="1163561616621163056375">
  <meta name="google-site-verification" content="cV4-qkUJZR6gmFeajx_UyPe47GW9vY6cnCrYtCHYNh4">
  <meta name="google-site-verification" content="HF7lfF8YEGs1qtCE-kPml8Z469e2RHhGajy6JPVy5XI">
  <meta http-equiv="mobile-agent" content="format=html5; url=http://www.jianshu.com/p/c79c5e02ebe6">

  <!-- Apple -->
  <meta name="apple-mobile-web-app-title" content="简书">

    <!--  Meta for Smart App Banner -->
  <meta name="apple-itunes-app" content="app-id=888237539, app-argument=jianshu://notes/11834889">
  <!-- End -->

  <!--  Meta for Twitter Card -->
  <meta content="summary" property="twitter:card">
  <meta content="@jianshucom" property="twitter:site">
  <meta content="JVM源码分析之安全点safepoint" property="twitter:title">
  <meta content="简书 占小狼转载请注明原创出处，谢谢！ 上周有幸参加了一次关于JVM的小范围分享会，听完R大对虚拟机C2编译器的讲解，我的膝盖一直是肿的，能记住的实在有点少，能听进去也不多1、什么时候进行C2编译，如何进行C2编译（这个实在太复杂）2、C2编译的时候，是对整个方法体进行编译，而不是某个方法段3、JVM中的safepoint 一直都知道，当发生GC时，正在执行Java code的线程必须全部停下来，才可以进行垃圾回收，这就是熟悉的STW（stop the world），但是STW的背后实现原理，比如这些线程如何暂停、又如何恢复？就比较疑惑了。 然而这一切的一切，都涉及到一个概念safepo..." property="twitter:description">
  <meta content="http://www.jianshu.com/p/c79c5e02ebe6" property="twitter:url">
  <!-- End -->

  <!--  Meta for OpenGraph -->
  <meta property="fb:app_id" content="865829053512461">
  <meta property="og:site_name" content="简书">
  <meta property="og:title" content="JVM源码分析之安全点safepoint">
  <meta property="og:type" content="article">
  <meta property="og:url" content="http://www.jianshu.com/p/c79c5e02ebe6">
  <meta property="og:description" content="简书 占小狼转载请注明原创出处，谢谢！ 上周有幸参加了一次关于JVM的小范围分享会，听完R大对虚拟机C2编译器的讲解，我的膝盖一直是肿的，能记住的实在有点少，能听进去也不多1、什么时候进行C2编...">
  <!-- End -->

  <!--  Meta for Facebook Applinks -->
  <meta property="al:ios:url" content="jianshu://notes/11834889">
  <meta property="al:ios:app_store_id" content="888237539">
  <meta property="al:ios:app_name" content="简书">

  <meta property="al:android:url" content="jianshu://notes/11834889">
  <meta property="al:android:package" content="com.jianshu.haruki">
  <meta property="al:android:app_name" content="简书">
  <!-- End -->


    <title>JVM源码分析之安全点safepoint - 简书</title>

  <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="qBSYvo9rPpUMPXe2DrDS5Sj0K1gt+zXdkxUDgp8tfFOsiKxU9tYPDiKUKRwsEaFP6Y+wpImtQXizPb/2S8SlLg==">

  <link rel="stylesheet" media="all" href="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/web-1e5054a5d8733cfec67f.css">
  
  <link rel="stylesheet" media="all" href="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/entry-1e5054a5d8733cfec67f.css">

  <link href="http://cdn2.jianshu.io/assets/favicons/favicon-783beb88ed621ceab614de960376ac0c.ico" rel="icon">
      <link rel="apple-touch-icon-precomposed" href="http://cdn2.jianshu.io/assets/apple-touch-icons/57-47624b2e2161e8eb144462c85db0a5ff.png" sizes="57x57">
      <link rel="apple-touch-icon-precomposed" href="http://cdn2.jianshu.io/assets/apple-touch-icons/72-c00cde7cf98fc49e50cbb3ee1dcd5804.png" sizes="72x72">
      <link rel="apple-touch-icon-precomposed" href="http://cdn2.jianshu.io/assets/apple-touch-icons/76-e8af0bdeaf1ba31e303b1fde8b5e66c4.png" sizes="76x76">
      <link rel="apple-touch-icon-precomposed" href="http://cdn2.jianshu.io/assets/apple-touch-icons/114-f4c78569bbf1977e8382a5fd90c9237a.png" sizes="114x114">
      <link rel="apple-touch-icon-precomposed" href="http://cdn2.jianshu.io/assets/apple-touch-icons/120-cf10c3711dba269522743729efe66bbc.png" sizes="120x120">
      <link rel="apple-touch-icon-precomposed" href="http://cdn2.jianshu.io/assets/apple-touch-icons/152-7bd60457b5f3ecbf1343f0e6241be4f8.png" sizes="152x152">
<link rel="stylesheet" href="blob:http://www.jianshu.com/46744b9f-b2db-9e47-91f2-0ab502b89349"><link rel="stylesheet" href="blob:http://www.jianshu.com/e16832ca-2537-2040-949c-c31d2d09570b"></head>

  <body class="reader-black-font" lang="zh-CN">
    <!-- 全局顶部导航栏 -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="width-limit">
    <!-- 左上方 Logo -->
    <a class="logo" href="http://www.jianshu.com/"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/logo-58fd04f6f0de908401aa561cda6a0688.png" alt="Logo"></a>

    <!-- 右上角 -->
      <!-- 登录显示写文章 -->
      <a class="btn write-btn" target="_blank" href="http://www.jianshu.com/writer#/">
        <i class="iconfont ic-write"></i>写文章
</a>
    <!-- 如果用户登录，显示下拉菜单 -->
      <div class="user">
        <div data-hover="dropdown">
          <a class="avatar" href="http://www.jianshu.com/u/4b55ee401111"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/9-cceda3cf5072bcdd77e8ca4f21c40998.jpg" alt="120"></a>
        </div>
        <ul class="dropdown-menu">
          <li>
            <a href="http://www.jianshu.com/u/4b55ee401111">
              <i class="iconfont ic-navigation-profile"></i><span>我的主页</span>
</a>          </li>
          <li>
            <!-- TODO bookmarks_path -->
            <a href="http://www.jianshu.com/bookmarks">
              <i class="iconfont ic-navigation-mark"></i><span>收藏的文章</span>
</a>          </li>
          <li>
            <a href="http://www.jianshu.com/users/4b55ee401111/liked_notes">
              <i class="iconfont ic-navigation-like"></i><span>喜欢的文章</span>
</a>          </li>
          <li>
            <a href="http://www.jianshu.com/wallet">
              <i class="iconfont ic-navigation-wallet"></i><span>我的钱包</span>
</a>          </li>
          <li>
            <a href="http://www.jianshu.com/settings">
              <i class="iconfont ic-navigation-settings"></i><span>设置</span>
</a>          </li>
          <li>
            <a href="http://www.jianshu.com/faqs">
              <i class="iconfont ic-navigation-feedback"></i><span>帮助与反馈</span>
</a>          </li>
          <li>
            <a rel="nofollow" data-method="delete" href="http://www.jianshu.com/sign_out">
              <i class="iconfont ic-navigation-signout"></i><span>退出</span>
</a>          </li>
        </ul>
      </div>

    <div class="style-mode"><a class="style-mode-btn"><i class="iconfont ic-navigation-mode"></i></a> <div class="popover-modal" style="left: 0px; display: none;"><div class="meta"><i class="iconfont ic-navigation-night"></i><span>夜间模式</span></div> <div class="switch day-night-group"><a class="switch-btn">开</a> <a class="switch-btn active">关</a></div> <hr> <div class="switch font-family-group"><a class="switch-btn font-song">宋体</a> <a class="switch-btn font-hei active">黑体</a></div> <div class="switch"><a class="switch-btn active">简</a> <a class="switch-btn">繁</a></div></div></div>
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu" aria-expanded="false">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse" id="menu">
        <ul class="nav navbar-nav">
            <li class="">
              <a href="http://www.jianshu.com/">
                <span class="menu-text">发现</span><i class="iconfont ic-navigation-discover menu-icon"></i>
</a>            </li>
            <li class="">
              <a href="http://www.jianshu.com/subscriptions">
                <span class="menu-text">关注</span><i class="iconfont ic-navigation-follow menu-icon"></i>
</a>            </li>
            <li class="notification"><a data-hover="dropdown" href="http://www.jianshu.com/notifications" class="notification-btn"><span class="menu-text">消息</span> <i class="iconfont ic-navigation-notification menu-icon"></i> <!----> <!----></a> <ul class="dropdown-menu"><li><a href="http://www.jianshu.com/notifications#/comments"><i class="iconfont ic-comments"></i> <span>评论</span> <!----></a></li><li><a href="http://www.jianshu.com/notifications#/chats"><i class="iconfont ic-chats"></i> <span>简信</span> <!----></a></li><li><a href="http://www.jianshu.com/notifications#/requests"><i class="iconfont ic-requests"></i> <span>投稿请求</span> <!----></a></li><li><a href="http://www.jianshu.com/notifications#/likes"><i class="iconfont ic-likes"></i> <span>喜欢和赞</span> <!----></a></li><li><a href="http://www.jianshu.com/notifications#/follows"><i class="iconfont ic-follows"></i> <span>关注</span> <!----></a></li><li><a href="http://www.jianshu.com/notifications#/money"><i class="iconfont ic-money"></i> <span>赞赏</span> <!----></a></li><li><a href="http://www.jianshu.com/notifications#/others"><i class="iconfont ic-others"></i> <span>其他消息</span> <!----></a></li></ul></li>
          <li class="search">
            <form target="_blank" action="/search" accept-charset="UTF-8" method="get"><input name="utf8" value="✓" type="hidden">
              <input name="q" id="q" placeholder="搜索" class="search-input" type="text">
              <a class="search-btn" href="javascript:void(null)"><i class="iconfont ic-search"></i></a>
              <!-- <div id="navbar-trending-search"></div> -->
</form>          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

    
<div class="note">
  <div class="post">
    <div class="article">
        <h1 class="title">JVM源码分析之安全点safepoint</h1>

        <!-- 作者区域 -->
        <div class="author">
          <a class="avatar" href="http://www.jianshu.com/u/90ab66c248e6">
            <img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/e504c85fb1dc.png" alt="144">
</a>          <div class="info">
            <span class="tag">作者</span>
            <span class="name"><a href="http://www.jianshu.com/u/90ab66c248e6">占小狼</a></span>
            <!-- 关注用户按钮 -->
            <a class="btn btn-default following"><i class="iconfont ic-followed"></i><span>已关注</span></a>
            <!-- 文章数据信息 -->
            <div class="meta">
              <!-- 如果文章更新时间大于发布时间，那么使用 tooltip 显示更新时间 -->
                <span class="publish-time">2017.04.30 14:47</span>
              <span class="wordage">字数 1835</span>
            <span class="views-count">阅读 1226</span><span class="comments-count">评论 8</span><span class="likes-count">喜欢 18</span></div>
          </div>
          <!-- 如果是当前作者，加入编辑按钮 -->
        </div>
        <!-- -->

        <!-- 文章内容 -->
        <div data-note-content="" class="show-content">
          <blockquote><p>简书 <a href="http://www.jianshu.com/users/90ab66c248e6/latest_articles" target="_blank">占小狼</a><br>转载请注明原创出处，谢谢！</p></blockquote>
<p>上周有幸参加了一次关于JVM的小范围分享会，听完R大对虚拟机C2编译器的讲解，我的膝盖一直是肿的，能记住的实在有点少，能听进去也不多<br>1、什么时候进行C2编译，如何进行C2编译（这个实在太复杂）<br>2、C2编译的时候，是对整个方法体进行编译，而不是某个方法段<br>3、JVM中的safepoint</p>
<p>一直都知道，当发生GC时，正在执行Java code的线程必须全部停下来，才可以进行垃圾回收，这就是熟悉的STW（stop the world），但是STW的背后实现原理，比如这些线程如何暂停、又如何恢复？就比较疑惑了。</p>
<div class="image-package">
<img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/2184951-877439e958624bfa.png" data-original-src="http://upload-images.jianshu.io/upload_images/2184951-877439e958624bfa.png?imageMogr2/auto-orient/strip%7CimageView2/2" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div>
<p>然而这一切的一切，都涉及到一个概念safepoint，openjdk的实现位于<code>openjdk/hotspot/src/share/vm/runtime/safepoint.cpp</code></p>
<h3>什么是safepoint</h3>
<p>safepoint可以用在不同地方，比如GC、Deoptimization，在Hotspot VM中，GC safepoint比较常见，需要一个数据结构记录每个线程的调用栈、寄存器等一些重要的数据区域里什么地方包含了GC管理的指针。</p>
<p>从线程角度看，safepoint可以理解成是在代码执行过程中的一些特殊位置，当线程执行到这些位置的时候，说明虚拟机当前的状态是安全的，如果
有需要，可以在这个位置暂停，比如发生GC时，需要暂停暂停所以活动线程，但是线程在这个时刻，还没有执行到一个安全点，所以该线程应该继续执行，到达下
一个安全点的时候暂停，等待GC结束。</p>
<h3>什么地方可以放safepoint</h3>
<p>下面以Hotspot为例，简单的说明一下什么地方会放置safepoint<br>1、理论上，在解释器的每条字节码的边界都可以放一个
safepoint，不过挂在safepoint的调试符号信息要占用内存空间，如果每条机器码后面都加safepoint的话，需要保存大量的运行时数
据，所以要尽量少放置safepoint，在safepoint会生成polling代码询问VM是否要“进入safepoint”，polling操作
也是有开销的，polling操作会在后续解释。</p>
<p>2、通过JIT编译的代码里，会在所有方法的返回之前，以及所有非counted 
loop的循环（无界循环）回跳之前放置一个safepoint，为了防止发生GC需要STW时，该线程一直不能暂停。另外，JIT编译器在生成机器码的
同时会为每个safepoint生成一些“调试符号信息”，为GC生成的符号信息是OopMap，指出栈上和寄存器里哪里有GC管理的指针。</p>
<h3>线程如何被挂起</h3>
<p>如果触发GC动作，VM thread会在<code>VMThread::loop()</code>方法中调用<code>SafepointSynchronize::begin()</code>方法，最终使所有的线程都进入到safepoint。</p>
<pre class="hljs lasso"><code class="lasso"><span class="hljs-comment">// Roll all threads forward to a safepoint and suspend them all</span>
<span class="hljs-literal">void</span> SafepointSynchronize<span class="hljs-type">::begin</span>() {
  <span class="hljs-keyword">Thread</span>* myThread = <span class="hljs-keyword">Thread</span><span class="hljs-type">::current</span>();
  assert(myThread-&gt;is_VM_thread(), <span class="hljs-string">"Only VM thread may execute a safepoint"</span>);

  <span class="hljs-keyword">if</span> (PrintSafepointStatistics || PrintSafepointStatisticsTimeout &gt; <span class="hljs-number">0</span>) {
    _safepoint_begin_time = os<span class="hljs-type">::javaTimeNanos</span>();
    _ts_of_current_safepoint = tty-&gt;time_stamp().seconds();
  }</code></pre>
<p>在safepoint实现中，有这样一段注释，Java threads可以有多种不同的状态，所以挂起的机制也不同，一共列举了5中情况：<br></p><div class="image-package">
<img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/2184951-1359753fecd1352a.png" data-original-src="http://upload-images.jianshu.io/upload_images/2184951-1359753fecd1352a.png?imageMogr2/auto-orient/strip%7CimageView2/2" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div>
<h4>1、执行Java code</h4>
<p>在执行字节码时会检查safepoint状态，因为在<code>begin</code>方法中会调用<code>Interpreter::notice_safepoints()</code>方法，通知解释器更新dispatch table，实现如下：</p>
<pre class="hljs sqf"><code class="sqf">void TemplateInterpreter::notice_safepoints() {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable">_notice_safepoints</span>) {
    <span class="hljs-comment">// switch to safepoint dispatch table</span>
    <span class="hljs-variable">_notice_safepoints</span> = <span class="hljs-literal">true</span>;
    copy_table((address*)&amp;<span class="hljs-variable">_safept_table</span>, (address*)&amp;<span class="hljs-variable">_active_table</span>, <span class="hljs-built_in">sizeof</span>(<span class="hljs-variable">_active_table</span>) / <span class="hljs-built_in">sizeof</span>(address));
  }
}</code></pre>
<h4>2、执行native code</h4>
<p>如果VM thread发现一个Java thread正在执行native code，并不会等待该Java thread阻塞，不过当该Java thread从native code返回时，必须检查safepoint状态，看是否需要进行阻塞。</p>
<p>这里涉及到两个状态：Java thread state和safepoint state，两者之间有着严格的读写顺序，一般可以通过内存屏障实现，但是性能开销比较大，Hotspot采用另一种方式，调用<code>os::serialize_thread_states()</code>把每个线程的状态依次写入到同一个内存页中，实现如下：</p>
<pre class="hljs lasso"><code class="lasso"><span class="hljs-comment">// Serialize all thread state variables</span>
<span class="hljs-literal">void</span> os<span class="hljs-type">::serialize_thread_states</span>() {
  <span class="hljs-comment">// On some platforms such as Solaris &amp; Linux, the time duration of the page</span>
  <span class="hljs-comment">// permission restoration is observed to be much longer than expected  due to</span>
  <span class="hljs-comment">// scheduler starvation problem etc. To avoid the long synchronization</span>
  <span class="hljs-comment">// time and expensive page trap spinning, 'SerializePageLock' is used to block</span>
  <span class="hljs-comment">// the mutator thread if such case is encountered. See bug 6546278 for details.</span>
  <span class="hljs-keyword">Thread</span><span class="hljs-type">::muxAcquire</span>(&amp;SerializePageLock, <span class="hljs-string">"serialize_thread_states"</span>);
  os<span class="hljs-type">::protect_memory</span>((char *)os<span class="hljs-type">::get_memory_serialize_page</span>(),
                     os<span class="hljs-type">::vm_page_size</span>(), MEM_PROT_READ);
  os<span class="hljs-type">::protect_memory</span>((char *)os<span class="hljs-type">::get_memory_serialize_page</span>(),
                     os<span class="hljs-type">::vm_page_size</span>(), MEM_PROT_RW);
  <span class="hljs-keyword">Thread</span><span class="hljs-type">::muxRelease</span>(&amp;SerializePageLock);
}</code></pre>
<p>通过VM thread执行一系列mprotect os call，保证之前所有线程状态的写入可以被顺序执行，效率更高。</p>
<h4>3、执行complied code</h4>
<p>如果想进入safepoint，则设置polling page不可读，当Java thread发现该内存页不可读时，最终会被阻塞挂起。在<code>SafepointSynchronize::begin()</code>方法中，通过<code>os::make_polling_page_unreadable()</code>方法设置polling page为不可读。</p>
<pre class="hljs cpp"><code class="cpp"><span class="hljs-keyword">if</span> (UseCompilerSafepoints &amp;&amp; DeferPollingPageLoopCount &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// Make polling safepoint aware</span>
    guarantee (PageArmed == <span class="hljs-number">0</span>, <span class="hljs-string">"invariant"</span>) ;
    PageArmed = <span class="hljs-number">1</span> ;
    os::make_polling_page_unreadable();
}</code></pre>
<p>方法<code>make_polling_page_unreadable()</code>在不同系统的实现不一样</p>
<pre class="hljs groovy"><code class="groovy">linux下实现
<span class="hljs-comment">// Mark the polling page as unreadable</span>
<span class="hljs-keyword">void</span> <span class="hljs-string">os:</span>:make_polling_page_unreadable(<span class="hljs-keyword">void</span>) {
  <span class="hljs-keyword">if</span>( !guard_memory((<span class="hljs-keyword">char</span>*)_polling_page, <span class="hljs-string">Linux:</span>:page_size()) )
    fatal(<span class="hljs-string">"Could not disable polling page"</span>);
};

solaris下实现
<span class="hljs-comment">// Mark the polling page as unreadable</span>
<span class="hljs-keyword">void</span> <span class="hljs-string">os:</span>:make_polling_page_unreadable(<span class="hljs-keyword">void</span>) {
  <span class="hljs-keyword">if</span>( mprotect((<span class="hljs-keyword">char</span> *)_polling_page, page_size, PROT_NONE) != <span class="hljs-number">0</span> )
    fatal(<span class="hljs-string">"Could not disable polling page"</span>);
};</code></pre>
<p>在JIT编译中，编译器会把safepoint检查的操作插入到机器码指令中，比如下面的指令：</p>
<pre class="hljs x86asm"><code class="x86asm"><span class="hljs-number">0x01b6d627</span>: <span class="hljs-keyword">call</span>   <span class="hljs-number">0x01b2b210</span>         <span class="hljs-comment">; OopMap{[60]=Oop off=460}      </span>
                                       <span class="hljs-comment">;*invokeinterface size      </span>
                                       <span class="hljs-comment">; - Client1::main@113 (line 23)      </span>
                                       <span class="hljs-comment">;   {virtual_call}      </span>
 <span class="hljs-number">0x01b6d62c</span>: <span class="hljs-keyword">nop</span>                       <span class="hljs-comment">; OopMap{[60]=Oop off=461}      </span>
                                       <span class="hljs-comment">;*if_icmplt      </span>
                                       <span class="hljs-comment">; - Client1::main@118 (line 23)      </span>
 <span class="hljs-number">0x01b6d62d</span>: <span class="hljs-keyword">test</span>   %eax,<span class="hljs-number">0x160100</span>      <span class="hljs-comment">;   {poll}      </span>
 <span class="hljs-number">0x01b6d633</span>: <span class="hljs-keyword">mov</span>    <span class="hljs-number">0x50</span>(%esp),%esi      
 <span class="hljs-number">0x01b6d637</span>: <span class="hljs-keyword">cmp</span>    %eax,%esi</code></pre>
<p>test  %eax,0x160100 就是一个检查polling page是否可读的操作，如果不可读，则该线程会被挂起等待。</p>
<h4>4、线程处于Block状态</h4>
<p>即使线程已经满足了block condition，也要等到safepoint operation完成，如GC操作，才能返回。</p>
<h4>5、线程正在转换状态</h4>
<p>会去检查safepoint状态，如果需要阻塞，就把自己挂起。  </p>
<h4>最终实现</h4>
<p>当线程访问到被保护的内存地址时，会触发一个SIGSEGV信号，进而触发JVM的signal handler来阻塞这个线程，The GC 
thread can protect some memory to which all threads in the process can 
write (using the mprotect system call) so they no longer can. Upon 
accessing this temporarily forbidden memory, a signal handler kicks in。</p>
<p>再看看底层是如何处理这个SIGSEGV信号，实现位于<code>hotspot/src/os_cpu/linux_x86/vm/os_linux_x86.cpp</code></p>
<pre class="hljs lasso"><code class="lasso"><span class="hljs-comment">// Check to see if we caught the safepoint code in the</span>
<span class="hljs-comment">// process of write protecting the memory serialization page.</span>
<span class="hljs-comment">// It write enables the page immediately after protecting it</span>
<span class="hljs-comment">// so we can just return to retry the write.</span>
<span class="hljs-keyword">if</span> ((sig == SIGSEGV) &amp;&amp;
    os<span class="hljs-type">::is_memory_serialize_page</span>(<span class="hljs-keyword">thread</span>, (address) info-&gt;si_addr)) {
  <span class="hljs-comment">// Block current thread until the memory serialize page permission restored.</span>
  os<span class="hljs-type">::block_on_serialize_page_trap</span>();
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}</code></pre>
<p>执行<code>os::block_on_serialize_page_trap()</code>把当前线程阻塞挂起。</p>
<h3>线程如何恢复</h3>
<p>有了<code>begin</code>方法，自然有对应的<code>end</code>方法，在<code>SafepointSynchronize::end()</code>中，会最终唤醒所有挂起等待的线程，大概实现如下：<br>1、重新设置pooling page为可读</p>
<pre class="hljs cpp"><code class="cpp">  <span class="hljs-keyword">if</span> (PageArmed) {
    <span class="hljs-comment">// Make polling safepoint aware</span>
    os::make_polling_page_readable();
    PageArmed = <span class="hljs-number">0</span> ;
  }</code></pre>
<p>2、设置解释器为ignore_safepoints，实现如下：</p>
<pre class="hljs sqf"><code class="sqf"><span class="hljs-comment">// switch from the dispatch table which notices safepoints back to the</span>
<span class="hljs-comment">// normal dispatch table.  So that we can notice single stepping points,</span>
<span class="hljs-comment">// keep the safepoint dispatch table if we are single stepping in JVMTI.</span>
<span class="hljs-comment">// Note that the should_post_single_step test is exactly as fast as the</span>
<span class="hljs-comment">// JvmtiExport::_enabled test and covers both cases.</span>
void TemplateInterpreter::ignore_safepoints() {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable">_notice_safepoints</span>) {
    <span class="hljs-keyword">if</span> (!JvmtiExport::should_post_single_step()) {
      <span class="hljs-comment">// switch to normal dispatch table</span>
      <span class="hljs-variable">_notice_safepoints</span> = <span class="hljs-literal">false</span>;
      copy_table((address*)&amp;<span class="hljs-variable">_normal_table</span>, (address*)&amp;<span class="hljs-variable">_active_table</span>, <span class="hljs-built_in">sizeof</span>(<span class="hljs-variable">_active_table</span>) / <span class="hljs-built_in">sizeof</span>(address));
    }
  }
}</code></pre>
<p>3、唤醒所有挂起等待的线程</p>
<pre class="hljs php"><code class="php"><span class="hljs-comment">// Start suspended threads</span>
    <span class="hljs-keyword">for</span>(JavaThread *current = Threads::first(); current; current = current-&gt;next()) {
      <span class="hljs-comment">// A problem occurring on Solaris is when attempting to restart threads</span>
      <span class="hljs-comment">// the first #cpus - 1 go well, but then the VMThread is preempted when we get</span>
      <span class="hljs-comment">// to the next one (since it has been running the longest).  We then have</span>
      <span class="hljs-comment">// to wait for a cpu to become available before we can continue restarting</span>
      <span class="hljs-comment">// threads.</span>
      <span class="hljs-comment">// <span class="hljs-doctag">FIXME:</span> This causes the performance of the VM to degrade when active and with</span>
      <span class="hljs-comment">// large numbers of threads.  Apparently this is due to the synchronous nature</span>
      <span class="hljs-comment">// of suspending threads.</span>
      <span class="hljs-comment">//</span>
      <span class="hljs-comment">// TODO-<span class="hljs-doctag">FIXME:</span> the comments above are vestigial and no longer apply.</span>
      <span class="hljs-comment">// Furthermore, using solaris' schedctl in this particular context confers no benefit</span>
      <span class="hljs-keyword">if</span> (VMThreadHintNoPreempt) {
        os::hint_no_preempt();
      }
      ThreadSafepointState* cur_state = current-&gt;safepoint_state();
      assert(cur_state-&gt;type() != ThreadSafepointState::_running, <span class="hljs-string">"Thread not suspended at safepoint"</span>);
      cur_state-&gt;restart();
      assert(cur_state-&gt;is_running(), <span class="hljs-string">"safepoint state has not been reset"</span>);
    }</code></pre>
<h3>对JVM性能有什么影响</h3>
<p>通过设置JVM参数 <code>-XX:+PrintGCApplicationStoppedTime</code>， 可以打出系统停止的时间，大概如下：</p>
<pre class="hljs applescript"><code class="applescript">Total <span class="hljs-built_in">time</span> <span class="hljs-keyword">for</span> which <span class="hljs-built_in">application</span> threads were stopped: <span class="hljs-number">0.0051000</span> seconds  
Total <span class="hljs-built_in">time</span> <span class="hljs-keyword">for</span> which <span class="hljs-built_in">application</span> threads were stopped: <span class="hljs-number">0.0041930</span> seconds  
Total <span class="hljs-built_in">time</span> <span class="hljs-keyword">for</span> which <span class="hljs-built_in">application</span> threads were stopped: <span class="hljs-number">0.0051210</span> seconds  
Total <span class="hljs-built_in">time</span> <span class="hljs-keyword">for</span> which <span class="hljs-built_in">application</span> threads were stopped: <span class="hljs-number">0.0050940</span> seconds  
Total <span class="hljs-built_in">time</span> <span class="hljs-keyword">for</span> which <span class="hljs-built_in">application</span> threads were stopped: <span class="hljs-number">0.0058720</span> seconds  
Total <span class="hljs-built_in">time</span> <span class="hljs-keyword">for</span> which <span class="hljs-built_in">application</span> threads were stopped: <span class="hljs-number">5.1298200</span> seconds
Total <span class="hljs-built_in">time</span> <span class="hljs-keyword">for</span> which <span class="hljs-built_in">application</span> threads were stopped: <span class="hljs-number">0.0197290</span> seconds  
Total <span class="hljs-built_in">time</span> <span class="hljs-keyword">for</span> which <span class="hljs-built_in">application</span> threads were stopped: <span class="hljs-number">0.0087590</span> seconds</code></pre>
<p>从上面数据可以发现，有一次暂停时间特别长，达到了5秒多，这在线上环境肯定是无法忍受的，那么是什么原因导致的呢？</p>
<p>一个大概率的原因是当发生GC时，有线程迟迟进入不到safepoint进行阻塞，导致其他已经停止的线程也一直等待，VM 
Thread也在等待所有的Java线程挂起才能开始GC，这里需要分析业务代码中是否存在有界的大循环逻辑，可能在JIT优化时，这些循环操作没有插入
safepoint检查。</p>
<p>参考资料：<br><a href="http://blog.csdn.net/iter_zc/article/details/41892567" target="_blank">聊聊JVM（九）理解进入safepoint时如何让Java线程全部阻塞</a><br><a href="https://www.zhihu.com/question/29268019" target="_blank">现代JVM中的Safe Region和Safe Point到底是如何定义和划分的?
</a><br><a href="http://stackoverflow.com/questions/20134769/how-to-get-java-stacks-when-jvm-cant-reach-a-safepoint" target="_blank">How to get Java stacks when JVM can't reach a safepoint</a><br><a href="http://blog.ragozin.info/2012/10/safepoints-in-hotspot-jvm.html" target="_blank">Safepoints in HotSpot JVM</a></p>

        </div>
        <!--  -->

        <div class="show-foot">
          <a class="notebook" href="http://www.jianshu.com/nb/12554212">
            <i class="iconfont ic-search-notebook"></i> <span>JVM源码分析</span>
</a>          <div class="copyright" data-toggle="tooltip" data-html="true" data-original-title="转载请联系作者获得授权，并标注“简书作者”。">
            © 著作权归作者所有
          </div>
          <div class="modal-wrap" data-report-note="">
            <a id="report-modal">举报文章</a>
          </div>
        </div>
    </div>

    <!-- 文章底部作者信息 -->
      <div class="follow-detail">
        <div class="info">
          <a class="avatar" href="http://www.jianshu.com/u/90ab66c248e6">
            <img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/e504c85fb1dc.png" alt="144">
</a>          <a class="btn btn-default following"><i class="iconfont ic-followed"></i><span>已关注</span></a>
          <a class="title" href="http://www.jianshu.com/u/90ab66c248e6">占小狼</a>
            <i class="iconfont ic-man"></i>
        <p>写了 130241 字，被 5784 人关注，获得了 4674 个喜欢</p></div>
          <div class="signature">如果读完觉得有收获的话，欢迎点赞加关注

微信公众号 占小狼的博客
http://upload-images.jianshu.io/upload_images/2184951-2079ac376dbc9c0c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240


推荐一个干货社区
Spring For All 社区（http://spring4all.com）</div>
      </div>

      <div class="support-author"><p>如果觉得我的文章对您有用，请随意赞赏。您的支持将鼓励我继续创作！</p> <div class="btn btn-pay">赞赏支持</div> <!----> <!----> <!----></div>

    <div class="meta-bottom">
      <div class="like"><div class="btn like-group"><div class="btn-like"><a><i class="iconfont ic-like"></i>喜欢</a></div> <div class="modal-wrap"><a>18</a></div></div> <!----></div>
      <div class="share-group">
        <a class="share-circle" data-action="weixin-share" data-toggle="tooltip" data-original-title="分享到微信">
          <i class="iconfont ic-wechat"></i>
        </a>
        <a class="share-circle" data-toggle="tooltip" href="javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f='http://v.t.sina.com.cn/share/share.php?appkey=1881139527',u=z||d.location,p=['&amp;url=',e(u),'&amp;title=',e(t||d.title),'&amp;source=',e(r),'&amp;sourceUrl=',e(l),'&amp;content=',c||'gb2312','&amp;pic=',e(p||'')].join('');function%20a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=440,height=430,left=',(s.width-440)/2,',top=',(s.height-430)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,'','','http://cwb.assets.jianshu.io/notes/images/11834889/weibo/image_c106a40389f6.jpg',%20'%E6%8E%A8%E8%8D%90%20@%E5%8D%A0%E5%B0%8F%E9%83%8E%20%E7%9A%84%E6%96%87%E7%AB%A0%E3%80%8AJVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%E3%80%8B%EF%BC%88%20%E5%88%86%E4%BA%AB%E8%87%AA%20@%E7%AE%80%E4%B9%A6%20%EF%BC%89','http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weibo','%E9%A1%B5%E9%9D%A2%E7%BC%96%E7%A0%81gb2312|utf-8%E9%BB%98%E8%AE%A4gb2312'));" data-original-title="分享到微博">
          <i class="iconfont ic-weibo"></i>
        </a>
          <a class="share-circle" data-toggle="tooltip" href="http://cwb.assets.jianshu.io/notes/images/11834889/weibo/image_c106a40389f6.jpg" target="_blank" data-original-title="下载长微博图片">
            <i class="iconfont ic-picture"></i>
          </a>
        <a class="share-circle more-share" tabindex="0" data-toggle="popover" data-placement="top" data-html="true" data-trigger="focus" href="javascript:void(0);" data-content="
          &lt;ul class=&quot;share-list&quot;&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+e('http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=qzone')+'&amp;title='+e('推荐 占小狼 的文章《JVM源码分析之安全点safepoint》'),x=function(){if(!window.open(r,'qzone','toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-zone&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到QQ空间&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://twitter.com/share?url='+e('http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=twitter')+'&amp;text='+e('推荐 占小狼 的文章《JVM源码分析之安全点safepoint》（ 分享自 @jianshucom ）')+'&amp;related='+e('jianshucom'),x=function(){if(!window.open(r,'twitter','toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-twitter&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到Twitter&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://www.facebook.com/dialog/share?app_id=483126645039390&amp;display=popup&amp;href=http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=facebook',x=function(){if(!window.open(r,'facebook','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-facebook&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到Facebook&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://plus.google.com/share?url='+e('http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=google_plus'),x=function(){if(!window.open(r,'google_plus','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-google&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到Google+&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,s1=window.getSelection,s2=d.getSelection,s3=d.selection,s=s1?s1():s2?s2():s3?s3.createRange().text:'',r='http://www.douban.com/recommend/?url='+e('http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=douban')+'&amp;title='+e('JVM源码分析之安全点safepoint')+'&amp;sel='+e(s)+'&amp;v=1',x=function(){if(!window.open(r,'douban','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r+'&amp;r=1'};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})()&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-douban&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到豆瓣&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
          &lt;/ul&gt;
        " data-original-title="" title="">更多分享</a>
      </div>
    </div>
    <div><div id="comment-list" class="comment-list"><div><form class="new-comment"><a class="avatar"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/9-cceda3cf5072bcdd77e8ca4f21c40998_002.jpg"></a> <textarea placeholder="写下你的评论..."></textarea> <!----></form></div> <div id="normal-comment-list" class="normal-comment-list"><div><div><div class="top"><span>8条评论</span> <a class="author-only">只看作者</a> <a class="close-btn" style="display: none;">关闭评论</a> <div class="pull-right"><a class="active">按喜欢排序</a><a class="">按时间正序</a><a class="">按时间倒序</a></div></div></div> <!----> <!----> <div class="comments-placeholder" style="display: none;"><div class="author"><div class="avatar"></div> <div class="info"><div class="name"></div> <div class="meta"></div></div></div> <div class="text"></div> <div class="text animation-delay"></div> <div class="tool-group"><i class="iconfont ic-zan-active"></i><div class="zan"></div> <i class="iconfont ic-list-comments"></i><div class="zan"></div></div></div> <div id="comment-10469363" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/5b22384ae03b" target="_blank" class="avatar"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/8870f54ba05e.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/5b22384ae03b" target="_blank" class="name">落落cxy</a> <!----> <div class="meta"><span>2楼 · 2017.04.30 15:51</span></div></div></div> <div class="comment-wrap"><p>放假也在钻研技术的小狼🐺</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>1人赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <a class="report"><span>举报</span></a> <!----></div></div></div> <div class="sub-comment-list"><div id="comment-10469381" class="sub-comment"><p><a href="http://www.jianshu.com/u/90ab66c248e6" target="_blank">占小狼</a>：
          <span><a href="http://www.jianshu.com/users/5b22384ae03b" class="maleskine-author" target="_blank" data-user-slug="5b22384ae03b">@落落cxy</a> 哈哈，技术不能停</span></p> <div class="sub-tool-group"><span>2017.04.30 15:53</span> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <a class="report"><span>举报</span></a> <!----></div></div> <div class="sub-comment more-comment"><a class="add-comment-btn"><i class="iconfont ic-subcomment"></i> <span>添加新评论</span></a> <!----> <!----> <!----></div> <!----></div></div><div id="comment-10487400" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/90bb5aacf3ff" target="_blank" class="avatar"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/89f7b1b9-5542-45c4-af72-48d1d60d0715.png"></a> <div class="info"><a href="http://www.jianshu.com/u/90bb5aacf3ff" target="_blank" class="name">䒕愺</a> <!----> <div class="meta"><span>3楼 · 2017.05.01 11:05</span></div></div></div> <div class="comment-wrap"><p>这研究的好深，暂时只能膜拜了</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <a class="report"><span>举报</span></a> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-10520766" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/52ce170cb0ca" target="_blank" class="avatar"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/163a7231-7211-48e4-9d7b-cad9d075d2f4.JPG"></a> <div class="info"><a href="http://www.jianshu.com/u/52ce170cb0ca" target="_blank" class="name">鲸息_Leon</a> <!----> <div class="meta"><span>4楼 · 2017.05.02 17:37</span></div></div></div> <div class="comment-wrap"><p>看得我的膝盖也碎了</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <a class="report"><span>举报</span></a> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-10520788" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/52ce170cb0ca" target="_blank" class="avatar"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/163a7231-7211-48e4-9d7b-cad9d075d2f4.JPG"></a> <div class="info"><a href="http://www.jianshu.com/u/52ce170cb0ca" target="_blank" class="name">鲸息_Leon</a> <!----> <div class="meta"><span>5楼 · 2017.05.02 17:38</span></div></div></div> <div class="comment-wrap"><p>提个建议，英文数字特殊符号，最好前后各加一个英文半角空格，从而和中文明显地分隔开，阅读体验会更好。</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <a class="report"><span>举报</span></a> <!----></div></div></div> <div class="sub-comment-list"><div id="comment-10521426" class="sub-comment"><p><a href="http://www.jianshu.com/u/90ab66c248e6" target="_blank">占小狼</a>：
          <span><a href="http://www.jianshu.com/users/52ce170cb0ca" class="maleskine-author" target="_blank" data-user-slug="52ce170cb0ca">@Leon_鲸息</a> 好的，多谢提醒</span></p> <div class="sub-tool-group"><span>2017.05.02 18:08</span> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <a class="report"><span>举报</span></a> <!----></div></div> <div class="sub-comment more-comment"><a class="add-comment-btn"><i class="iconfont ic-subcomment"></i> <span>添加新评论</span></a> <!----> <!----> <!----></div> <!----></div></div><div id="comment-12479138" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/4b0ece0e146d" target="_blank" class="avatar"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/13-394c31a9cb492fcb39c27422ca7d2815.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/4b0ece0e146d" target="_blank" class="name">老衲用清扬</a> <!----> <div class="meta"><span>6楼 · 2017.07.04 18:10</span></div></div></div> <div class="comment-wrap"><p>。。。还没看，先收藏了，感觉又要看不懂了</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <a class="report"><span>举报</span></a> <!----></div></div></div> <div class="sub-comment-list"><div id="comment-12481972" class="sub-comment"><p><a href="http://www.jianshu.com/u/90ab66c248e6" target="_blank">占小狼</a>：
          <span><a href="http://www.jianshu.com/users/4b0ece0e146d" class="maleskine-author" target="_blank" data-user-slug="4b0ece0e146d">@老衲用清扬</a> 这个略难</span></p> <div class="sub-tool-group"><span>2017.07.04 19:48</span> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <a class="report"><span>举报</span></a> <!----></div></div> <div class="sub-comment more-comment"><a class="add-comment-btn"><i class="iconfont ic-subcomment"></i> <span>添加新评论</span></a> <!----> <!----> <!----></div> <!----></div></div></div></div> <!----> <div><!----></div></div></div>
  </div>

  <div class="side-tool"><ul><li data-placement="left" data-toggle="tooltip" data-container="body" data-original-title="回到顶部" style=""><a class="function-button"><i class="iconfont ic-backtop"></i></a></li> <li data-placement="left" data-toggle="tooltip" data-container="body" data-original-title="将文章加入专题"><a class="js-submit-button"><i class="iconfont ic-addcollectionmodal"></i></a> <!----></li> <li data-placement="left" data-toggle="tooltip" data-container="body" data-original-title="收藏文章"><a class="function-button"><i class="iconfont ic-mark"></i></a></li> <li data-placement="left" data-toggle="tooltip" data-container="body" data-original-title="分享文章"><a tabindex="0" role="button" data-toggle="popover" data-placement="left" data-html="true" data-trigger="focus" href="javascript:void(0);" data-content="&lt;ul class='share-list'&gt;
                &lt;li&gt;&lt;a class=&quot;weixin-share&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-weixin&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到微信&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f='http://v.t.sina.com.cn/share/share.php?appkey=1881139527',u=z||d.location,p=['&amp;url=',e(u),'&amp;title=',e(t||d.title),'&amp;source=',e(r),'&amp;sourceUrl=',e(l),'&amp;content=',c||'gb2312','&amp;pic=',e(p||'')].join('');function%20a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=440,height=430,left=',(s.width-440)/2,',top=',(s.height-430)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,'','','http://cwb.assets.jianshu.io/notes/images/11834889/weibo/image_c106a40389f6.jpg', '推荐 @占小郎 的文章《JVM源码分析之安全点safepoint》（ 分享自 @简书 ）','http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weibo','页面编码gb2312|utf-8默认gb2312'));&quot;&gt;&lt;i class='social-icon-sprite social-icon-weibo'&gt;&lt;/i&gt;&lt;span&gt;分享到微博&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;http://cwb.assets.jianshu.io/notes/images/11834889/weibo/image_c106a40389f6.jpg&quot; target=&quot;_blank&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-picture&quot;&gt;&lt;/i&gt;&lt;span&gt;下载长微博图片&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+e('http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=qzone')+'&amp;title='+e('推荐 占小狼 的文章《JVM源码分析之安全点safepoint》'),x=function(){if(!window.open(r,'qzone','toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class='social-icon-sprite social-icon-zone'&gt;&lt;/i&gt;&lt;span&gt;分享到QQ空间&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://twitter.com/share?url='+e('http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=twitter')+'&amp;text='+e('推荐 占小狼 的文章《JVM源码分析之安全点safepoint》（ 分享自 @jianshucom ）')+'&amp;related='+e('jianshucom'),x=function(){if(!window.open(r,'twitter','toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class='social-icon-sprite social-icon-twitter'&gt;&lt;/i&gt;&lt;span&gt;分享到Twitter&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://www.facebook.com/dialog/share?app_id=483126645039390&amp;display=popup&amp;href=http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=facebook',x=function(){if(!window.open(r,'facebook','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class='social-icon-sprite social-icon-facebook'&gt;&lt;/i&gt;&lt;span&gt;分享到Facebook&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://plus.google.com/share?url='+e('http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=google_plus'),x=function(){if(!window.open(r,'google_plus','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class='social-icon-sprite social-icon-google'&gt;&lt;/i&gt;&lt;span&gt;分享到Google+&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,s1=window.getSelection,s2=d.getSelection,s3=d.selection,s=s1?s1():s2?s2():s3?s3.createRange().text:'',r='http://www.douban.com/recommend/?url='+e('http://www.jianshu.com/p/c79c5e02ebe6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=douban')+'&amp;title='+e('JVM源码分析之安全点safepoint')+'&amp;sel='+e(s)+'&amp;v=1',x=function(){if(!window.open(r,'douban','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r+'&amp;r=1'};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})()&quot;&gt;&lt;i class='social-icon-sprite social-icon-douban'&gt;&lt;/i&gt;&lt;span&gt;分享到豆瓣&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
              &lt;/ul&gt;" data-original-title="" title="" class="function-button"><i class="iconfont ic-share"></i></a> <!----></li></ul></div>
</div>
<div class="note-bottom">
  <div><div class="main"><div class="title">被以下专题收入，发现更多相似内容</div> <!----> <div class="include-collection"><div class="modal-wrap add-collection-wrap"><a class="add-collection"><i class="iconfont ic-follow"></i>收入我的专题</a></div> <a href="http://www.jianshu.com/c/addfce4ca518?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/1470643432.jpg"><div class="name">java进阶干货</div></a><a href="http://www.jianshu.com/c/NEt52a?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/computer_guy.jpg"><div class="name">程序员</div></a> <!----></div></div> <!----> <!----></div>
  <div class="recommend-note"><div class="meta"><div class="title">更多精彩内容</div> <div class="roll"></div></div> <div class="list"><div class="note"><a target="_blank" href="http://www.jianshu.com/p/ffc6fd82e32b?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="cover" style="background-image: url(&quot;//upload-images.jianshu.io/upload_images/2184951-d9cb43b57e0dfd11.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240&quot;);"></a> <a target="_blank" href="http://www.jianshu.com/p/ffc6fd82e32b?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="title">Netty源码分析之accept过程</a> <p class="description">本
章节分析服务端如何accept客户端的connect请求。 
在Netty源码分析之NioEventLoop章节中，已经分析了NioEventLoop的工作机制，当有客户端connect请
求，selector可以返回其对应的SelectionKey，方法processSelectedKeys进行后续的处理。 
默认采用优化过的SelectedSelectionKeySet保存有事件发生的selectedKey。1、
SelectedSelectionKeySet内部使用两个大小为1024的SelectionKey数组keysA和keysB保存
selectedKey。2、把SelectedSe...</p> <a target="_blank" href="http://www.jianshu.com/u/90ab66c248e6?utm_campaign=maleskine&amp;utm_content=user&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="author"><div class="avatar" style="background-image: url(&quot;http://upload.jianshu.io/users/upload_avatars/2184951/e504c85fb1dc.jpg&quot;);"></div> <span class="name">占小狼</span></a></div><div class="note"><!----> <a target="_blank" href="http://www.jianshu.com/p/29c20f0684d0?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="title">JVM源码分析之老年代TenuredGeneration的垃圾回收算法实现</a> <p class="description">简
书 占小狼转载请注明原创出处，谢谢！ 看得越多，懂的越少，还年轻，多学习！ 
接着上文《JVM源码分析之新生代DefNewGeneration的实现》，本文对老年代TenuredGeneration的垃圾回收算法进行分析。
 TenuredGeneration 
老年代TenuredGeneration使用标记-压缩-清理算法进行垃圾回收，将标记对象移动到堆的另一端，同时更新对象的引用地址，算法的具体实现
位于TenuredGeneration::collect()方法 
调用父类的OneContigSpaceCardGeneration的collect()方法，实现如下 其中GenMarkSw...</p> <a target="_blank" href="http://www.jianshu.com/u/90ab66c248e6?utm_campaign=maleskine&amp;utm_content=user&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="author"><div class="avatar" style="background-image: url(&quot;http://upload.jianshu.io/users/upload_avatars/2184951/e504c85fb1dc.jpg&quot;);"></div> <span class="name">占小狼</span></a></div><div class="note"><a target="_blank" href="http://www.jianshu.com/p/3f60e6553aa5?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="cover" style="background-image: url(&quot;//upload-images.jianshu.io/upload_images/1996023-6fe74c3121274b53.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240&quot;);"></a> <a target="_blank" href="http://www.jianshu.com/p/3f60e6553aa5?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="title">懂得什么是职业技能转移，助你大胆跳槽</a> <p class="description">职
场中打拼多年，遭遇到了如下两种职场困惑： 
一种是，现在的工作，所涉及的行业和职位，不知道是不是自己要终身从事的，如果不是的话，自己是否就没有必要努力做好，只需要勉强应付过去？ 
一种是，现在的工作，自己努力干到最好，要是未来这个行消失了，或者这个工种随着时代的发展，不需要了，那我现在这样努力有用吗？ 
面对上面的两种困惑，今天就给大家分享下最近在职场研究中涉及到的一个专题：职业技能转移，也有的资料上说成：职业技能转移。 
不管是迁移还是转移，个人认为本质是一致的，咱们姑且以职业技能转移来探讨吧。 一、什么是职业技能转移？ 
有学说认为，职业技能转移是从一个行业转入到另外一个行业，而不需要从来来...</p> <a target="_blank" href="http://www.jianshu.com/u/2796f2d6e198?utm_campaign=maleskine&amp;utm_content=user&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="author"><div class="avatar" style="background-image: url(&quot;http://upload.jianshu.io/users/upload_avatars/1996023/a1e3ab6c-6929-4da5-879a-90b54c26627e.jpg&quot;);"></div> <span class="name">佳心有约</span></a></div><div class="note"><a target="_blank" href="http://www.jianshu.com/p/535fd0a8a296?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="cover" style="background-image: url(&quot;//upload-images.jianshu.io/upload_images/2542851-c22166fb01ccd186.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240&quot;);"></a> <a target="_blank" href="http://www.jianshu.com/p/535fd0a8a296?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="title">越来越多的人，开始觉得读研是一条不归路</a> <p class="description">文
/怀左同学 01 为什么很多人觉得读研无用，认为那是一条不归路呢？ 答：别扯了，路本身没有对错，归根到底，还是自己不行。 02 
前天给晓兰补课时，她说酷暑难耐，在学校备考的每天，感觉都要热化。我提议回家休息，吹吹空调吃点西瓜，她说算了，就在学校吧，为了考研，拼一把。 
她是我带的一个大三的学生，既踏实又可爱，没事的时候，还喜欢调侃我：“怀老师，你怎么那么能吃，你是猪吗？怀老师，你不是说每天唱歌吗，你的歌呢？怀老
师，有时候我觉得你很傻很天真啊……” 
其实她也有很多烦恼，学校领导找她谈话，希望她换一个难度低点的学校，向我诉苦时，我问：“别管他们，你自己心里是怎么想的？” 
她说：“我就喜欢报考...</p> <a target="_blank" href="http://www.jianshu.com/u/62478ec15b74?utm_campaign=maleskine&amp;utm_content=user&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="author"><div class="avatar" style="background-image: url(&quot;http://upload.jianshu.io/users/upload_avatars/2542851/0dca220dd6bb.jpeg&quot;);"></div> <span class="name">怀左同学</span></a></div><div class="note"><a target="_blank" href="http://www.jianshu.com/p/3133b2b3d400?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="cover" style="background-image: url(&quot;//upload-images.jianshu.io/upload_images/1217754-5ba22b2f82c4cfc6?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240&quot;);"></a> <a target="_blank" href="http://www.jianshu.com/p/3133b2b3d400?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="title">这5本书将彻底颠覆你的认知</a> <p class="description">文|
麦家理想谷 本文原创，转载请联系 / 《乌合之众》 居斯塔夫·勒庞 著 豆瓣评分8.3分，一本研究人类的群体行为不可不读的佳作。 
没有一片雪花会认为是自己造成了雪崩。 
这句话所说的其实是“责任分摊效应”。就像前段时间网上很火的少女二次碾压事件，现场那么多围观群众，却没有人伸出援手。我们很容易想到的就是这群人怎么
这么冷漠这么道德沦丧，但是这本书告诉我们，这也可能只是因为“责任分摊效应”，因为每个人都在等着别人先出手，他自己的责任感却相应减弱了。 
这本书还告诉我们，当个体处在集体当中的时候，他的思考能力和判断能力都会下降，这时候，他往往会做出一些不正确的事，陷入一种集体无意识的状态，变
成...</p> <a target="_blank" href="http://www.jianshu.com/u/009eac2d558e?utm_campaign=maleskine&amp;utm_content=user&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" class="author"><div class="avatar" style="background-image: url(&quot;http://upload.jianshu.io/users/upload_avatars/1217754/0c7b873894df&quot;);"></div> <span class="name">麦家理想谷</span></a></div></div></div>
</div>

    <script src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/push.js"></script><script src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/hm.js"></script><script async="" src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/analytics.js"></script><script type="application/json" data-name="page-data">{"user_signed_in":true,"locale":"zh-CN","os":"mac","read_mode":"day","read_font":"font2","current_user":{"id":5282510,"nickname":"yonka","slug":"4b55ee401111","avatar":"http://cdn2.jianshu.io/assets/default_avatar/9-cceda3cf5072bcdd77e8ca4f21c40998.jpg","unread_counts":{"chats":0,"total":0},"has_editable_collection":false},"note_show":{"is_author":false,"is_following_author":true,"is_liked_note":false,"uuid":"8f80544a-2156-4894-bd2d-19db8ed2fa23"},"note":{"id":11834889,"slug":"c79c5e02ebe6","user_id":2184951,"notebook_id":12554212,"commentable":true,"likes_count":18,"views_count":1226,"public_wordage":1835,"comments_count":8,"total_rewards_count":0,"is_author":false,"author":{"nickname":"占小狼","total_wordage":130241,"followers_count":5784,"total_likes_count":4674}}}</script>
    
    <script src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/babel-polyfill-a9ca93d3a83b3a1f92da.js"></script>
    <script src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/web-base-1e5054a5d8733cfec67f.js"></script>
<script src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/web-0773ed4b5a6b652bd765.js"></script>
    
    <script src="JVM%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%AE%89%E5%85%A8%E7%82%B9safepoint%20-%20%E7%AE%80%E4%B9%A6_files/entry-cc051170909eea2bebb4.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-35169517-1', 'auto');
  ga('send', 'pageview');
</script>

<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?0c0e9d9b1e7d617b3e6842e85b9fb068";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>

<script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
</script>

  

<!----><!----></body></html>